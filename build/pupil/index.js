(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{activatePicker:()=>le,addStep:()=>he,clearAiDraft:()=>ye,clearResolvedTarget:()=>ie,deactivatePicker:()=>de,deleteStep:()=>Te,endTour:()=>Z,fetchTour:()=>K,fetchTours:()=>$,incrementResolutionAttempts:()=>ae,nextStep:()=>Y,previousStep:()=>J,receiveTour:()=>z,receiveTours:()=>q,reorderSteps:()=>Se,repeatStep:()=>te,requestAiDraft:()=>Re,resetCompletion:()=>se,saveTour:()=>X,selectStep:()=>pe,setAiDraftError:()=>ge,setAiDraftLoading:()=>fe,setAiDraftResult:()=>_e,setCompletionSatisfied:()=>ne,setCurrentStep:()=>Q,setLastError:()=>ue,setMode:()=>re,setPendingChanges:()=>Ee,setRecovering:()=>ce,setResolvedTarget:()=>oe,setSidebarOpen:()=>xe,setToursError:()=>H,setToursLoading:()=>B,skipStep:()=>ee,startTour:()=>W,updateStep:()=>me});var r={};e.r(r),e.d(r,{getAiDraftError:()=>tt,getAiDraftResult:()=>rt,getCurrentStep:()=>Ne,getCurrentStepIndex:()=>De,getCurrentTour:()=>Le,getCurrentTourId:()=>Oe,getLastError:()=>We,getMode:()=>Ve,getProgress:()=>Me,getResolutionAttempts:()=>Xe,getResolvedTarget:()=>$e,getSelectedStep:()=>Ye,getSelectedStepId:()=>Qe,getSkippedSteps:()=>qe,getTotalSteps:()=>ke,getTour:()=>be,getTours:()=>Ie,getToursByEditor:()=>Ce,getToursById:()=>ve,getToursByPostType:()=>Pe,getToursError:()=>we,hasNextStep:()=>Ue,hasPendingChanges:()=>Je,hasPreviousStep:()=>je,isAiDraftLoading:()=>et,isCompletionSatisfied:()=>He,isEducatorMode:()=>Fe,isPickerActive:()=>Ze,isPupilMode:()=>Ge,isRecovering:()=>Ke,isSidebarOpen:()=>nt,isTourActive:()=>Be,isToursLoading:()=>Ae,wasStepSkipped:()=>ze});var n={};e.r(n),e.d(n,{getTour:()=>ct,getTours:()=>it,getToursByPostType:()=>at});const s=window.wp.element,o=window.wp.data,i=window.wp.i18n,c=window.wp.components,a=window.wp.primitives,u=window.ReactJSXRuntime,l=(0,u.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(a.Path,{d:"M20 11.2H6.8l3.7-3.7-1-1L3.9 12l5.6 5.5 1-1-3.7-3.7H20z"})}),d=(0,u.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(a.Path,{d:"M15.6 6.5l-1.1 1 2.9 3.3H8c-.9 0-1.7.3-2.3.9-1.4 1.5-1.4 4.2-1.4 5.6v.2h1.5v-.3c0-1.1 0-3.5 1-4.5.3-.3.7-.5 1.3-.5h9.2L14.5 15l1.1 1.1 4.6-4.6-4.6-5z"})}),p=(0,u.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(a.Path,{d:"M10.6 6L9.4 7l4.6 5-4.6 5 1.2 1 5.4-6z"})}),E=(0,u.jsx)(a.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(a.Path,{d:"M12 4c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8Zm3.8 10.7-1.1 1.1-2.7-2.7-2.7 2.7-1.1-1.1 2.7-2.7-2.7-2.7 1.1-1.1 2.7 2.7 2.7-2.7 1.1 1.1-2.7 2.7 2.7 2.7Z"})}),m=(0,u.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(a.Path,{d:"m14.5 6.5-1 1 3.7 3.7H4v1.6h13.2l-3.7 3.7 1 1 5.6-5.5z"})}),h=(0,u.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(a.Path,{d:"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z"})});function T({step:e,stepIndex:t,totalSteps:r,tourTitle:n,targetElement:o,resolutionError:a,isApplyingPreconditions:T,isPaused:S,onContinue:f,onRepeat:g,onPrevious:_,onNext:y,onPause:R,onResume:x,onStop:I}){const[v,b]=(0,s.useState)({x:20,y:20}),[A,w]=(0,s.useState)(!1),[P,C]=(0,s.useState)({x:0,y:0}),O=(0,s.useRef)(null),L=0===t,D=t===r-1,N="manual"===e?.completion?.type;(0,s.useEffect)(()=>{if(!o||A)return;const e=o.getBoundingClientRect(),t=320,r=200,n=20;let s,i;e.right+t+n<window.innerWidth?(s=e.right+n,i=e.top):e.left-t-n>0?(s=e.left-t-n,i=e.top):e.bottom+r+n<window.innerHeight?(s=Math.max(n,e.left),i=e.bottom+n):e.top-r-n>0?(s=Math.max(n,e.left),i=e.top-r-n):(s=window.innerWidth-t-n,i=window.innerHeight-r-n),s=Math.max(n,Math.min(s,window.innerWidth-t-n)),i=Math.max(n,Math.min(i,window.innerHeight-r-n)),b({x:s,y:i})},[o,A]);const k=(0,s.useCallback)(e=>{if(e.target.closest("button"))return;w(!0);const t=O.current.getBoundingClientRect();C({x:e.clientX-t.left,y:e.clientY-t.top})},[]),U=(0,s.useCallback)(e=>{if(!A)return;const t=e.clientX-P.x,r=e.clientY-P.y,n=O.current.getBoundingClientRect(),s=window.innerWidth-n.width,o=window.innerHeight-n.height;b({x:Math.max(0,Math.min(t,s)),y:Math.max(0,Math.min(r,o))})},[A,P]),j=(0,s.useCallback)(()=>{w(!1)},[]);return(0,s.useEffect)(()=>{if(A)return document.addEventListener("mousemove",U),document.addEventListener("mouseup",j),()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",j)}},[A,U,j]),(0,u.jsxs)("div",{ref:O,className:"act-coach-panel",style:{position:"fixed",top:v.y,left:v.x,width:"320px",maxHeight:"400px",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",zIndex:9999990,display:"flex",flexDirection:"column",cursor:A?"grabbing":"default"},onMouseDown:k,children:[(0,u.jsx)("div",{className:"act-panel-header",style:{padding:"12px 16px",borderBottom:"1px solid #e0e0e0",cursor:"grab",userSelect:"none"},children:(0,u.jsxs)(c.Flex,{justify:"space-between",align:"center",children:[(0,u.jsxs)(c.FlexBlock,{children:[(0,u.jsx)("strong",{className:"act-panel-title",children:e?.title||(0,i.__)("Step","admin-coach-tours")+` ${t+1}`}),(0,u.jsxs)("div",{className:"act-panel-progress",style:{fontSize:"12px",color:"#666"},children:[`${t+1} / ${r}`,n&&` • ${n}`]})]}),(0,u.jsx)(c.FlexItem,{children:(0,u.jsx)(c.Button,{icon:h,label:(0,i.__)("Close tour","admin-coach-tours"),onClick:I,size:"small"})})]})}),(0,u.jsx)("div",{className:"act-panel-body",style:{padding:"16px",flex:1,overflow:"auto"},children:T?(0,u.jsxs)("div",{className:"act-panel-loading",children:[(0,u.jsx)(c.Spinner,{}),(0,u.jsx)("span",{children:(0,i.__)("Preparing…","admin-coach-tours")})]}):a?(0,u.jsxs)("div",{className:"act-panel-error",children:[(0,u.jsx)("p",{children:(0,i.__)("Could not find the target element. The UI may have changed.","admin-coach-tours")}),(0,u.jsx)(c.Button,{variant:"secondary",onClick:g,children:(0,i.__)("Try Again","admin-coach-tours")})]}):(0,u.jsx)(u.Fragment,{children:e?.content&&(0,u.jsx)("div",{className:"act-panel-content",dangerouslySetInnerHTML:{__html:e.content}})})}),(0,u.jsx)("div",{className:"act-panel-footer",style:{padding:"12px 16px",borderTop:"1px solid #e0e0e0"},children:(0,u.jsx)("div",{className:"act-panel-controls",children:(0,u.jsxs)(c.Flex,{justify:"space-between",align:"center",children:[(0,u.jsx)(c.FlexItem,{children:(0,u.jsx)(c.Button,{icon:l,label:(0,i.__)("Previous","admin-coach-tours"),onClick:_,disabled:L||T,size:"small"})}),(0,u.jsxs)(c.FlexBlock,{style:{textAlign:"center"},children:[(0,u.jsx)(c.Button,{icon:d,label:(0,i.__)("Repeat","admin-coach-tours"),onClick:g,disabled:T,size:"small"}),S?(0,u.jsx)(c.Button,{icon:p,label:(0,i.__)("Resume","admin-coach-tours"),onClick:x,size:"small"}):(0,u.jsx)(c.Button,{icon:E,label:(0,i.__)("Pause","admin-coach-tours"),onClick:R,size:"small"})]}),(0,u.jsx)(c.FlexItem,{children:N||D?(0,u.jsx)(c.Button,{variant:"primary",onClick:f,disabled:T||!!a,size:"small",children:D?(0,i.__)("Finish","admin-coach-tours"):(0,i.__)("Continue","admin-coach-tours")}):(0,u.jsx)(c.Button,{icon:m,label:(0,i.__)("Next","admin-coach-tours"),onClick:y,disabled:T,size:"small"})})]})})})]})}const S={boxShadow:"0 0 0 4px #007cba, 0 0 0 9999px rgba(0, 0, 0, 0.5)",borderRadius:"4px",transition:"all 0.3s ease"};class f{constructor(e={}){this.options={usePulse:!0,overlayColor:"rgba(0, 0, 0, 0.5)",highlightColor:"#007cba",transitionDuration:300,...e},this.spotlightElement=null,this.targetElement=null,this.resizeObserver=null,this.styleElement=null,this._init()}_init(){this.styleElement=document.createElement("style"),this.styleElement.textContent="\n@keyframes act-pulse {\n\t0% {\n\t\tbox-shadow: 0 0 0 4px #007cba, 0 0 0 9999px rgba(0, 0, 0, 0.5);\n\t}\n\t50% {\n\t\tbox-shadow: 0 0 0 8px rgba(0, 124, 186, 0.5), 0 0 0 9999px rgba(0, 0, 0, 0.5);\n\t}\n\t100% {\n\t\tbox-shadow: 0 0 0 4px #007cba, 0 0 0 9999px rgba(0, 0, 0, 0.5);\n\t}\n}\n",document.head.appendChild(this.styleElement),this.spotlightElement=document.createElement("div"),this.spotlightElement.className="act-highlighter-spotlight",this.spotlightElement.setAttribute("aria-hidden","true"),Object.assign(this.spotlightElement.style,{position:"fixed",pointerEvents:"none",zIndex:9999980,...S}),this.spotlightElement.style.display="none",document.body.appendChild(this.spotlightElement),this.resizeObserver=new ResizeObserver(()=>{this._updatePosition()})}highlight(e){e&&e.isConnected?(this.targetElement&&this.resizeObserver.unobserve(this.targetElement),this.targetElement=e,this.resizeObserver.observe(e),this._updatePosition(),this.spotlightElement.style.display="block",this.options.usePulse&&(this.spotlightElement.style.animation="act-pulse 2s infinite"),this._addScrollListeners()):this.clear()}_updatePosition(){if(!this.targetElement||!this.spotlightElement)return;const e=this.targetElement.getBoundingClientRect();Object.assign(this.spotlightElement.style,{top:e.top-4+"px",left:e.left-4+"px",width:`${e.width+8}px`,height:`${e.height+8}px`})}_addScrollListeners(){this._scrollHandler=()=>{this._updatePosition()};let e=this.targetElement?.parentElement;for(;e;)e.scrollHeight>e.clientHeight&&e.addEventListener("scroll",this._scrollHandler,{passive:!0}),e=e.parentElement;window.addEventListener("scroll",this._scrollHandler,{passive:!0}),window.addEventListener("resize",this._scrollHandler,{passive:!0})}_removeScrollListeners(){if(!this._scrollHandler)return;let e=this.targetElement?.parentElement;for(;e;)e.removeEventListener("scroll",this._scrollHandler),e=e.parentElement;window.removeEventListener("scroll",this._scrollHandler),window.removeEventListener("resize",this._scrollHandler),this._scrollHandler=null}clear(){this.targetElement&&(this.resizeObserver.unobserve(this.targetElement),this._removeScrollListeners(),this.targetElement=null),this.spotlightElement&&(this.spotlightElement.style.display="none",this.spotlightElement.style.animation="none")}async transitionTo(e){this.targetElement?(this.targetElement&&(this.resizeObserver.unobserve(this.targetElement),this._removeScrollListeners()),this.targetElement=e,e&&e.isConnected?(this.resizeObserver.observe(e),this._addScrollListeners(),await new Promise(e=>{requestAnimationFrame(()=>{this._updatePosition(),setTimeout(e,this.options.transitionDuration)})})):this.clear()):this.highlight(e)}setStyle(e){if(!this.spotlightElement)return;const t={default:"#007cba",success:"#00a32a",warning:"#dba617",error:"#d63638"},r=t[e]||t.default;this.spotlightElement.style.boxShadow=`0 0 0 4px ${r}, 0 0 0 9999px rgba(0, 0, 0, 0.5)`}async flash(){this.spotlightElement&&(this.setStyle("success"),await new Promise(e=>{setTimeout(()=>{this.setStyle("default"),e()},300)}))}destroy(){this.clear(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.spotlightElement&&this.spotlightElement.parentNode&&(this.spotlightElement.parentNode.removeChild(this.spotlightElement),this.spotlightElement=null),this.styleElement&&this.styleElement.parentNode&&(this.styleElement.parentNode.removeChild(this.styleElement),this.styleElement=null)}}function g(e){if(!e)return!1;if(!e.isConnected)return!1;const t=window.getComputedStyle(e);if("none"===t.display||"hidden"===t.visibility||"0"===t.opacity)return!1;const r=e.getBoundingClientRect();return 0!==r.width||0!==r.height}function _(e,t){if(!t)return!0;const r=document.querySelector(t);return!!r&&r.contains(e)}function y(e){try{return Array.from(document.querySelectorAll(e))}catch{return[]}}function R(e){switch(e.type){case"css":return y(e.value);case"role":return function(e){const[t,r]=e.split(":").map(e=>e.trim()),n=Array.from(document.querySelectorAll(`[role="${t}"]`)),s={button:'button, input[type="button"], input[type="submit"]',textbox:'input[type="text"], input:not([type]), textarea',link:"a[href]",checkbox:'input[type="checkbox"]',radio:'input[type="radio"]',listbox:"select",option:"option",heading:"h1, h2, h3, h4, h5, h6",img:"img[alt]",navigation:"nav",main:"main",complementary:"aside",banner:"header",contentinfo:"footer",search:'[role="search"]',form:"form",region:"section[aria-label], section[aria-labelledby]",tab:'[role="tab"]',tabpanel:'[role="tabpanel"]',tablist:'[role="tablist"]',menu:'[role="menu"]',menuitem:'[role="menuitem"]',dialog:'dialog, [role="dialog"]'};let o=[];s[t]&&(o=Array.from(document.querySelectorAll(s[t])));const i=[...n,...o];return r?i.filter(e=>{const t=function(e){if(e.getAttribute("aria-label"))return e.getAttribute("aria-label");const t=e.getAttribute("aria-labelledby");if(t){const e=document.getElementById(t);if(e)return e.textContent?.trim()||""}if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t)return t.textContent?.trim()||""}return e.getAttribute("title")?e.getAttribute("title"):"BUTTON"===e.tagName||"A"===e.tagName||"button"===e.getAttribute("role")?e.textContent?.trim()||"":"INPUT"===e.tagName&&e.value?e.value:""}(e);return t&&t.toLowerCase().includes(r.toLowerCase())}):i}(e.value);case"testId":return r=e.value,Array.from(document.querySelectorAll(`[data-testid="${r}"]`));case"dataAttribute":return function(e){const[t,r]=e.split(":").map(e=>e.trim()),n=r?`[data-${t}="${r}"]`:`[data-${t}]`;try{return Array.from(document.querySelectorAll(n))}catch{return[]}}(e.value);case"ariaLabel":return t=e.value,Array.from(document.querySelectorAll("[aria-label]")).filter(e=>{const r=e.getAttribute("aria-label");return r&&r.toLowerCase().includes(t.toLowerCase())});case"contextual":return function(e){const t=e.split(">>").map(e=>e.trim());if(2===t.length){const[e,r]=t,n=document.querySelector(e);return n?Array.from(n.querySelectorAll(r)):[]}return y(e)}(e.value);default:return[]}var t,r}function x(e,t,r){let n=t.weight||50;return e.id&&(n+=20),e.getAttribute("data-testid")&&(n+=15),r?.withinContainer&&_(e,r.withinContainer)&&(n+=10),g(e)&&(n+=5),n}function I(e){if(!e||!e.locators||0===e.locators.length)return{success:!1,error:"No locators provided"};const t=e.constraints||{},r=[...e.locators].sort((e,t)=>e.fallback!==t.fallback?e.fallback?1:-1:(t.weight||50)-(e.weight||50)),n=r.filter(e=>!e.fallback),s=r.filter(e=>e.fallback);for(const e of[...n,...s]){let r=R(e);if(!1!==t.visible&&(r=r.filter(g)),t.withinContainer&&(r=r.filter(e=>_(e,t.withinContainer))),0===r.length)continue;if(1===r.length)return{success:!0,element:r[0],usedLocator:e};if("number"==typeof t.index&&r[t.index])return{success:!0,element:r[t.index],usedLocator:e};const n=r.map(r=>({element:r,score:x(r,e,t)}));return n.sort((e,t)=>t.score-e.score),{success:!0,element:n[0].element,usedLocator:e}}return{success:!1,error:"No matching element found"}}async function v(e,t=2e3){const r=Date.now();return new Promise(n=>{const s=()=>{const o=document.querySelector(e);o?n(o):Date.now()-r>t?n(null):requestAnimationFrame(s)};s()})}async function b(e,t=2e3){const r=Date.now();return new Promise(n=>{const s=()=>{try{if(e())return void n(!0)}catch{}Date.now()-r>t?n(!1):requestAnimationFrame(s)};s()})}const A={ensureEditor:async function(){const e=(0,o.select)("core/block-editor");return!!e&&b(()=>{const t=e.getBlocks?.();return void 0!==t})},ensureSidebarOpen:async function(e=null){const t=(0,o.select)("core/edit-post"),r=(0,o.dispatch)("core/edit-post");if(!t||!r){const t=(0,o.select)("core/interface"),r=(0,o.dispatch)("core/interface");if(t&&r){const n=t.getActiveComplementaryArea?.("core/edit-post");return n||await(r.enableComplementaryArea?.("core/edit-post",e||"edit-post/document")),b(()=>!!t.getActiveComplementaryArea?.("core/edit-post"))}return!1}if(t.isEditorSidebarOpened?.()||t.isPluginSidebarOpened?.())return!0;try{return e?await(r.openGeneralSidebar?.(e)):await(r.openGeneralSidebar?.("edit-post/document")),b(()=>t.isEditorSidebarOpened?.())}catch{return!1}},ensureSidebarClosed:async function(){const e=(0,o.select)("core/edit-post"),t=(0,o.dispatch)("core/edit-post");if(!e||!t){const e=(0,o.select)("core/interface"),t=(0,o.dispatch)("core/interface");if(e&&t){const r=e.getActiveComplementaryArea?.("core/edit-post");return r&&await(t.disableComplementaryArea?.("core/edit-post")),b(()=>!e.getActiveComplementaryArea?.("core/edit-post"))}return!1}const r=e.isEditorSidebarOpened?.();if(!r)return!0;try{return await(t.closeGeneralSidebar?.()),b(()=>!e.isEditorSidebarOpened?.())}catch{return!1}},selectSidebarTab:async function(e){const t=(0,o.dispatch)("core/edit-post");if(!t)return!1;const r={document:"edit-post/document",post:"edit-post/document",block:"edit-post/block"}[e]||e;try{return await(t.openGeneralSidebar?.(r)),b(()=>{const e=(0,o.select)("core/edit-post");return e?.getActiveGeneralSidebarName?.()===r})}catch{return!1}},openInserter:async function(){const e=(0,o.select)("core/edit-post"),t=(0,o.dispatch)("core/edit-post");if(e?.isInserterOpened?.())return!0;try{return await(t?.setIsInserterOpened?.(!0)),b(()=>e?.isInserterOpened?.())}catch{const e=document.querySelector('.edit-post-header-toolbar__inserter-toggle, button[aria-label*="inserter"], button[aria-label*="Add block"]');return!!e&&(e.click(),v(".block-editor-inserter__content, .editor-inserter__content").then(e=>!!e))}},closeInserter:async function(){const e=(0,o.select)("core/edit-post"),t=(0,o.dispatch)("core/edit-post");if(!e?.isInserterOpened?.())return!0;try{return await(t?.setIsInserterOpened?.(!1)),b(()=>!e?.isInserterOpened?.())}catch{return!1}},selectBlock:async function(e){const t=(0,o.dispatch)("core/block-editor");if(!t||!e)return!1;try{return await(t.selectBlock?.(e)),b(()=>{const t=(0,o.select)("core/block-editor");return t?.getSelectedBlockClientId?.()===e})}catch{return!1}},focusElement:async function(e){const t=await v(e);if(!t)return!1;try{return t.focus(),document.activeElement===t}catch{return!1}},scrollIntoView:async function(e){const t=await v(e);if(!t)return!1;try{return t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),await new Promise(e=>setTimeout(e,300)),!0}catch{return!1}},openModal:async function(e,t){if(document.querySelector(t))return!0;const r=await v(e);return!!r&&(r.click(),v(t).then(e=>!!e))},closeModal:async function(e){const t=document.querySelector(e);if(!t)return!0;const r=t.querySelector('button[aria-label="Close"], .components-modal__header button, .components-popover__close');return r?(r.click(),b(()=>!document.querySelector(e))):(document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape",code:"Escape",bubbles:!0})),b(()=>!document.querySelector(e)))}};async function w(e){const{type:t,params:r={}}=e,n=A[t];if(!n)return{success:!1,error:`Unknown precondition type: ${t}`,type:t};try{let e;switch(t){case"ensureEditor":case"ensureSidebarClosed":case"openInserter":case"closeInserter":e=await n();break;case"ensureSidebarOpen":e=await n(r.sidebar);break;case"selectSidebarTab":e=await n(r.tab);break;case"selectBlock":e=await n(r.clientId);break;case"focusElement":case"scrollIntoView":e=await n(r.selector);break;case"openModal":e=await n(r.trigger,r.modal);break;case"closeModal":e=await n(r.modal);break;default:e=!1}return{success:e,type:t,error:e?null:`Precondition failed: ${t}`}}catch(e){return{success:!1,type:t,error:`Precondition error: ${e.message}`}}}async function P(e){if(!e||0===e.length)return{success:!0,results:[]};const t=[];let r=!0;for(const n of e){const e=await w(n);t.push(e),e.success||(r=!1)}return{success:r,results:t,failedPreconditions:t.filter(e=>!e.success)}}function C(e,t=0){return new Promise(r=>{let n=null,s=null,o=!1;const i=(e,t=!1)=>{o||(o=!0,n&&clearTimeout(n),s&&clearInterval(s),r({success:e,timedOut:t}))};t>0&&(n=setTimeout(()=>{i(!1,!0)},t));const c=()=>{try{e()&&i(!0)}catch{}};c(),o||(s=setInterval(c,100))})}function O(e,t={}){return new Promise(r=>{let n=!1;const{timeout:s=0}=t;let o=null;const i=()=>{e.removeEventListener("click",c),o&&clearTimeout(o)},c=t=>{n||(e===t.target||e.contains(t.target))&&(n=!0,i(),r({success:!0,event:"click"}))};e.addEventListener("click",c,{capture:!0}),s>0&&(o=setTimeout(()=>{n||(n=!0,i(),r({success:!1,timedOut:!0}))},s))})}function L(e,t={}){return new Promise(r=>{let n=!1;const{timeout:s=0,expectedValue:o,attributeName:i=null}=t;let c=null,a=null;const u=()=>{a&&a.disconnect(),e.removeEventListener("input",E),e.removeEventListener("change",m),c&&clearTimeout(c)},l=()=>i?e.getAttribute(i):"value"in e?e.value:e.isContentEditable?e.textContent:"checkbox"===e.type||"radio"===e.type?e.checked:e.textContent,d=l(),p=()=>{n||(()=>{const e=l();return void 0!==o?e===o:e!==d})()&&(n=!0,u(),r({success:!0,event:"valueChanged"}))},E=()=>p(),m=()=>p();e.addEventListener("input",E),e.addEventListener("change",m),a=new MutationObserver(()=>p()),a.observe(e,{attributes:!0,characterData:!0,subtree:!0,childList:!0}),s>0&&(c=setTimeout(()=>{n||(n=!0,u(),r({success:!1,timedOut:!0}))},s))})}function D(e={}){const{storeName:t,selector:r,args:n=[],expectedValue:s,comparator:i="equals",timeout:c=0}=e;return new Promise(e=>{let a=!1,u=null,l=null;const d=()=>{l&&l(),u&&clearTimeout(u)},p=(0,o.select)(t);if(!p||!p[r])return void e({success:!1,error:`Invalid store or selector: ${t}.${r}`});const E=()=>{a||(()=>{try{const e=p[r](...n);switch(i){case"equals":default:return e===s;case"notEquals":return e!==s;case"truthy":return!!e;case"falsy":return!e;case"contains":return(Array.isArray(e)||"string"==typeof e)&&e.includes(s);case"greaterThan":return e>s;case"lessThan":return e<s;case"lengthEquals":return e?.length===s;case"lengthGreaterThan":return e?.length>s}}catch{return!1}})()&&(a=!0,d(),e({success:!0,event:"wpDataChanged"}))};E(),a||(l=(0,o.subscribe)(()=>{E()})),c>0&&(u=setTimeout(()=>{a||(a=!0,d(),e({success:!1,timedOut:!0}))},c))})}function N(e={}){const{timeout:t=0}=e;let r=null,n=null,s=!1;return{promise:new Promise(e=>{r=e,t>0&&(n=setTimeout(()=>{s||(s=!0,e({success:!1,timedOut:!0}))},t))}),confirm:()=>{s||(s=!0,n&&clearTimeout(n),r({success:!0,event:"manual"}))},cancel:()=>{s||(s=!0,n&&clearTimeout(n),r({success:!1,cancelled:!0}))}}}function k(e,t={}){const{timeout:r=0}=t;return C(()=>null!==document.querySelector(e),r).then(e=>({...e,event:e.success?"elementAppeared":null}))}function U(e,t={}){const{timeout:r=0}=t;return C(()=>null===document.querySelector(e),r).then(e=>({...e,event:e.success?"elementDisappeared":null}))}function j(e,t={}){const{timeout:r=0,target:n=document}=t;return new Promise(t=>{let s=!1,o=null;const i=()=>{n.removeEventListener(e,c),o&&clearTimeout(o)},c=r=>{s||(s=!0,i(),t({success:!0,event:e,detail:r.detail}))};n.addEventListener(e,c,{once:!0}),r>0&&(o=setTimeout(()=>{s||(s=!0,i(),t({success:!1,timedOut:!0}))},r))})}const M="admin-coach-tours";function V(){const[e,t]=(0,s.useState)(null),[r,n]=(0,s.useState)(null),[i,c]=(0,s.useState)(!1),[a,l]=(0,s.useState)(null),d=(0,s.useRef)(null),{isPlaying:p,isPaused:E,currentTour:m,currentStep:h,stepIndex:S,totalSteps:g}=(0,o.useSelect)(e=>{const t=e(M);return{isPlaying:t.isPlaying(),isPaused:t.isPaused?.()||!1,currentTour:t.getCurrentTour(),currentStep:t.getCurrentStep(),stepIndex:t.getCurrentStepIndex?.()||0,totalSteps:t.getTotalSteps?.()||0}},[]),{pauseTour:_,resumeTour:y,stopTour:R,nextStep:x,previousStep:v,repeatStep:b,setResolution:A,markStepComplete:w}=(0,o.useDispatch)(M);(0,s.useEffect)(()=>(d.current||(d.current=new f),()=>{d.current&&(d.current.destroy(),d.current=null)}),[]),(0,s.useEffect)(()=>{if(!p||!h)return d.current&&d.current.clear(),void t(null);let r=!0;return(async()=>{if(n(null),c(!0),a?.cancel&&a.cancel(),h.preconditions?.length>0){const e=await P(h.preconditions);if(!r)return;e.success||console.warn("Some preconditions failed:",e.failedPreconditions)}if(c(!1),h.target){const e=h.recovery?async()=>{await P(h.recovery)}:null,s=await async function(e,t=null){let r=I(e);if(r.success)return r;if(t)try{if(await t(),await new Promise(e=>setTimeout(e,100)),r=I(e),r.success)return{...r,recovered:!0}}catch(e){return{success:!1,error:`Recovery failed: ${e.message}`}}return r}(h.target,e);if(!r)return;s.success?(t(s.element),A({success:!0,usedLocator:s.usedLocator,recovered:s.recovered||!1}),d.current&&d.current.highlight(s.element),s.element.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})):(t(null),n(s.error),A({success:!1,error:s.error}),d.current&&d.current.clear())}if(h.completion){const t=function(e,t=null){if(!e||!e.type)return N();const{type:r,params:n={}}=e,s=e.timeout||0;switch(r){case"clickTarget":return t?{promise:O(t,{timeout:s}),cancel:()=>{}}:{promise:Promise.resolve({success:!1,error:"No target element for clickTarget"}),cancel:()=>{}};case"domValueChanged":return t?{promise:L(t,{timeout:s,...n}),cancel:()=>{}}:{promise:Promise.resolve({success:!1,error:"No target element for domValueChanged"}),cancel:()=>{}};case"wpData":return{promise:D({timeout:s,...n}),cancel:()=>{}};case"manual":default:return N({timeout:s});case"elementAppear":return{promise:k(n.selector,{timeout:s}),cancel:()=>{}};case"elementDisappear":return{promise:U(n.selector,{timeout:s}),cancel:()=>{}};case"customEvent":return{promise:j(n.eventName,{timeout:s}),cancel:()=>{}}}}(h.completion,e);l(t),t.promise.then(e=>{r&&e.success&&(w(h.id),S<g-1&&setTimeout(()=>{r&&x()},500))})}})(),()=>{r=!1,a?.cancel&&a.cancel()}},[p,h,S]);const C=(0,s.useCallback)(()=>{a?.confirm?a.confirm():(w(h?.id),x())},[a,h,w,x]),V=(0,s.useCallback)(()=>{a?.cancel&&a.cancel(),b()},[a,b]),F=(0,s.useCallback)(()=>{a?.cancel&&a.cancel(),R()},[a,R]);if(!p||!m||!h)return null;const G=(0,u.jsx)(T,{step:h,stepIndex:S,totalSteps:g,tourTitle:m.title,targetElement:e,resolutionError:r,isApplyingPreconditions:i,isPaused:E,onContinue:C,onRepeat:V,onPrevious:v,onNext:x,onPause:_,onResume:y,onStop:F});return(0,s.createPortal)(G,document.body)}const F={SET_TOURS_LOADING:"SET_TOURS_LOADING",SET_TOURS_ERROR:"SET_TOURS_ERROR",RECEIVE_TOURS:"RECEIVE_TOURS",RECEIVE_TOUR:"RECEIVE_TOUR",START_TOUR:"START_TOUR",END_TOUR:"END_TOUR",SET_CURRENT_STEP:"SET_CURRENT_STEP",NEXT_STEP:"NEXT_STEP",PREVIOUS_STEP:"PREVIOUS_STEP",SKIP_STEP:"SKIP_STEP",REPEAT_STEP:"REPEAT_STEP",SET_MODE:"SET_MODE",SET_COMPLETION_SATISFIED:"SET_COMPLETION_SATISFIED",RESET_COMPLETION:"RESET_COMPLETION",SET_RESOLVED_TARGET:"SET_RESOLVED_TARGET",CLEAR_RESOLVED_TARGET:"CLEAR_RESOLVED_TARGET",SET_RECOVERING:"SET_RECOVERING",INCREMENT_RESOLUTION_ATTEMPTS:"INCREMENT_RESOLUTION_ATTEMPTS",SET_LAST_ERROR:"SET_LAST_ERROR",ACTIVATE_PICKER:"ACTIVATE_PICKER",DEACTIVATE_PICKER:"DEACTIVATE_PICKER",SELECT_STEP:"SELECT_STEP",SET_PENDING_CHANGES:"SET_PENDING_CHANGES",UPDATE_STEP:"UPDATE_STEP",ADD_STEP:"ADD_STEP",DELETE_STEP:"DELETE_STEP",REORDER_STEPS:"REORDER_STEPS",SET_AI_DRAFT_LOADING:"SET_AI_DRAFT_LOADING",SET_AI_DRAFT_ERROR:"SET_AI_DRAFT_ERROR",SET_AI_DRAFT_RESULT:"SET_AI_DRAFT_RESULT",CLEAR_AI_DRAFT:"CLEAR_AI_DRAFT",SET_SIDEBAR_OPEN:"SET_SIDEBAR_OPEN"},G=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});function B(e){return{type:F.SET_TOURS_LOADING,isLoading:e}}function H(e){return{type:F.SET_TOURS_ERROR,error:e}}function q(e){return{type:F.RECEIVE_TOURS,tours:e}}function z(e){return{type:F.RECEIVE_TOUR,tour:e}}function $(e={}){return{type:"FETCH_TOURS",args:e}}function K(e){return{type:"FETCH_TOUR",tourId:e}}function X(e){return{type:"SAVE_TOUR",tourId:e}}function W(e,t="pupil"){return{type:F.START_TOUR,tourId:e,mode:t}}function Z(){return{type:F.END_TOUR}}function Q(e){return{type:F.SET_CURRENT_STEP,stepIndex:e}}function Y(){return{type:F.NEXT_STEP}}function J(){return{type:F.PREVIOUS_STEP}}function ee(){return{type:F.SKIP_STEP}}function te(){return{type:F.REPEAT_STEP}}function re(e){return{type:F.SET_MODE,mode:e}}function ne(e){return{type:F.SET_COMPLETION_SATISFIED,satisfied:e}}function se(){return{type:F.RESET_COMPLETION}}function oe(e){return{type:F.SET_RESOLVED_TARGET,target:e}}function ie(){return{type:F.CLEAR_RESOLVED_TARGET}}function ce(e){return{type:F.SET_RECOVERING,isRecovering:e}}function ae(){return{type:F.INCREMENT_RESOLUTION_ATTEMPTS}}function ue(e){return{type:F.SET_LAST_ERROR,error:e}}function le(){return{type:F.ACTIVATE_PICKER}}function de(){return{type:F.DEACTIVATE_PICKER}}function pe(e){return{type:F.SELECT_STEP,stepId:e}}function Ee(e){return{type:F.SET_PENDING_CHANGES,pending:e}}function me(e,t,r){return{type:F.UPDATE_STEP,tourId:e,stepId:t,updates:r}}function he(e,t={},r=null){const n={id:G(),order:0,title:"",instruction:"",hint:"",target:{locators:[],constraints:{visible:!0}},preconditions:[],completion:{type:"manual"},recovery:[{action:"reapplyPreconditions",timeout:1e3}],tags:[],version:1,...t};return{type:F.ADD_STEP,tourId:e,step:n,index:r}}function Te(e,t){return{type:F.DELETE_STEP,tourId:e,stepId:t}}function Se(e,t){return{type:F.REORDER_STEPS,tourId:e,stepIds:t}}function fe(e){return{type:F.SET_AI_DRAFT_LOADING,isLoading:e}}function ge(e){return{type:F.SET_AI_DRAFT_ERROR,error:e}}function _e(e){return{type:F.SET_AI_DRAFT_RESULT,result:e}}function ye(){return{type:F.CLEAR_AI_DRAFT}}function Re(e,t){return{type:"REQUEST_AI_DRAFT",elementContext:e,postType:t}}function xe(e){return{type:F.SET_SIDEBAR_OPEN,isOpen:e}}function Ie(e){return Object.values(e.tours)}function ve(e){return e.tours}function be(e,t){return e.tours[t]||null}function Ae(e){return e.toursLoading}function we(e){return e.toursError}function Pe(e,t){return Ie(e).filter(e=>e.postTypes&&e.postTypes.includes(t)&&"publish"===e.status)}function Ce(e,t){return Ie(e).filter(e=>e.editor===t&&"publish"===e.status)}function Oe(e){return e.currentTourId}function Le(e){return e.currentTourId?e.tours[e.currentTourId]:null}function De(e){return e.currentStepIndex}function Ne(e){const t=Le(e);return t&&t.steps&&t.steps[e.currentStepIndex]||null}function ke(e){const t=Le(e);return t?.steps?.length||0}function Ue(e){return e.currentStepIndex<ke(e)-1}function je(e){return e.currentStepIndex>0}function Me(e){const t=ke(e);return 0===t?0:Math.round((e.currentStepIndex+1)/t*100)}function Ve(e){return e.mode}function Fe(e){return"educator"===e.mode}function Ge(e){return"pupil"===e.mode}function Be(e){return null!==e.currentTourId&&null!==e.mode}function He(e){return e.completionSatisfied}function qe(e){return e.skippedSteps}function ze(e,t){return e.skippedSteps.includes(t)}function $e(e){return e.resolvedTarget}function Ke(e){return e.isRecovering}function Xe(e){return e.resolutionAttempts}function We(e){return e.lastError}function Ze(e){return e.isPickerActive}function Qe(e){return e.selectedStepId}function Ye(e){const t=Le(e);return t&&e.selectedStepId?t.steps.find(t=>t.id===e.selectedStepId):null}function Je(e){return e.pendingChanges}function et(e){return e.aiDraftLoading}function tt(e){return e.aiDraftError}function rt(e){return e.aiDraftResult}function nt(e){return e.sidebarOpen}const st=window.wp.apiFetch;var ot=e.n(st);function*it(){yield B(!0);try{const e=yield{type:"API_FETCH",request:{path:"/admin-coach-tours/v1/tours",method:"GET"}};yield q(e)}catch(e){yield H(e.message||"Failed to fetch tours")}}function*ct(e){yield B(!0);try{const t=yield{type:"API_FETCH",request:{path:`/admin-coach-tours/v1/tours/${e}`,method:"GET"}};yield z(t)}catch(e){yield H(e.message||"Failed to fetch tour")}}function*at(e){yield B(!0);try{const t=yield{type:"API_FETCH",request:{path:`/admin-coach-tours/v1/tours?post_type=${e}&editor=block`,method:"GET"}};yield q(t)}catch(e){yield H(e.message||"Failed to fetch tours")}}const ut={API_FETCH:e=>ot()(e.request),FETCH_TOUR:e=>ot()({path:`/admin-coach-tours/v1/tours/${e.tourId}`,method:"GET"}),FETCH_TOURS(e){const t=new URLSearchParams;e.args.postType&&t.append("post_type",e.args.postType),e.args.editor&&t.append("editor",e.args.editor);const r=t.toString(),n="/admin-coach-tours/v1/tours"+(r?`?${r}`:"");return ot()({path:n,method:"GET"})},SAVE_TOUR:e=>async({select:t})=>{const r=t.getTour(e.tourId);if(!r)throw new Error("Tour not found");return ot()({path:`/admin-coach-tours/v1/tours/${e.tourId}`,method:"PUT",data:{title:r.title,editor:r.editor,postTypes:r.postTypes,steps:r.steps}})},REQUEST_AI_DRAFT:e=>ot()({path:"/admin-coach-tours/v1/ai/draft-step",method:"POST",data:{elementContext:e.elementContext,postType:e.postType}})},lt={tours:{},toursLoading:!1,toursError:null,currentTourId:null,currentStepIndex:0,mode:null,completionSatisfied:!1,skippedSteps:[],isPickerActive:!1,selectedStepId:null,pendingChanges:!1,tourProgress:{},isRecovering:!1,lastError:null,resolvedTarget:null,resolutionAttempts:0,sidebarOpen:!1,aiDraftLoading:!1,aiDraftError:null,aiDraftResult:null},dt=(0,o.createReduxStore)("admin-coach-tours",{reducer:function(e=lt,t){switch(t.type){case F.SET_TOURS_LOADING:return{...e,toursLoading:t.isLoading};case F.SET_TOURS_ERROR:return{...e,toursError:t.error,toursLoading:!1};case F.RECEIVE_TOURS:return{...e,tours:t.tours.reduce((e,t)=>(e[t.id]=t,e),{...e.tours}),toursLoading:!1,toursError:null};case F.RECEIVE_TOUR:return{...e,tours:{...e.tours,[t.tour.id]:t.tour},toursLoading:!1};case F.START_TOUR:return{...e,currentTourId:t.tourId,currentStepIndex:0,mode:t.mode||"pupil",completionSatisfied:!1,skippedSteps:[],lastError:null,resolutionAttempts:0};case F.END_TOUR:return{...e,currentTourId:null,currentStepIndex:0,mode:null,completionSatisfied:!1,resolvedTarget:null,isRecovering:!1,lastError:null};case F.SET_CURRENT_STEP:return{...e,currentStepIndex:t.stepIndex,completionSatisfied:!1,resolvedTarget:null,resolutionAttempts:0,lastError:null};case F.NEXT_STEP:{const t=e.tours[e.currentTourId],r=e.currentStepIndex+1;return t&&r<t.steps.length?{...e,currentStepIndex:r,completionSatisfied:!1,resolvedTarget:null,resolutionAttempts:0,lastError:null}:{...e,currentTourId:null,currentStepIndex:0,mode:null,completionSatisfied:!1,resolvedTarget:null}}case F.PREVIOUS_STEP:return{...e,currentStepIndex:Math.max(0,e.currentStepIndex-1),completionSatisfied:!1,resolvedTarget:null,resolutionAttempts:0};case F.SKIP_STEP:{const t=e.tours[e.currentTourId],r=t?.steps[e.currentStepIndex],n=e.currentStepIndex+1,s=t&&n<t.steps.length,o=r?[...e.skippedSteps,r.id]:e.skippedSteps;return s?{...e,currentStepIndex:n,skippedSteps:o,completionSatisfied:!1,resolvedTarget:null,resolutionAttempts:0}:{...e,skippedSteps:o,currentTourId:null,currentStepIndex:0,mode:null}}case F.REPEAT_STEP:return{...e,completionSatisfied:!1,resolvedTarget:null,resolutionAttempts:0,lastError:null,isRecovering:!1};case F.SET_MODE:return{...e,mode:t.mode};case F.SET_COMPLETION_SATISFIED:return{...e,completionSatisfied:t.satisfied};case F.RESET_COMPLETION:return{...e,completionSatisfied:!1};case F.SET_RESOLVED_TARGET:return{...e,resolvedTarget:t.target,lastError:null};case F.CLEAR_RESOLVED_TARGET:return{...e,resolvedTarget:null};case F.SET_RECOVERING:return{...e,isRecovering:t.isRecovering};case F.INCREMENT_RESOLUTION_ATTEMPTS:return{...e,resolutionAttempts:e.resolutionAttempts+1};case F.SET_LAST_ERROR:return{...e,lastError:t.error};case F.ACTIVATE_PICKER:return{...e,isPickerActive:!0};case F.DEACTIVATE_PICKER:return{...e,isPickerActive:!1};case F.SELECT_STEP:return{...e,selectedStepId:t.stepId};case F.SET_PENDING_CHANGES:return{...e,pendingChanges:t.pending};case F.UPDATE_STEP:{const r=e.tours[t.tourId];if(!r)return e;const n=r.steps.map(e=>e.id===t.stepId?{...e,...t.updates}:e);return{...e,tours:{...e.tours,[t.tourId]:{...r,steps:n}},pendingChanges:!0}}case F.ADD_STEP:{var r;const n=e.tours[t.tourId];if(!n)return e;const s=[...n.steps],o=null!==(r=t.index)&&void 0!==r?r:s.length;return s.splice(o,0,t.step),s.forEach((e,t)=>{e.order=t}),{...e,tours:{...e.tours,[t.tourId]:{...n,steps:s}},selectedStepId:t.step.id,pendingChanges:!0}}case F.DELETE_STEP:{const r=e.tours[t.tourId];if(!r)return e;const n=r.steps.filter(e=>e.id!==t.stepId);return n.forEach((e,t)=>{e.order=t}),{...e,tours:{...e.tours,[t.tourId]:{...r,steps:n}},selectedStepId:e.selectedStepId===t.stepId?null:e.selectedStepId,pendingChanges:!0}}case F.REORDER_STEPS:{const r=e.tours[t.tourId];if(!r)return e;const n={};r.steps.forEach(e=>{n[e.id]=e});const s=t.stepIds.map((e,t)=>({...n[e],order:t}));return{...e,tours:{...e.tours,[t.tourId]:{...r,steps:s}},pendingChanges:!0}}case F.SET_AI_DRAFT_LOADING:return{...e,aiDraftLoading:t.isLoading,aiDraftError:t.isLoading?null:e.aiDraftError};case F.SET_AI_DRAFT_ERROR:return{...e,aiDraftError:t.error,aiDraftLoading:!1};case F.SET_AI_DRAFT_RESULT:return{...e,aiDraftResult:t.result,aiDraftLoading:!1,aiDraftError:null};case F.CLEAR_AI_DRAFT:return{...e,aiDraftResult:null,aiDraftError:null,aiDraftLoading:!1};case F.SET_SIDEBAR_OPEN:return{...e,sidebarOpen:t.isOpen};default:return e}},actions:t,selectors:r,resolvers:n,controls:ut,initialState:lt});function pt(){const e=document.createElement("div");e.id="admin-coach-tours-pupil",document.body.appendChild(e),(0,s.render)((0,u.jsx)(V,{}),e);const t=new URLSearchParams(window.location.search).get("act_tour");t&&setTimeout(()=>{(0,o.dispatch)("admin-coach-tours").startTour(parseInt(t,10))},500)}(0,o.register)(dt),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",pt):pt()})();