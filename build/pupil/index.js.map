{"version":3,"file":"pupil/index.js","mappings":"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","sources":["webpack://admin-coach-tours/./assets/js/pupil/CoachPanel.jsx","webpack://admin-coach-tours/./assets/js/pupil/Highlighter.js","webpack://admin-coach-tours/./assets/js/pupil/PupilLauncher.jsx","webpack://admin-coach-tours/./assets/js/pupil/TourRunner.jsx","webpack://admin-coach-tours/./assets/js/runtime/applyPreconditions.js","webpack://admin-coach-tours/./assets/js/runtime/ensureEmptyPlaceholder.js","webpack://admin-coach-tours/./assets/js/runtime/gatherEditorContext.js","webpack://admin-coach-tours/./assets/js/runtime/resolveTarget.js","webpack://admin-coach-tours/./assets/js/runtime/waitForNextStepBlock.js","webpack://admin-coach-tours/./assets/js/runtime/watchCompletion.js","webpack://admin-coach-tours/./assets/js/store/actions.js","webpack://admin-coach-tours/./assets/js/store/controls.js","webpack://admin-coach-tours/./assets/js/store/index.js","webpack://admin-coach-tours/./assets/js/store/reducer.js","webpack://admin-coach-tours/./assets/js/store/resolvers.js","webpack://admin-coach-tours/./assets/js/store/selectors.js","webpack://admin-coach-tours/./node_modules/@wordpress/icons/build-module/library/arrow-right.mjs","webpack://admin-coach-tours/./node_modules/@wordpress/icons/build-module/library/close.mjs","webpack://admin-coach-tours/external window [\"wp\",\"apiFetch\"]","webpack://admin-coach-tours/external window [\"wp\",\"blocks\"]","webpack://admin-coach-tours/external window [\"wp\",\"components\"]","webpack://admin-coach-tours/external window [\"wp\",\"data\"]","webpack://admin-coach-tours/external window [\"wp\",\"element\"]","webpack://admin-coach-tours/external window [\"wp\",\"i18n\"]","webpack://admin-coach-tours/external window [\"wp\",\"primitives\"]","webpack://admin-coach-tours/external window \"ReactJSXRuntime\"","webpack://admin-coach-tours/webpack/bootstrap","webpack://admin-coach-tours/webpack/runtime/compat get default export","webpack://admin-coach-tours/webpack/runtime/create fake namespace object","webpack://admin-coach-tours/webpack/runtime/define property getters","webpack://admin-coach-tours/webpack/runtime/hasOwnProperty shorthand","webpack://admin-coach-tours/webpack/runtime/make namespace object","webpack://admin-coach-tours/./assets/js/pupil/index.js"],"sourcesContent":["/**\n * Coach Panel Component.\n *\n * Floating panel showing step content and navigation controls.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { useState, useEffect, useCallback, useRef } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tButton,\n\tSpinner,\n\tFlex,\n\tFlexItem,\n\tFlexBlock,\n} from '@wordpress/components';\nimport { arrowRight, close } from '@wordpress/icons';\n\n/**\n * @typedef {import('../types/step.js').Step} Step\n */\n\n/**\n * Coach Panel component.\n *\n * @param {Object}           props                          Component props.\n * @param {Step}             props.step                     Current step.\n * @param {number}           props.stepIndex                Current step index (0-based).\n * @param {number}           props.totalSteps               Total number of steps.\n * @param {string}           props.tourTitle                Tour title.\n * @param {HTMLElement|null} props.targetElement            Resolved target element.\n * @param {string|null}      props.resolutionError          Target resolution error.\n * @param {boolean}          props.isApplyingPreconditions  Whether preconditions are being applied.\n * @param {Function}         props.onContinue               Continue/complete handler.\n * @param {Function}         props.onRepeat                 Repeat step handler.\n * @param {Function}         props.onPrevious               Previous step handler.\n * @param {Function}         props.onNext                   Next step handler.\n * @param {Function}         props.onStop                   Stop tour handler.\n * @return {JSX.Element} Coach panel.\n */\nexport default function CoachPanel( {\n\tstep,\n\tstepIndex,\n\ttotalSteps,\n\ttourTitle,\n\ttargetElement,\n\tresolutionError,\n\tisApplyingPreconditions,\n\tonContinue,\n\tonRepeat,\n\tonPrevious,\n\tonNext,\n\tonStop,\n} ) {\n\tconst [ position, setPosition ] = useState( { x: 20, y: 20 } );\n\tconst [ isDragging, setIsDragging ] = useState( false );\n\tconst [ dragOffset, setDragOffset ] = useState( { x: 0, y: 0 } );\n\tconst [ positionKey, setPositionKey ] = useState( 0 ); // Force repositioning.\n\tconst panelRef = useRef( null );\n\n\tconst isFirstStep = stepIndex === 0;\n\tconst isLastStep = stepIndex === totalSteps - 1;\n\tconst isManualCompletion = step?.completion?.type === 'manual';\n\n\t/**\n\t * Position panel relative to target element.\n\t */\n\tuseEffect( () => {\n\t\tif ( ! targetElement || isDragging ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst calculatePosition = () => {\n\t\t\tif ( ! targetElement?.isConnected ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst rect = targetElement.getBoundingClientRect();\n\n\t\t\t// For elements in iframes, adjust rect to main window coordinates.\n\t\t\tconst ownerDoc = targetElement.ownerDocument;\n\t\t\tlet iframeOffset = { top: 0, left: 0 };\n\t\t\tif ( ownerDoc !== document ) {\n\t\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\t\tif ( iframe ) {\n\t\t\t\t\tconst iframeRect = iframe.getBoundingClientRect();\n\t\t\t\t\tiframeOffset = { top: iframeRect.top, left: iframeRect.left };\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst adjustedRect = {\n\t\t\t\ttop: rect.top + iframeOffset.top,\n\t\t\t\tbottom: rect.bottom + iframeOffset.top,\n\t\t\t\tleft: rect.left + iframeOffset.left,\n\t\t\t\tright: rect.right + iframeOffset.left,\n\t\t\t};\n\n\t\t\tconst panelWidth = 320;\n\t\t\tconst panelHeight = 200;\n\t\t\tconst padding = 20;\n\n\t\t\tlet x, y;\n\n\t\t\t// Try to position to the right of the element.\n\t\t\tif ( adjustedRect.right + panelWidth + padding < window.innerWidth ) {\n\t\t\t\tx = adjustedRect.right + padding;\n\t\t\t\ty = adjustedRect.top;\n\t\t\t}\n\t\t\t// Try to position to the left.\n\t\t\telse if ( adjustedRect.left - panelWidth - padding > 0 ) {\n\t\t\t\tx = adjustedRect.left - panelWidth - padding;\n\t\t\t\ty = adjustedRect.top;\n\t\t\t}\n\t\t\t// Try below.\n\t\t\telse if ( adjustedRect.bottom + panelHeight + padding < window.innerHeight ) {\n\t\t\t\tx = Math.max( padding, adjustedRect.left );\n\t\t\t\ty = adjustedRect.bottom + padding;\n\t\t\t}\n\t\t\t// Try above.\n\t\t\telse if ( adjustedRect.top - panelHeight - padding > 0 ) {\n\t\t\t\tx = Math.max( padding, adjustedRect.left );\n\t\t\t\ty = adjustedRect.top - panelHeight - padding;\n\t\t\t}\n\t\t\t// Default to bottom-right corner.\n\t\t\telse {\n\t\t\t\tx = window.innerWidth - panelWidth - padding;\n\t\t\t\ty = window.innerHeight - panelHeight - padding;\n\t\t\t}\n\n\t\t\t// Ensure panel stays within viewport.\n\t\t\tx = Math.max( padding, Math.min( x, window.innerWidth - panelWidth - padding ) );\n\t\t\ty = Math.max( padding, Math.min( y, window.innerHeight - panelHeight - padding ) );\n\n\t\t\tsetPosition( { x, y } );\n\t\t};\n\n\t\t// Initial positioning.\n\t\tcalculatePosition();\n\n\t\t// Listen to scroll and resize events.\n\t\tconst handleScroll = () => {\n\t\t\tif ( ! isDragging ) {\n\t\t\t\tcalculatePosition();\n\t\t\t}\n\t\t};\n\n\t\t// Add listeners to main window.\n\t\twindow.addEventListener( 'scroll', handleScroll, { passive: true } );\n\t\twindow.addEventListener( 'resize', handleScroll, { passive: true } );\n\n\t\t// Also listen to iframe window if element is inside iframe.\n\t\tconst ownerDoc = targetElement.ownerDocument;\n\t\tconst ownerWin = ownerDoc?.defaultView;\n\t\tif ( ownerWin && ownerWin !== window ) {\n\t\t\townerWin.addEventListener( 'scroll', handleScroll, { passive: true } );\n\t\t}\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener( 'scroll', handleScroll );\n\t\t\twindow.removeEventListener( 'resize', handleScroll );\n\t\t\tif ( ownerWin && ownerWin !== window ) {\n\t\t\t\ttry {\n\t\t\t\t\townerWin.removeEventListener( 'scroll', handleScroll );\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t// Window may be inaccessible.\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}, [ targetElement, isDragging, positionKey ] );\n\n\t/**\n\t * Handle drag start.\n\t */\n\tconst handleDragStart = useCallback( ( event ) => {\n\t\tif ( event.target.closest( 'button' ) ) {\n\t\t\treturn; // Don't drag when clicking buttons.\n\t\t}\n\n\t\tsetIsDragging( true );\n\t\tconst rect = panelRef.current.getBoundingClientRect();\n\t\tsetDragOffset( {\n\t\t\tx: event.clientX - rect.left,\n\t\t\ty: event.clientY - rect.top,\n\t\t} );\n\t}, [] );\n\n\t/**\n\t * Handle drag move.\n\t */\n\tconst handleDragMove = useCallback(\n\t\t( event ) => {\n\t\t\tif ( ! isDragging ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst x = event.clientX - dragOffset.x;\n\t\t\tconst y = event.clientY - dragOffset.y;\n\n\t\t\t// Keep panel within viewport.\n\t\t\tconst panelRect = panelRef.current.getBoundingClientRect();\n\t\t\tconst maxX = window.innerWidth - panelRect.width;\n\t\t\tconst maxY = window.innerHeight - panelRect.height;\n\n\t\t\tsetPosition( {\n\t\t\t\tx: Math.max( 0, Math.min( x, maxX ) ),\n\t\t\t\ty: Math.max( 0, Math.min( y, maxY ) ),\n\t\t\t} );\n\t\t},\n\t\t[ isDragging, dragOffset ]\n\t);\n\n\t/**\n\t * Handle drag end.\n\t */\n\tconst handleDragEnd = useCallback( () => {\n\t\tsetIsDragging( false );\n\t}, [] );\n\n\t// Set up drag listeners.\n\tuseEffect( () => {\n\t\tif ( isDragging ) {\n\t\t\tdocument.addEventListener( 'mousemove', handleDragMove );\n\t\t\tdocument.addEventListener( 'mouseup', handleDragEnd );\n\n\t\t\treturn () => {\n\t\t\t\tdocument.removeEventListener( 'mousemove', handleDragMove );\n\t\t\t\tdocument.removeEventListener( 'mouseup', handleDragEnd );\n\t\t\t};\n\t\t}\n\t}, [ isDragging, handleDragMove, handleDragEnd ] );\n\n\t/**\n\t * Render step content.\n\t */\n\tconst renderContent = () => {\n\t\tif ( isApplyingPreconditions ) {\n\t\t\treturn (\n\t\t\t\t<div className=\"act-panel-loading\">\n\t\t\t\t\t<Spinner />\n\t\t\t\t\t<span>{ __( 'Preparing', 'admin-coach-tours' ) }</span>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif ( resolutionError ) {\n\t\t\treturn (\n\t\t\t\t<div className=\"act-panel-error\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Could not find the target element. The UI may have changed.',\n\t\t\t\t\t\t\t'admin-coach-tours'\n\t\t\t\t\t\t) }\n\t\t\t\t\t</p>\n\t\t\t\t\t<Button variant=\"secondary\" onClick={ onRepeat }>\n\t\t\t\t\t\t{ __( 'Try Again', 'admin-coach-tours' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ step?.content && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"act-panel-content\"\n\t\t\t\t\t\tdangerouslySetInnerHTML={ { __html: step.content } }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t};\n\n\t/**\n\t * Render navigation controls.\n\t */\n\tconst renderControls = () => {\n\t\treturn (\n\t\t\t<div className=\"act-panel-controls\">\n\t\t\t\t<Flex justify=\"flex-end\" align=\"center\">\n\t\t\t\t\t<FlexItem>\n\t\t\t\t\t\t{ isManualCompletion || isLastStep ? (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t\t\t\tonClick={ onContinue }\n\t\t\t\t\t\t\t\tdisabled={ isApplyingPreconditions || !! resolutionError }\n\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ isLastStep\n\t\t\t\t\t\t\t\t\t? __( 'Finish', 'admin-coach-tours' )\n\t\t\t\t\t\t\t\t\t: __( 'Continue', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\ticon={ arrowRight }\n\t\t\t\t\t\t\t\tlabel={ __( 'Next', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\tonClick={ onNext }\n\t\t\t\t\t\t\t\tdisabled={ isApplyingPreconditions || !! resolutionError }\n\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</FlexItem>\n\t\t\t\t</Flex>\n\t\t\t</div>\n\t\t);\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tref={ panelRef }\n\t\t\tclassName=\"act-coach-panel\"\n\t\t\tstyle={ {\n\t\t\t\tposition: 'fixed',\n\t\t\t\ttop: position.y,\n\t\t\t\tleft: position.x,\n\t\t\t\twidth: '320px',\n\t\t\t\tmaxHeight: '400px',\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tborderRadius: '8px',\n\t\t\t\tboxShadow: '0 4px 20px rgba(0, 0, 0, 0.15)',\n\t\t\t\tzIndex: 9999990,\n\t\t\t\tdisplay: 'flex',\n\t\t\t\tflexDirection: 'column',\n\t\t\t\tcursor: isDragging ? 'grabbing' : 'default',\n\t\t\t} }\n\t\t\tonMouseDown={ handleDragStart }\n\t\t>\n\t\t\t{ /* Header */ }\n\t\t\t<div\n\t\t\t\tclassName=\"act-panel-header\"\n\t\t\t\tstyle={ {\n\t\t\t\t\tpadding: '12px 16px',\n\t\t\t\t\tborderBottom: '1px solid #e0e0e0',\n\t\t\t\t\tcursor: 'grab',\n\t\t\t\t\tuserSelect: 'none',\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t<Flex justify=\"space-between\" align=\"center\">\n\t\t\t\t\t<FlexBlock>\n\t\t\t\t\t\t<strong className=\"act-panel-title\">\n\t\t\t\t\t\t\t{ step?.title ||\n\t\t\t\t\t\t\t\t__( 'Step', 'admin-coach-tours' ) + ` ${ stepIndex + 1 }` }\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t<div className=\"act-panel-progress\" style={ { fontSize: '12px', color: '#666' } }>\n\t\t\t\t\t\t\t{ `${ stepIndex + 1 } / ${ totalSteps }` }\n\t\t\t\t\t\t\t{ tourTitle && `  ${ tourTitle }` }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</FlexBlock>\n\t\t\t\t\t<FlexItem>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ticon={ close }\n\t\t\t\t\t\t\tlabel={ __( 'Close tour', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\tonClick={ onStop }\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FlexItem>\n\t\t\t\t</Flex>\n\t\t\t</div>\n\n\t\t\t{ /* Body */ }\n\t\t\t<div\n\t\t\t\tclassName=\"act-panel-body\"\n\t\t\t\tstyle={ {\n\t\t\t\t\tpadding: '16px',\n\t\t\t\t\tflex: 1,\n\t\t\t\t\toverflow: 'auto',\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t{ renderContent() }\n\t\t\t</div>\n\n\t\t\t{ /* Footer */ }\n\t\t\t<div\n\t\t\t\tclassName=\"act-panel-footer\"\n\t\t\t\tstyle={ {\n\t\t\t\t\tpadding: '12px 16px',\n\t\t\t\t\tborderTop: '1px solid #e0e0e0',\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t{ renderControls() }\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/**\n * Highlighter Class.\n *\n * Manages visual highlighting of target elements during tour playback.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\n/**\n * Default highlight styles.\n */\nconst DEFAULT_STYLES = {\n\toverlay: {\n\t\tbackgroundColor: 'rgba(0, 0, 0, 0.5)',\n\t\ttransition: 'all 0.3s ease',\n\t},\n\tspotlight: {\n\t\tboxShadow: '0 0 0 4px #007cba, 0 0 0 9999px rgba(0, 0, 0, 0.5)',\n\t\tborderRadius: '4px',\n\t\ttransition: 'all 0.3s ease',\n\t},\n\tpulse: {\n\t\tanimation: 'act-pulse 2s infinite',\n\t},\n};\n\n/**\n * CSS keyframes for pulse animation.\n */\nconst PULSE_KEYFRAMES = `\n@keyframes act-pulse {\n\t0% {\n\t\tbox-shadow: 0 0 0 4px #007cba, 0 0 0 9999px rgba(0, 0, 0, 0.5);\n\t}\n\t50% {\n\t\tbox-shadow: 0 0 0 8px rgba(0, 124, 186, 0.5), 0 0 0 9999px rgba(0, 0, 0, 0.5);\n\t}\n\t100% {\n\t\tbox-shadow: 0 0 0 4px #007cba, 0 0 0 9999px rgba(0, 0, 0, 0.5);\n\t}\n}\n`;\n\n/**\n * Highlighter class for managing element highlighting.\n */\nexport default class Highlighter {\n\t/**\n\t * Constructor.\n\t *\n\t * @param {Object} options Configuration options.\n\t */\n\tconstructor( options = {} ) {\n\t\tthis.options = {\n\t\t\tusePulse: true,\n\t\t\toverlayColor: 'rgba(0, 0, 0, 0.5)',\n\t\t\thighlightColor: '#007cba',\n\t\t\ttransitionDuration: 300,\n\t\t\t...options,\n\t\t};\n\n\t\tthis.spotlightElement = null;\n\t\tthis.targetElement = null;\n\t\tthis.resizeObserver = null;\n\t\tthis.styleElement = null;\n\t\tthis._isAnimating = false;\n\n\t\tthis._init();\n\t}\n\n\t/**\n\t * Initialize the highlighter.\n\t *\n\t * @private\n\t */\n\t_init() {\n\t\t// Inject keyframes stylesheet.\n\t\tthis.styleElement = document.createElement( 'style' );\n\t\tthis.styleElement.textContent = PULSE_KEYFRAMES;\n\t\tdocument.head.appendChild( this.styleElement );\n\n\t\t// Create spotlight element.\n\t\tthis.spotlightElement = document.createElement( 'div' );\n\t\tthis.spotlightElement.className = 'act-highlighter-spotlight';\n\t\tthis.spotlightElement.setAttribute( 'aria-hidden', 'true' );\n\n\t\tObject.assign( this.spotlightElement.style, {\n\t\t\tposition: 'fixed',\n\t\t\tpointerEvents: 'none',\n\t\t\tzIndex: 9999980,\n\t\t\t...DEFAULT_STYLES.spotlight,\n\t\t} );\n\n\t\t// Hidden by default.\n\t\tthis.spotlightElement.style.display = 'none';\n\n\t\tdocument.body.appendChild( this.spotlightElement );\n\n\t\t// Create resize observer.\n\t\tthis.resizeObserver = new ResizeObserver( () => {\n\t\t\tthis._updatePosition();\n\t\t} );\n\t}\n\n\t/**\n\t * Highlight an element.\n\t *\n\t * @param {HTMLElement} element Element to highlight.\n\t */\n\thighlight( element ) {\n\t\tif ( ! element || ! element.isConnected ) {\n\t\t\tthis.clear();\n\t\t\treturn;\n\t\t}\n\n\t\t// If already highlighting this exact element, skip.\n\t\tif ( this.targetElement === element ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Clear previous target properly (including scroll listeners).\n\t\tif ( this.targetElement ) {\n\t\t\tthis.resizeObserver.unobserve( this.targetElement );\n\t\t\tthis._removeScrollListeners();\n\t\t}\n\n\t\tthis.targetElement = element;\n\n\t\t// Observe for size changes.\n\t\tthis.resizeObserver.observe( element );\n\n\t\t// Update position.\n\t\tthis._updatePosition();\n\n\t\t// Show spotlight.\n\t\tthis.spotlightElement.style.display = 'block';\n\n\t\t// Apply pulse animation if enabled (only if not already animating).\n\t\tif ( this.options.usePulse && ! this._isAnimating ) {\n\t\t\tthis.spotlightElement.style.animation = 'act-pulse 2s infinite';\n\t\t\tthis._isAnimating = true;\n\t\t}\n\n\t\t// Add scroll listener to update position.\n\t\tthis._addScrollListeners();\n\t}\n\n\t/**\n\t * Update spotlight position to match target.\n\t *\n\t * @private\n\t */\n\t_updatePosition() {\n\t\tif ( ! this.targetElement || ! this.spotlightElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst rect = this.targetElement.getBoundingClientRect();\n\n\t\t// Add padding around the element.\n\t\tconst padding = 4;\n\n\t\t// Check if element is inside an iframe and get iframe offset.\n\t\tlet iframeOffset = { top: 0, left: 0 };\n\t\tconst ownerDoc = this.targetElement.ownerDocument;\n\t\tif ( ownerDoc !== document ) {\n\t\t\t// Element is in an iframe - find the iframe element.\n\t\t\tconst iframes = document.querySelectorAll( 'iframe' );\n\t\t\tfor ( const iframe of iframes ) {\n\t\t\t\tif ( iframe.contentDocument === ownerDoc ) {\n\t\t\t\t\tconst iframeRect = iframe.getBoundingClientRect();\n\t\t\t\t\tiframeOffset = {\n\t\t\t\t\t\ttop: iframeRect.top,\n\t\t\t\t\t\tleft: iframeRect.left,\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tObject.assign( this.spotlightElement.style, {\n\t\t\ttop: `${ rect.top + iframeOffset.top - padding }px`,\n\t\t\tleft: `${ rect.left + iframeOffset.left - padding }px`,\n\t\t\twidth: `${ rect.width + padding * 2 }px`,\n\t\t\theight: `${ rect.height + padding * 2 }px`,\n\t\t} );\n\t}\n\n\t/**\n\t * Add scroll listeners to update position.\n\t *\n\t * @private\n\t */\n\t_addScrollListeners() {\n\t\tthis._scrollHandler = () => {\n\t\t\tthis._updatePosition();\n\t\t};\n\n\t\t// Track which windows we're listening to for cleanup.\n\t\tthis._scrollWindows = [];\n\n\t\t// Listen to all scrollable ancestors in the element's document.\n\t\tlet parent = this.targetElement?.parentElement;\n\t\twhile ( parent ) {\n\t\t\tif ( parent.scrollHeight > parent.clientHeight ) {\n\t\t\t\tparent.addEventListener( 'scroll', this._scrollHandler, {\n\t\t\t\t\tpassive: true,\n\t\t\t\t} );\n\t\t\t}\n\t\t\tparent = parent.parentElement;\n\t\t}\n\n\t\t// Check if element is inside an iframe.\n\t\tconst ownerDoc = this.targetElement?.ownerDocument;\n\t\tconst ownerWin = ownerDoc?.defaultView;\n\n\t\tif ( ownerWin && ownerWin !== window ) {\n\t\t\t// Element is in an iframe - listen to iframe window scroll.\n\t\t\townerWin.addEventListener( 'scroll', this._scrollHandler, { passive: true } );\n\t\t\townerWin.addEventListener( 'resize', this._scrollHandler, { passive: true } );\n\t\t\tthis._scrollWindows.push( ownerWin );\n\t\t}\n\n\t\t// Also listen to main window scroll and resize.\n\t\twindow.addEventListener( 'scroll', this._scrollHandler, {\n\t\t\tpassive: true,\n\t\t} );\n\t\twindow.addEventListener( 'resize', this._scrollHandler, {\n\t\t\tpassive: true,\n\t\t} );\n\t\tthis._scrollWindows.push( window );\n\t}\n\n\t/**\n\t * Remove scroll listeners.\n\t *\n\t * @private\n\t */\n\t_removeScrollListeners() {\n\t\tif ( ! this._scrollHandler ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Remove from parent elements.\n\t\tlet parent = this.targetElement?.parentElement;\n\t\twhile ( parent ) {\n\t\t\tparent.removeEventListener( 'scroll', this._scrollHandler );\n\t\t\tparent = parent.parentElement;\n\t\t}\n\n\t\t// Remove from all tracked windows (main window + any iframe windows).\n\t\tif ( this._scrollWindows ) {\n\t\t\tfor ( const win of this._scrollWindows ) {\n\t\t\t\ttry {\n\t\t\t\t\twin.removeEventListener( 'scroll', this._scrollHandler );\n\t\t\t\t\twin.removeEventListener( 'resize', this._scrollHandler );\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t// Window may have been closed or inaccessible.\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._scrollWindows = [];\n\t\t}\n\n\t\tthis._scrollHandler = null;\n\t}\n\n\t/**\n\t * Clear highlighting.\n\t */\n\tclear() {\n\t\tif ( this.targetElement ) {\n\t\t\tthis.resizeObserver.unobserve( this.targetElement );\n\t\t\tthis._removeScrollListeners();\n\t\t\tthis.targetElement = null;\n\t\t}\n\n\t\tif ( this.spotlightElement ) {\n\t\t\tthis.spotlightElement.style.display = 'none';\n\t\t\tthis.spotlightElement.style.animation = 'none';\n\t\t\tthis._isAnimating = false;\n\t\t}\n\t}\n\n\t/**\n\t * Transition highlight to a new element.\n\t *\n\t * @param {HTMLElement} element New element to highlight.\n\t * @return {Promise<void>} Promise that resolves when transition completes.\n\t */\n\tasync transitionTo( element ) {\n\t\tif ( ! this.targetElement ) {\n\t\t\tthis.highlight( element );\n\t\t\treturn;\n\t\t}\n\n\t\t// Smooth transition by updating position.\n\t\tif ( this.targetElement ) {\n\t\t\tthis.resizeObserver.unobserve( this.targetElement );\n\t\t\tthis._removeScrollListeners();\n\t\t}\n\n\t\tthis.targetElement = element;\n\n\t\tif ( element && element.isConnected ) {\n\t\t\tthis.resizeObserver.observe( element );\n\t\t\tthis._addScrollListeners();\n\n\t\t\t// Animate to new position.\n\t\t\tawait new Promise( ( resolve ) => {\n\t\t\t\trequestAnimationFrame( () => {\n\t\t\t\t\tthis._updatePosition();\n\t\t\t\t\tsetTimeout( resolve, this.options.transitionDuration );\n\t\t\t\t} );\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.clear();\n\t\t}\n\t}\n\n\t/**\n\t * Set highlight style.\n\t *\n\t * @param {string} style Style name: 'default', 'success', 'warning', 'error'.\n\t */\n\tsetStyle( style ) {\n\t\tif ( ! this.spotlightElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst colors = {\n\t\t\tdefault: '#007cba',\n\t\t\tsuccess: '#00a32a',\n\t\t\twarning: '#dba617',\n\t\t\terror: '#d63638',\n\t\t};\n\n\t\tconst color = colors[ style ] || colors.default;\n\n\t\tthis.spotlightElement.style.boxShadow = `0 0 0 4px ${ color }, 0 0 0 9999px rgba(0, 0, 0, 0.5)`;\n\t}\n\n\t/**\n\t * Flash the highlight (for completion feedback).\n\t *\n\t * @return {Promise<void>} Promise that resolves when flash completes.\n\t */\n\tasync flash() {\n\t\tif ( ! this.spotlightElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Quick flash to success color.\n\t\tthis.setStyle( 'success' );\n\n\t\tawait new Promise( ( resolve ) => {\n\t\t\tsetTimeout( () => {\n\t\t\t\tthis.setStyle( 'default' );\n\t\t\t\tresolve();\n\t\t\t}, 300 );\n\t\t} );\n\t}\n\n\t/**\n\t * Destroy the highlighter and clean up.\n\t */\n\tdestroy() {\n\t\tthis.clear();\n\n\t\tif ( this.resizeObserver ) {\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.resizeObserver = null;\n\t\t}\n\n\t\tif ( this.spotlightElement && this.spotlightElement.parentNode ) {\n\t\t\tthis.spotlightElement.parentNode.removeChild( this.spotlightElement );\n\t\t\tthis.spotlightElement = null;\n\t\t}\n\n\t\tif ( this.styleElement && this.styleElement.parentNode ) {\n\t\t\tthis.styleElement.parentNode.removeChild( this.styleElement );\n\t\t\tthis.styleElement = null;\n\t\t}\n\t}\n}\n","/**\n * Pupil Launcher Component.\n *\n * Provides AI-powered tour generation for pupils with a dropdown of\n * predefined tasks and optional freeform chat.\n *\n * @package AdminCoachTours\n * @since   0.3.0\n */\n\nimport { useState, useEffect, useCallback, useRef, createPortal } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport apiFetch from '@wordpress/api-fetch';\nimport { Dashicon } from '@wordpress/components';\n\nconst STORE_NAME = 'admin-coach-tours';\n\n/**\n * Icons for task categories.\n */\nconst CATEGORY_ICONS = {\n\tmedia: '',\n\tcontent: '',\n\tlayout: '',\n\tformatting: '',\n\tdefault: '',\n};\n\n/**\n * Pupil Launcher component.\n *\n * @return {JSX.Element|null} Launcher UI or null if hidden.\n */\nexport default function PupilLauncher() {\n\tconst [ isOpen, setIsOpen ] = useState( false );\n\tconst [ tasks, setTasks ] = useState( [] );\n\tconst [ isTasksLoading, setIsTasksLoading ] = useState( false );\n\tconst [ tasksError, setTasksError ] = useState( null );\n\tconst [ chatQuery, setChatQuery ] = useState( '' );\n\tconst [ activeTab, setActiveTab ] = useState( 'tasks' );\n\tconst [ localLoading, setLocalLoading ] = useState( false );\n\tconst inputRef = useRef( null );\n\n\t// Get state from store.\n\tconst {\n\t\tstoreLoading,\n\t\taiTourError,\n\t\tisPlaying,\n\t\taiAvailable,\n\t} = useSelect( ( select ) => {\n\t\tconst store = select( STORE_NAME );\n\t\treturn {\n\t\t\tstoreLoading: store.isAiTourLoading?.() ?? false,\n\t\t\taiTourError: store.getAiTourError?.() ?? null,\n\t\t\tisPlaying: store.getCurrentTour() !== null,\n\t\t\t// Check if AI is available from localized data.\n\t\t\taiAvailable: window.adminCoachTours?.aiAvailable ?? false,\n\t\t};\n\t}, [] );\n\n\t// Combine local and store loading state.\n\t// Local state ensures immediate render before React batches updates.\n\tconst isAiTourLoading = localLoading || storeLoading;\n\n\t// Clear local loading only when tour starts playing (not before).\n\tuseEffect( () => {\n\t\tif ( isPlaying && localLoading ) {\n\t\t\tsetLocalLoading( false );\n\t\t}\n\t}, [ isPlaying, localLoading ] );\n\n\t// Get dispatch actions.\n\tconst { requestAiTour, clearEphemeralTour } = useDispatch( STORE_NAME );\n\n\t/**\n\t * Fetch available tasks when launcher opens.\n\t */\n\tuseEffect( () => {\n\t\tif ( isOpen && tasks.length === 0 && ! isTasksLoading ) {\n\t\t\tsetIsTasksLoading( true );\n\t\t\tsetTasksError( null );\n\n\t\t\tapiFetch( { path: '/admin-coach-tours/v1/ai/tasks' } )\n\t\t\t\t.then( ( response ) => {\n\t\t\t\t\tif ( response.available && response.tasks ) {\n\t\t\t\t\t\tsetTasks( response.tasks );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTasksError( __( 'AI is not available.', 'admin-coach-tours' ) );\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t\t.catch( ( error ) => {\n\t\t\t\t\tsetTasksError( error.message || __( 'Failed to load tasks.', 'admin-coach-tours' ) );\n\t\t\t\t} )\n\t\t\t\t.finally( () => {\n\t\t\t\t\tsetIsTasksLoading( false );\n\t\t\t\t} );\n\t\t}\n\t}, [ isOpen, tasks.length, isTasksLoading ] );\n\n\t/**\n\t * Focus input when chat tab opens.\n\t */\n\tuseEffect( () => {\n\t\tif ( activeTab === 'chat' && inputRef.current ) {\n\t\t\tinputRef.current.focus();\n\t\t}\n\t}, [ activeTab ] );\n\n\t/**\n\t * Handle task selection.\n\t */\n\tconst handleTaskClick = useCallback(\n\t\t( taskId ) => {\n\t\t\t// Set local loading immediately to show overlay before React batches updates.\n\t\t\tsetLocalLoading( true );\n\t\t\tsetIsOpen( false );\n\t\t\tconst postType = window.adminCoachTours?.postType || 'post';\n\t\t\trequestAiTour( taskId, '', postType );\n\t\t},\n\t\t[ requestAiTour ]\n\t);\n\n\t/**\n\t * Handle freeform chat submission.\n\t */\n\tconst handleChatSubmit = useCallback(\n\t\t( e ) => {\n\t\t\te.preventDefault();\n\t\t\tif ( ! chatQuery.trim() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Set local loading immediately to show overlay before React batches updates.\n\t\t\tsetLocalLoading( true );\n\t\t\tsetIsOpen( false );\n\t\t\tconst postType = window.adminCoachTours?.postType || 'post';\n\t\t\trequestAiTour( '', chatQuery.trim(), postType );\n\t\t\tsetChatQuery( '' );\n\t\t},\n\t\t[ chatQuery, requestAiTour ]\n\t);\n\n\t/**\n\t * Toggle launcher open/closed.\n\t */\n\tconst toggleLauncher = useCallback( () => {\n\t\tsetIsOpen( ( prev ) => ! prev );\n\t}, [] );\n\n\t/**\n\t * Close launcher.\n\t */\n\tconst closeLauncher = useCallback( () => {\n\t\tsetIsOpen( false );\n\t}, [] );\n\n\t// Show configuration prompt if AI is not available.\n\tif ( ! aiAvailable ) {\n\t\treturn (\n\t\t\t<div className=\"act-pupil-launcher\">\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"act-pupil-launcher__fab\"\n\t\t\t\t\tonClick={ toggleLauncher }\n\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\taria-label={ __( 'Open AI Coach', 'admin-coach-tours' ) }\n\t\t\t\t>\n\t\t\t\t\t<span className=\"act-pupil-launcher__icon\"></span>\n\t\t\t\t</button>\n\n\t\t\t\t{ isOpen && (\n\t\t\t\t\t<div className=\"act-pupil-launcher__panel\">\n\t\t\t\t\t\t<div className=\"act-pupil-launcher__header\">\n\t\t\t\t\t\t\t<h3>{ __( 'AI Coach', 'admin-coach-tours' ) }</h3>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName=\"act-pupil-launcher__close\"\n\t\t\t\t\t\t\t\tonClick={ closeLauncher }\n\t\t\t\t\t\t\t\taria-label={ __( 'Close', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"act-pupil-launcher__content\">\n\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__not-configured\">\n\t\t\t\t\t\t\t\t<p>{ __( 'AI is not configured yet.', 'admin-coach-tours' ) }</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t{ __( 'Go to ', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t\t<a href=\"/wp-admin/tools.php?page=admin-coach-tours\">\n\t\t\t\t\t\t\t\t\t\t{ __( 'Tools  Coach Tours', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t{ __( ' to add your API key.', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Group tasks by category.\n\tconst tasksByCategory = tasks.reduce( ( acc, task ) => {\n\t\tconst category = task.category || 'other';\n\t\tif ( ! acc[ category ] ) {\n\t\t\tacc[ category ] = [];\n\t\t}\n\t\tacc[ category ].push( task );\n\t\treturn acc;\n\t}, {} );\n\n\t// Render loading overlay via portal (always available, even when tour is playing).\n\t// This must be outside the isPlaying guard to persist during the transition.\n\tconst loadingOverlay = isAiTourLoading && createPortal(\n\t\t<div className=\"act-ai-loading-overlay\">\n\t\t\t<div className=\"act-ai-loading-overlay__content\">\n\t\t\t\t<div className=\"act-ai-loading-overlay__spinner\" />\n\t\t\t\t<h2 className=\"act-ai-loading-overlay__title\">\n\t\t\t\t\t{ __( 'Creating your guided tour...', 'admin-coach-tours' ) }\n\t\t\t\t</h2>\n\t\t\t\t<p className=\"act-ai-loading-overlay__text\">\n\t\t\t\t\t{ __( 'AI is analyzing the editor and generating step-by-step instructions.', 'admin-coach-tours' ) }\n\t\t\t\t</p>\n\t\t\t\t<p className=\"act-ai-loading-overlay__hint\">\n\t\t\t\t\t{ __( 'This usually takes a few seconds.', 'admin-coach-tours' ) }\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>,\n\t\tdocument.body\n\t);\n\n\t// Don't render launcher UI if a tour is playing, but keep the overlay.\n\tif ( isPlaying ) {\n\t\treturn loadingOverlay || null;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{ /* Full-screen AI Loading Overlay */ }\n\t\t\t{ loadingOverlay }\n\n\t\t\t<div className=\"act-pupil-launcher\">\n\t\t\t\t{ /* Floating Action Button */ }\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"act-pupil-launcher__fab\"\n\t\t\t\t\tonClick={ toggleLauncher }\n\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\taria-label={ __( 'Open AI Coach', 'admin-coach-tours' ) }\n\t\t\t\t\tdisabled={ isAiTourLoading }\n\t\t\t\t>\n\t\t\t\t\t{ isAiTourLoading ? (\n\t\t\t\t\t\t<span className=\"act-pupil-launcher__spinner\" />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span className=\"act-pupil-launcher__icon\"></span>\n\t\t\t\t\t) }\n\t\t\t\t</button>\n\n\t\t\t\t{ /* Dropdown Panel */ }\n\t\t\t\t{ isOpen && (\n\t\t\t\t\t<div className=\"act-pupil-launcher__panel\">\n\t\t\t\t\t{ /* AI Loading Overlay */ }\n\t\t\t\t\t{ isAiTourLoading && (\n\t\t\t\t\t\t<div className=\"act-pupil-launcher__ai-loading\">\n\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__ai-loading-spinner\" />\n\t\t\t\t\t\t\t<span className=\"act-pupil-launcher__ai-loading-text\">\n\t\t\t\t\t\t\t\t{ __( 'Creating your tour...', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span className=\"act-pupil-launcher__ai-loading-hint\">\n\t\t\t\t\t\t\t\t{ __( 'AI is generating step-by-step instructions', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) }\n\n\t\t\t\t\t<div className=\"act-pupil-launcher__header\">\n\t\t\t\t\t\t<h3>{ __( 'What would you like to learn?', 'admin-coach-tours' ) }</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"act-pupil-launcher__close\"\n\t\t\t\t\t\t\tonClick={ closeLauncher }\n\t\t\t\t\t\t\taria-label={ __( 'Close', 'admin-coach-tours' ) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{ /* Tabs */ }\n\t\t\t\t\t<div className=\"act-pupil-launcher__tabs\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName={ `act-pupil-launcher__tab ${ activeTab === 'tasks' ? 'is-active' : '' }` }\n\t\t\t\t\t\t\tonClick={ () => setActiveTab( 'tasks' ) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Common Tasks', 'admin-coach-tours' ) }\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName={ `act-pupil-launcher__tab ${ activeTab === 'chat' ? 'is-active' : '' }` }\n\t\t\t\t\t\t\tonClick={ () => setActiveTab( 'chat' ) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Ask a Question', 'admin-coach-tours' ) }\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{ /* Content */ }\n\t\t\t\t\t<div className=\"act-pupil-launcher__content\">\n\t\t\t\t\t\t{ /* Error Display */ }\n\t\t\t\t\t\t{ ( aiTourError || tasksError ) && (\n\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__error\">\n\t\t\t\t\t\t\t\t{ aiTourError || tasksError }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\n\t\t\t\t\t\t{ /* Tasks Tab */ }\n\t\t\t\t\t\t{ activeTab === 'tasks' && (\n\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__tasks\">\n\t\t\t\t\t\t\t\t{ isTasksLoading && (\n\t\t\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__loading\">\n\t\t\t\t\t\t\t\t\t\t{ __( 'Loading tasks...', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) }\n\n\t\t\t\t\t\t\t\t{ ! isTasksLoading && Object.entries( tasksByCategory ).map( ( [ category, categoryTasks ] ) => (\n\t\t\t\t\t\t\t\t\t<div key={ category } className=\"act-pupil-launcher__category\">\n\t\t\t\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"act-pupil-launcher__category-icon\">\n\t\t\t\t\t\t\t\t\t\t\t\t{ CATEGORY_ICONS[ category ] || CATEGORY_ICONS.default }\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{ category.charAt( 0 ).toUpperCase() + category.slice( 1 ) }\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__task-list\">\n\t\t\t\t\t\t\t\t\t\t\t{ categoryTasks.map( ( task ) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={ task.id }\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"act-pupil-launcher__task\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={ () => handleTaskClick( task.id ) }\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={ isAiTourLoading }\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"act-pupil-launcher__task-icon\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ task.icon ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Dashicon icon={ task.icon } />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : '' }\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"act-pupil-launcher__task-label\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ task.label }\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\n\t\t\t\t\t\t{ /* Chat Tab */ }\n\t\t\t\t\t\t{ activeTab === 'chat' && (\n\t\t\t\t\t\t\t<div className=\"act-pupil-launcher__chat\">\n\t\t\t\t\t\t\t\t<p className=\"act-pupil-launcher__chat-hint\">\n\t\t\t\t\t\t\t\t\t{ __( 'Ask about the WordPress editor:', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<form onSubmit={ handleChatSubmit }>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tref={ inputRef }\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"act-pupil-launcher__chat-input\"\n\t\t\t\t\t\t\t\t\t\tvalue={ chatQuery }\n\t\t\t\t\t\t\t\t\t\tonChange={ ( e ) => setChatQuery( e.target.value ) }\n\t\t\t\t\t\t\t\t\t\tplaceholder={ __( 'e.g., How do I add a gallery?', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t\t\tdisabled={ isAiTourLoading }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"act-pupil-launcher__chat-submit\"\n\t\t\t\t\t\t\t\t\t\tdisabled={ isAiTourLoading || ! chatQuery.trim() }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ isAiTourLoading\n\t\t\t\t\t\t\t\t\t\t\t? __( 'Generating...', 'admin-coach-tours' )\n\t\t\t\t\t\t\t\t\t\t\t: __( 'Get Tour', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t<p className=\"act-pupil-launcher__chat-note\">\n\t\t\t\t\t\t\t\t\t{ __( 'AI will create a step-by-step tour to guide you.', 'admin-coach-tours' ) }\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n","/**\n * Tour Runner Component.\n *\n * Main orchestrator for running tours in pupil mode.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { useSelect, useDispatch, dispatch as wpDispatch, select as wpSelect } from '@wordpress/data';\nimport { useState, useEffect, useCallback, useRef } from '@wordpress/element';\nimport { createPortal } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\nimport CoachPanel from './CoachPanel.jsx';\nimport Highlighter from './Highlighter.js';\nimport { resolveTarget, resolveTargetWithRecovery } from '../runtime/resolveTarget.js';\nimport { applyPreconditions, onLeaveStep, onEnterStep, clearInsertedBlocks, setCurrentStepIndex } from '../runtime/applyPreconditions.js';\nimport { watchCompletion } from '../runtime/watchCompletion.js';\nimport { waitForNextStepBlock } from '../runtime/waitForNextStepBlock.js';\n\nconst STORE_NAME = 'admin-coach-tours';\n\n/**\n * Scroll an element into view, handling cross-frame scenarios.\n * When element is inside an iframe, we need to scroll both the iframe content\n * and ensure the iframe area is visible in the main window.\n *\n * @param {HTMLElement} element Element to scroll into view.\n */\nfunction scrollElementIntoView( element ) {\n\tif ( ! element ) {\n\t\treturn;\n\t}\n\n\t// Check if element is inside an iframe.\n\tconst ownerDoc = element.ownerDocument;\n\tconst isInIframe = ownerDoc !== document;\n\n\tif ( isInIframe ) {\n\t\t// First, scroll within the iframe to center the element.\n\t\telement.scrollIntoView( {\n\t\t\tbehavior: 'smooth',\n\t\t\tblock: 'center',\n\t\t\tinline: 'center',\n\t\t} );\n\n\t\t// Then, ensure the iframe region where the element is located\n\t\t// is visible in the main window.\n\t\t// Give the iframe scroll a moment to complete.\n\t\tsetTimeout( () => {\n\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\tif ( iframe ) {\n\t\t\t\t// Get the element's position relative to the iframe viewport.\n\t\t\t\tconst elementRect = element.getBoundingClientRect();\n\t\t\t\tconst iframeRect = iframe.getBoundingClientRect();\n\n\t\t\t\t// Calculate where the element is in the main window coordinate system.\n\t\t\t\tconst elementTopInMain = iframeRect.top + elementRect.top;\n\t\t\t\tconst elementBottomInMain = iframeRect.top + elementRect.bottom;\n\t\t\t\tconst viewportHeight = window.innerHeight;\n\n\t\t\t\t// Check if element is fully visible in the main window.\n\t\t\t\tconst isFullyVisible = elementTopInMain >= 100 && elementBottomInMain <= viewportHeight - 100;\n\n\t\t\t\tif ( ! isFullyVisible ) {\n\t\t\t\t\t// Scroll the main window to center the element.\n\t\t\t\t\tconst scrollTarget = elementTopInMain + window.scrollY - ( viewportHeight / 2 );\n\t\t\t\t\twindow.scrollTo( {\n\t\t\t\t\t\ttop: Math.max( 0, scrollTarget ),\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}, 150 );\n\t} else {\n\t\t// Element is in main document, simple scroll.\n\t\telement.scrollIntoView( {\n\t\t\tbehavior: 'smooth',\n\t\t\tblock: 'center',\n\t\t\tinline: 'center',\n\t\t} );\n\t}\n}\n\n/**\n * Tour Runner component.\n *\n * @return {JSX.Element|null} Tour runner UI.\n */\nexport default function TourRunner() {\n\tconsole.log( '[ACT TourRunner] Component function called' );\n\t\n\tconst [ targetElement, setTargetElement ] = useState( null );\n\tconst [ resolutionError, setResolutionError ] = useState( null );\n\tconst [ resolution, setResolution ] = useState( null );\n\tconst [ isApplyingPreconditions, setIsApplyingPreconditions ] = useState( false );\n\tconst [ repeatCounter, setRepeatCounter ] = useState( 0 );\n\tconst highlighterRef = useRef( null );\n\tconst previousStepIndexRef = useRef( null );\n\tconst completionWatcherRef = useRef( null ); // Use ref to avoid stale closure in cleanup.\n\n\t// Get playback state from store.\n\tconst {\n\t\tisPlaying,\n\t\tcurrentTour,\n\t\tcurrentStep,\n\t\tstepIndex,\n\t\ttotalSteps,\n\t} = useSelect( ( select ) => {\n\t\tconst store = select( STORE_NAME );\n\t\tconst data = {\n\t\t\t// Only run in pupil mode, not educator mode.\n\t\t\tisPlaying: store.isPupilMode(),\n\t\t\tcurrentTour: store.getCurrentTour(),\n\t\t\tcurrentStep: store.getCurrentStep(),\n\t\t\tstepIndex: store.getCurrentStepIndex() || 0,\n\t\t\ttotalSteps: store.getTotalSteps() || 0,\n\t\t};\n\t\tconsole.log( '[ACT TourRunner] useSelect:', data );\n\t\treturn data;\n\t}, [] );\n\n\t// Get dispatch actions.\n\tconst {\n\t\tstopTour,\n\t\tnextStep,\n\t\tpreviousStep,\n\t\trepeatStep,\n\t} = useDispatch( STORE_NAME );\n\n\t/**\n\t * Initialize highlighter.\n\t */\n\tuseEffect( () => {\n\t\tif ( ! highlighterRef.current ) {\n\t\t\thighlighterRef.current = new Highlighter();\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( highlighterRef.current ) {\n\t\t\t\thighlighterRef.current.destroy();\n\t\t\t\thighlighterRef.current = null;\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\t/**\n\t * Handle step change - resolve target and apply preconditions.\n\t */\n\tuseEffect( () => {\n\t\tif ( ! isPlaying || ! currentStep ) {\n\t\t\t// Clear highlight when not playing.\n\t\t\tif ( highlighterRef.current ) {\n\t\t\t\thighlighterRef.current.clear();\n\t\t\t}\n\t\t\tsetTargetElement( null );\n\t\t\t// Clear block tracking when tour ends.\n\t\t\tclearInsertedBlocks();\n\t\t\treturn;\n\t\t}\n\n\t\tlet isMounted = true;\n\t\tlet resolvedElement = null; // Track the resolved element locally.\n\t\tconst previousStepIndex = previousStepIndexRef.current;\n\n\t\tconst setupStep = async () => {\n\t\t\tsetResolutionError( null );\n\t\t\tsetIsApplyingPreconditions( true );\n\n\t\t\t// Cancel any existing completion watcher using ref (avoids stale closure).\n\t\t\tif ( completionWatcherRef.current?.cancel ) {\n\t\t\t\tconsole.log( '[ACT TourRunner] Cancelling previous completion watcher' );\n\t\t\t\tcompletionWatcherRef.current.cancel();\n\t\t\t\tcompletionWatcherRef.current = null;\n\t\t\t}\n\n\t\t\t// Handle step transition: leave previous step, enter new step.\n\t\t\tif ( previousStepIndex !== null && previousStepIndex !== stepIndex ) {\n\t\t\t\tawait onLeaveStep( previousStepIndex );\n\t\t\t}\n\t\t\tawait onEnterStep( stepIndex );\n\t\t\tpreviousStepIndexRef.current = stepIndex;\n\n\t\t\t// 1. Apply preconditions.\n\t\t\tconsole.log( '[ACT TourRunner] Preconditions for step:', stepIndex, currentStep.preconditions );\n\t\t\tif ( currentStep.preconditions?.length > 0 ) {\n\t\t\t\tconsole.log( '[ACT TourRunner] Applying', currentStep.preconditions.length, 'preconditions' );\n\t\t\t\tconst preconditionResult = await applyPreconditions(\n\t\t\t\t\tcurrentStep.preconditions\n\t\t\t\t);\n\t\t\t\tconsole.log( '[ACT TourRunner] Precondition result:', preconditionResult );\n\n\t\t\t\tif ( ! isMounted ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( ! preconditionResult.success ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Some preconditions failed:',\n\t\t\t\t\t\tpreconditionResult.failedPreconditions\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log( '[ACT TourRunner] No preconditions for this step' );\n\t\t\t}\n\n\t\t\tsetIsApplyingPreconditions( false );\n\n\t\t\t// 2. Resolve target element.\n\t\t\tif ( currentStep.target ) {\n\t\t\t\t// Try with recovery if available.\n\t\t\t\tconst recoveryFn = currentStep.recovery\n\t\t\t\t\t? async () => {\n\t\t\t\t\t\t\t// Execute recovery steps.\n\t\t\t\t\t\t\tawait applyPreconditions( currentStep.recovery );\n\t\t\t\t\t  }\n\t\t\t\t\t: null;\n\n\t\t\t\tconst result = await resolveTargetWithRecovery(\n\t\t\t\t\tcurrentStep.target,\n\t\t\t\t\trecoveryFn\n\t\t\t\t);\n\n\t\t\t\tif ( ! isMounted ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( result.success ) {\n\t\t\t\t\tresolvedElement = result.element; // Store locally for completion watcher.\n\t\t\t\t\tsetTargetElement( result.element );\n\t\t\t\t\tsetResolution( {\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\tusedLocator: result.usedLocator,\n\t\t\t\t\t\trecovered: result.recovered || false,\n\t\t\t\t\t} );\n\n\t\t\t\t\t// If the element is inside a block, select it in WordPress data store.\n\t\t\t\t\t// Check the element itself and traverse up to find parent block.\n\t\t\t\t\tlet blockClientId = result.element.getAttribute( 'data-block' );\n\t\t\t\t\tif ( ! blockClientId ) {\n\t\t\t\t\t\tconst blockWrapper = result.element.closest( '[data-block]' );\n\t\t\t\t\t\tif ( blockWrapper ) {\n\t\t\t\t\t\t\tblockClientId = blockWrapper.getAttribute( 'data-block' );\n\t\t\t\t\t\t\tconsole.log( '[ACT TourRunner] Found parent block:', blockClientId );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( blockClientId ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst blockEditorDispatch = wpDispatch( 'core/block-editor' );\n\t\t\t\t\t\t\tif ( blockEditorDispatch?.selectBlock ) {\n\t\t\t\t\t\t\t\tawait blockEditorDispatch.selectBlock( blockClientId );\n\t\t\t\t\t\t\t\tconsole.log( '[ACT TourRunner] Selected block:', blockClientId );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch ( err ) {\n\t\t\t\t\t\t\tconsole.warn( '[ACT TourRunner] Could not select block:', err );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Scroll element into view FIRST with cross-frame support.\n\t\t\t\t\tscrollElementIntoView( result.element );\n\n\t\t\t\t\t// Then highlight after scroll completes (wait for smooth scroll).\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\tif ( highlighterRef.current && result.element?.isConnected ) {\n\t\t\t\t\t\t\thighlighterRef.current.highlight( result.element );\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 350 ); // Allow time for smooth scroll to finish\n\t\t\t\t} else {\n\t\t\t\t\tresolvedElement = null;\n\t\t\t\t\tsetTargetElement( null );\n\t\t\t\t\tsetResolutionError( result.error );\n\t\t\t\t\tsetResolution( {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: result.error,\n\t\t\t\t\t} );\n\t\t\t\t\tconsole.log( '[ACT TourRunner] Target resolution failed, NOT auto-advancing. Error:', result.error );\n\n\t\t\t\t\tif ( highlighterRef.current ) {\n\t\t\t\t\t\thighlighterRef.current.clear();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 3. Set up completion watcher (use resolvedElement, not state).\n\t\t\tif ( currentStep.completion && resolvedElement ) {\n\t\t\t\tconsole.log( '[ACT TourRunner] Setting up completion watcher for step:', stepIndex, 'type:', currentStep.completion.type, 'params:', currentStep.completion.params );\n\t\t\t\t\n\t\t\t\t// Small delay to ensure DOM is stable and UI is ready.\n\t\t\t\tawait new Promise( ( r ) => setTimeout( r, 100 ) );\n\n\t\t\t\tif ( ! isMounted ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst watcher = watchCompletion(\n\t\t\t\t\tcurrentStep.completion,\n\t\t\t\t\tresolvedElement // Use local variable, not stale state!\n\t\t\t\t);\n\t\t\t\tcompletionWatcherRef.current = watcher; // Store in ref for reliable cleanup.\n\n\t\t\t\t// Wait for completion.\n\t\t\t\twatcher.promise.then( async ( completionResult ) => {\n\t\t\t\t\tif ( ! isMounted ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( completionResult.success ) {\n\t\t\t\t\t\tconsole.log( '[ACT TourRunner] Completion detected for step:', stepIndex );\n\n\t\t\t\t\t\t// Auto-advance if not the last step.\n\t\t\t\t\t\tif ( stepIndex < totalSteps - 1 ) {\n\t\t\t\t\t\t\t// Look ahead: wait for the next step's expected block before advancing.\n\t\t\t\t\t\t\tconst tourSteps = currentTour?.steps || [];\n\n\t\t\t\t\t\t\tconst lookAheadResult = await waitForNextStepBlock( tourSteps, stepIndex, 5000 );\n\n\t\t\t\t\t\t\tif ( lookAheadResult.waited ) {\n\t\t\t\t\t\t\t\tconsole.log( '[ACT TourRunner] Waited for block:', lookAheadResult.blockType, 'success:', lookAheadResult.success );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Advance after a small delay.\n\t\t\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\t\t\tif ( isMounted ) {\n\t\t\t\t\t\t\t\t\tconsole.log( '[ACT TourRunner] Auto-advancing from step:', stepIndex );\n\t\t\t\t\t\t\t\t\tnextStep();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 300 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Last step - end the tour.\n\t\t\t\t\t\t\tconsole.log( '[ACT TourRunner] Last step completed, ending tour' );\n\t\t\t\t\t\t\tclearInsertedBlocks();\n\t\t\t\t\t\t\tnextStep(); // This will end the tour since there's no next step.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\tsetupStep();\n\n\t\treturn () => {\n\t\t\tisMounted = false;\n\t\t\t// Use ref for cleanup to avoid stale closure.\n\t\t\tif ( completionWatcherRef.current?.cancel ) {\n\t\t\t\tconsole.log( '[ACT TourRunner] Cleanup: Cancelling completion watcher' );\n\t\t\t\tcompletionWatcherRef.current.cancel();\n\t\t\t\tcompletionWatcherRef.current = null;\n\t\t\t}\n\t\t};\n\t}, [ isPlaying, currentStep, stepIndex, repeatCounter ] );\n\n\t/**\n\t * Handle manual continue (for manual completion type or finish).\n\t */\n\tconst handleContinue = useCallback( async () => {\n\t\tif ( completionWatcherRef.current?.confirm ) {\n\t\t\tcompletionWatcherRef.current.confirm();\n\t\t} else {\n\t\t\t// Look ahead: wait for next step's expected block before advancing.\n\t\t\tif ( stepIndex < totalSteps - 1 ) {\n\t\t\t\tconst tourSteps = currentTour?.steps || [];\n\t\t\t\tconst lookAheadResult = await waitForNextStepBlock( tourSteps, stepIndex, 5000 );\n\n\t\t\t\tif ( lookAheadResult.waited ) {\n\t\t\t\t\tconsole.log( '[ACT TourRunner] Manual continue waited for block:', lookAheadResult.blockType );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Advance to next step (or end tour if last step).\n\t\t\tnextStep();\n\t\t}\n\t}, [ nextStep, stepIndex, totalSteps, currentTour ] );\n\n\t/**\n\t * Handle repeat step.\n\t */\n\tconst handleRepeat = useCallback( () => {\n\t\t// Cancel current watcher using ref.\n\t\tif ( completionWatcherRef.current?.cancel ) {\n\t\t\tcompletionWatcherRef.current.cancel();\n\t\t\tcompletionWatcherRef.current = null;\n\t\t}\n\t\t// Increment counter to trigger useEffect re-run.\n\t\tsetRepeatCounter( ( c ) => c + 1 );\n\t\trepeatStep();\n\t}, [ repeatStep ] );\n\n\t/**\n\t * Handle stop tour.\n\t */\n\tconst handleStop = useCallback( () => {\n\t\t// Cancel watcher using ref.\n\t\tif ( completionWatcherRef.current?.cancel ) {\n\t\t\tcompletionWatcherRef.current.cancel();\n\t\t\tcompletionWatcherRef.current = null;\n\t\t}\n\t\t// Clear inserted blocks tracking when tour stops.\n\t\tclearInsertedBlocks();\n\t\tpreviousStepIndexRef.current = null;\n\t\tstopTour();\n\t}, [ stopTour ] );\n\n\t// Don't render if not playing.\n\tif ( ! isPlaying || ! currentTour || ! currentStep ) {\n\t\treturn null;\n\t}\n\n\tconst panelContent = (\n\t\t<CoachPanel\n\t\t\tstep={ currentStep }\n\t\t\tstepIndex={ stepIndex }\n\t\t\ttotalSteps={ totalSteps }\n\t\t\ttourTitle={ currentTour.title }\n\t\t\ttargetElement={ targetElement }\n\t\t\tresolutionError={ resolutionError }\n\t\t\tisApplyingPreconditions={ isApplyingPreconditions }\n\t\t\tonContinue={ handleContinue }\n\t\t\tonRepeat={ handleRepeat }\n\t\t\tonPrevious={ previousStep }\n\t\t\tonNext={ nextStep }\n\t\t\tonStop={ handleStop }\n\t\t/>\n\t);\n\n\t// Render as portal at document body level.\n\treturn createPortal( panelContent, document.body );\n}\n","/**\n * Apply preconditions before step execution.\n *\n * Ensures the UI is in the expected state before presenting a step\n * (e.g., sidebar open, inserter closed, specific tab selected).\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { select, dispatch } from '@wordpress/data';\n\n/**\n * @typedef {import('../types/step.js').Precondition} Precondition\n */\n\n/**\n * Wait for a selector to match an element.\n *\n * @param {string} selector CSS selector.\n * @param {number} timeout  Timeout in ms.\n * @return {Promise<HTMLElement|null>} Element or null.\n */\nasync function waitForSelector( selector, timeout = 2000 ) {\n\tconst startTime = Date.now();\n\n\treturn new Promise( ( resolve ) => {\n\t\tconst check = () => {\n\t\t\tconst element = document.querySelector( selector );\n\t\t\tif ( element ) {\n\t\t\t\tresolve( element );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( Date.now() - startTime > timeout ) {\n\t\t\t\tresolve( null );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFrame( check );\n\t\t};\n\n\t\tcheck();\n\t} );\n}\n\n/**\n * Wait for a condition to be true.\n *\n * @param {Function} conditionFn Function returning boolean.\n * @param {number}   timeout     Timeout in ms.\n * @return {Promise<boolean>} True if condition met.\n */\nasync function waitForCondition( conditionFn, timeout = 2000 ) {\n\tconst startTime = Date.now();\n\n\treturn new Promise( ( resolve ) => {\n\t\tconst check = () => {\n\t\t\ttry {\n\t\t\t\tif ( conditionFn() ) {\n\t\t\t\t\tresolve( true );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Condition function threw, keep trying.\n\t\t\t}\n\n\t\t\tif ( Date.now() - startTime > timeout ) {\n\t\t\t\tresolve( false );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFrame( check );\n\t\t};\n\n\t\tcheck();\n\t} );\n}\n\n/**\n * Ensure we're in the block editor.\n *\n * @return {Promise<boolean>} True if in editor.\n */\nasync function ensureEditor() {\n\t// Check if we're in the block editor.\n\tconst editorStore = select( 'core/block-editor' );\n\tif ( ! editorStore ) {\n\t\treturn false;\n\t}\n\n\t// Wait for editor to be ready.\n\treturn waitForCondition( () => {\n\t\tconst blocks = editorStore.getBlocks?.();\n\t\treturn blocks !== undefined;\n\t} );\n}\n\n/**\n * Ensure the editor sidebar is open.\n *\n * @param {string} preferredSidebar Optional preferred sidebar ('edit-post/document', 'edit-post/block').\n * @return {Promise<boolean>} True if successful.\n */\nasync function ensureSidebarOpen( preferredSidebar = null ) {\n\tconst editPostStore = select( 'core/edit-post' );\n\tconst editPostDispatch = dispatch( 'core/edit-post' );\n\n\tif ( ! editPostStore || ! editPostDispatch ) {\n\t\t// Try interface store (newer WP versions).\n\t\tconst interfaceStore = select( 'core/interface' );\n\t\tconst interfaceDispatch = dispatch( 'core/interface' );\n\n\t\tif ( interfaceStore && interfaceDispatch ) {\n\t\t\tconst activeItem = interfaceStore.getActiveComplementaryArea?.(\n\t\t\t\t'core/edit-post'\n\t\t\t);\n\n\t\t\tif ( ! activeItem ) {\n\t\t\t\tawait interfaceDispatch.enableComplementaryArea?.(\n\t\t\t\t\t'core/edit-post',\n\t\t\t\t\tpreferredSidebar || 'edit-post/document'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn waitForCondition( () => {\n\t\t\t\treturn !! interfaceStore.getActiveComplementaryArea?.(\n\t\t\t\t\t'core/edit-post'\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// Check if sidebar is already open.\n\tconst isOpen =\n\t\teditPostStore.isEditorSidebarOpened?.() ||\n\t\teditPostStore.isPluginSidebarOpened?.();\n\n\tif ( isOpen ) {\n\t\treturn true;\n\t}\n\n\t// Open the sidebar.\n\ttry {\n\t\tif ( preferredSidebar ) {\n\t\t\tawait editPostDispatch.openGeneralSidebar?.( preferredSidebar );\n\t\t} else {\n\t\t\tawait editPostDispatch.openGeneralSidebar?.( 'edit-post/document' );\n\t\t}\n\n\t\treturn waitForCondition( () => {\n\t\t\treturn editPostStore.isEditorSidebarOpened?.();\n\t\t} );\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Ensure the editor sidebar is closed.\n *\n * @return {Promise<boolean>} True if successful.\n */\nasync function ensureSidebarClosed() {\n\tconst editPostStore = select( 'core/edit-post' );\n\tconst editPostDispatch = dispatch( 'core/edit-post' );\n\n\tif ( ! editPostStore || ! editPostDispatch ) {\n\t\t// Try interface store.\n\t\tconst interfaceStore = select( 'core/interface' );\n\t\tconst interfaceDispatch = dispatch( 'core/interface' );\n\n\t\tif ( interfaceStore && interfaceDispatch ) {\n\t\t\tconst activeItem = interfaceStore.getActiveComplementaryArea?.(\n\t\t\t\t'core/edit-post'\n\t\t\t);\n\n\t\t\tif ( activeItem ) {\n\t\t\t\tawait interfaceDispatch.disableComplementaryArea?.(\n\t\t\t\t\t'core/edit-post'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn waitForCondition( () => {\n\t\t\t\treturn ! interfaceStore.getActiveComplementaryArea?.(\n\t\t\t\t\t'core/edit-post'\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// Check if sidebar is already closed.\n\tconst isOpen = editPostStore.isEditorSidebarOpened?.();\n\n\tif ( ! isOpen ) {\n\t\treturn true;\n\t}\n\n\t// Close the sidebar.\n\ttry {\n\t\tawait editPostDispatch.closeGeneralSidebar?.();\n\n\t\treturn waitForCondition( () => {\n\t\t\treturn ! editPostStore.isEditorSidebarOpened?.();\n\t\t} );\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Select a specific sidebar tab.\n *\n * @param {string} tabName Tab name ('document', 'block', or plugin sidebar name).\n * @return {Promise<boolean>} True if successful.\n */\nasync function selectSidebarTab( tabName ) {\n\tconst editPostDispatch = dispatch( 'core/edit-post' );\n\n\tif ( ! editPostDispatch ) {\n\t\treturn false;\n\t}\n\n\t// Map friendly names to sidebar identifiers.\n\tconst tabMap = {\n\t\tdocument: 'edit-post/document',\n\t\tpost: 'edit-post/document',\n\t\tblock: 'edit-post/block',\n\t};\n\n\tconst sidebarId = tabMap[ tabName ] || tabName;\n\n\ttry {\n\t\tawait editPostDispatch.openGeneralSidebar?.( sidebarId );\n\n\t\t// Wait for tab to be active.\n\t\treturn waitForCondition( () => {\n\t\t\tconst editPostStore = select( 'core/edit-post' );\n\t\t\treturn editPostStore?.getActiveGeneralSidebarName?.() === sidebarId;\n\t\t} );\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Open the block inserter.\n *\n * @return {Promise<boolean>} True if successful.\n */\nasync function openInserter() {\n\tconst editPostStore = select( 'core/edit-post' );\n\tconst editPostDispatch = dispatch( 'core/edit-post' );\n\n\t// Check if already open.\n\tif ( editPostStore?.isInserterOpened?.() ) {\n\t\treturn true;\n\t}\n\n\ttry {\n\t\tawait editPostDispatch?.setIsInserterOpened?.( true );\n\n\t\treturn waitForCondition( () => {\n\t\t\treturn editPostStore?.isInserterOpened?.();\n\t\t} );\n\t} catch {\n\t\t// Try clicking the inserter button.\n\t\tconst inserterButton = document.querySelector(\n\t\t\t'.edit-post-header-toolbar__inserter-toggle, ' +\n\t\t\t\t'button[aria-label*=\"inserter\"], ' +\n\t\t\t\t'button[aria-label*=\"Add block\"]'\n\t\t);\n\n\t\tif ( inserterButton ) {\n\t\t\tinserterButton.click();\n\t\t\treturn waitForSelector(\n\t\t\t\t'.block-editor-inserter__content, .editor-inserter__content'\n\t\t\t).then( ( el ) => !! el );\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\n/**\n * Close the block inserter.\n *\n * @return {Promise<boolean>} True if successful.\n */\nasync function closeInserter() {\n\tconst editPostStore = select( 'core/edit-post' );\n\tconst editPostDispatch = dispatch( 'core/edit-post' );\n\n\t// Check if already closed.\n\tif ( ! editPostStore?.isInserterOpened?.() ) {\n\t\treturn true;\n\t}\n\n\ttry {\n\t\tawait editPostDispatch?.setIsInserterOpened?.( false );\n\n\t\treturn waitForCondition( () => {\n\t\t\treturn ! editPostStore?.isInserterOpened?.();\n\t\t} );\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Select a specific block in the editor.\n *\n * @param {string} clientId Block client ID.\n * @return {Promise<boolean>} True if successful.\n */\nasync function selectBlock( clientId ) {\n\tconst blockEditorDispatch = dispatch( 'core/block-editor' );\n\n\tif ( ! blockEditorDispatch || ! clientId ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\tawait blockEditorDispatch.selectBlock?.( clientId );\n\n\t\treturn waitForCondition( () => {\n\t\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\t\treturn (\n\t\t\t\tblockEditorStore?.getSelectedBlockClientId?.() === clientId\n\t\t\t);\n\t\t} );\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Focus a specific element.\n *\n * @param {string} selector CSS selector.\n * @return {Promise<boolean>} True if successful.\n */\nasync function focusElement( selector ) {\n\tconst element = await waitForSelector( selector );\n\n\tif ( ! element ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\telement.focus();\n\t\treturn document.activeElement === element;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Scroll element into view.\n *\n * @param {string} selector CSS selector.\n * @return {Promise<boolean>} True if successful.\n */\nasync function scrollIntoView( selector ) {\n\tconst element = await waitForSelector( selector );\n\n\tif ( ! element ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\telement.scrollIntoView( {\n\t\t\tbehavior: 'smooth',\n\t\t\tblock: 'center',\n\t\t\tinline: 'center',\n\t\t} );\n\n\t\t// Wait a bit for smooth scroll.\n\t\tawait new Promise( ( resolve ) => setTimeout( resolve, 300 ) );\n\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Open a modal/popover by clicking a trigger.\n *\n * @param {string} triggerSelector Trigger element selector.\n * @param {string} modalSelector   Modal element selector to wait for.\n * @return {Promise<boolean>} True if successful.\n */\nasync function openModal( triggerSelector, modalSelector ) {\n\t// Check if modal is already open.\n\tconst existingModal = document.querySelector( modalSelector );\n\tif ( existingModal ) {\n\t\treturn true;\n\t}\n\n\tconst trigger = await waitForSelector( triggerSelector );\n\tif ( ! trigger ) {\n\t\treturn false;\n\t}\n\n\ttrigger.click();\n\n\treturn waitForSelector( modalSelector ).then( ( el ) => !! el );\n}\n\n/**\n * Global storage for blocks inserted by preconditions.\n * Used by wpBlock locator with 'inserted' value.\n * Exposed on window for cross-module access.\n *\n * Maps markerId -> clientId for direct lookups.\n */\nexport const insertedBlocks = new Map();\nwindow.__actInsertedBlocks = insertedBlocks;\n\n/**\n * Track blocks inserted per step for navigation.\n * Maps stepIndex -> { markerId: clientId }\n * This allows us to reuse blocks when navigating back/forward.\n */\nconst insertedBlocksByStep = new Map();\nlet currentStepIndex = 0;\n\n/**\n * Set the current step index for tracking.\n * Called by TourRunner when step changes.\n *\n * @param {number} stepIndex Current step index.\n */\nexport function setCurrentStepIndex( stepIndex ) {\n\tcurrentStepIndex = stepIndex;\n\tconsole.log( '[ACT setCurrentStepIndex]', stepIndex );\n}\n\n/**\n * Clear blocks when leaving a step.\n * Deselects the current block but preserves inserted blocks for reuse.\n *\n * @param {number} leavingStepIndex Step index being left.\n * @return {Promise<void>}\n */\nexport async function onLeaveStep( leavingStepIndex ) {\n\tconsole.log( '[ACT onLeaveStep] Leaving step:', leavingStepIndex );\n\n\tconst blockEditorDispatch = dispatch( 'core/block-editor' );\n\tconst blockEditorSelect = select( 'core/block-editor' );\n\n\tif ( ! blockEditorDispatch || ! blockEditorSelect ) {\n\t\treturn;\n\t}\n\n\t// Deselect current block when leaving.\n\tconst selectedClientId = blockEditorSelect.getSelectedBlockClientId?.();\n\tif ( selectedClientId ) {\n\t\ttry {\n\t\t\tawait blockEditorDispatch.clearSelectedBlock?.();\n\t\t\tconsole.log( '[ACT onLeaveStep] Deselected block:', selectedClientId );\n\t\t} catch ( e ) {\n\t\t\tconsole.warn( '[ACT onLeaveStep] Could not deselect block:', e );\n\t\t}\n\t}\n}\n\n/**\n * Called when entering a step.\n * Reselects previously inserted blocks if returning to a step.\n *\n * @param {number} enteringStepIndex Step index being entered.\n * @return {Promise<void>}\n */\nexport async function onEnterStep( enteringStepIndex ) {\n\tconsole.log( '[ACT onEnterStep] Entering step:', enteringStepIndex );\n\tsetCurrentStepIndex( enteringStepIndex );\n}\n\n/**\n * Clear all tracking when tour ends.\n */\nexport function clearInsertedBlocks() {\n\tinsertedBlocks.clear();\n\tinsertedBlocksByStep.clear();\n\tcurrentStepIndex = 0;\n\t// Also clear the last appeared block tracking.\n\tdelete window.__actLastAppearedBlockClientId;\n\tconsole.log( '[ACT clearInsertedBlocks] Cleared all tracking' );\n}\n\n/**\n * Get previously inserted block for a step/marker combo.\n *\n * @param {number} stepIndex Step index.\n * @param {string} markerId  Marker ID.\n * @return {string|null} Block clientId or null.\n */\nfunction getStepInsertedBlock( stepIndex, markerId ) {\n\tconst stepBlocks = insertedBlocksByStep.get( stepIndex );\n\tif ( stepBlocks && stepBlocks[ markerId ] ) {\n\t\treturn stepBlocks[ markerId ];\n\t}\n\treturn null;\n}\n\n/**\n * Store inserted block for a step.\n *\n * @param {number} stepIndex Step index.\n * @param {string} markerId  Marker ID.\n * @param {string} clientId  Block client ID.\n */\nfunction setStepInsertedBlock( stepIndex, markerId, clientId ) {\n\tif ( ! insertedBlocksByStep.has( stepIndex ) ) {\n\t\tinsertedBlocksByStep.set( stepIndex, {} );\n\t}\n\tinsertedBlocksByStep.get( stepIndex )[ markerId ] = clientId;\n}\n\n/**\n * Insert a block as a precondition.\n * Creates a block with a marker so we can target it later.\n * The block will be selected and focused after insertion.\n * If returning to a step that already inserted this block, reuses it.\n *\n * @param {string} blockName Block type name (e.g., 'core/paragraph').\n * @param {Object} attributes Optional block attributes.\n * @param {string} markerId Optional marker ID for retrieval.\n * @return {Promise<boolean>} True if successful.\n */\nasync function insertBlock( blockName = 'core/paragraph', attributes = {}, markerId = 'act-inserted-block' ) {\n\tconsole.log( '[ACT insertBlock] Called with:', { blockName, markerId, currentStepIndex } );\n\tconsole.log( '[ACT insertBlock] insertedBlocks map:', Array.from( insertedBlocks.entries() ) );\n\tconsole.log( '[ACT insertBlock] insertedBlocksByStep:', Array.from( insertedBlocksByStep.entries() ) );\n\t\n\ttry {\n\t\tconst { createBlock } = await import( '@wordpress/blocks' );\n\t\tconst blockEditorDispatch = dispatch( 'core/block-editor' );\n\t\tconst blockEditorSelect = select( 'core/block-editor' );\n\n\t\tif ( ! blockEditorDispatch || ! createBlock ) {\n\t\t\tconsole.warn( '[ACT insertBlock] Block editor not available' );\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if this step already inserted a block with this marker.\n\t\tconst stepClientId = getStepInsertedBlock( currentStepIndex, markerId );\n\t\tconsole.log( '[ACT insertBlock] stepClientId from getStepInsertedBlock:', stepClientId );\n\t\t\n\t\tif ( stepClientId ) {\n\t\t\tconst existingBlock = blockEditorSelect.getBlock( stepClientId );\n\t\t\tconsole.log( '[ACT insertBlock] existingBlock from store:', existingBlock?.name );\n\t\t\tif ( existingBlock ) {\n\t\t\t\t// Block still exists, select and focus it.\n\t\t\t\tawait blockEditorDispatch.selectBlock( stepClientId );\n\t\t\t\tawait focusBlockElement( stepClientId );\n\t\t\t\tconsole.log( '[ACT insertBlock] Reusing step block:', stepClientId, 'for step:', currentStepIndex );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// Block not in store - it may have been transformed/replaced.\n\t\t\t// Check if DOM element still exists and get its current clientId.\n\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\tconst targetDoc = iframe?.contentDocument || document;\n\t\t\tconst blockElement = targetDoc.querySelector( `[data-block=\"${ stepClientId }\"]` );\n\t\t\t\n\t\t\tif ( blockElement ) {\n\t\t\t\t// DOM element exists, select it.\n\t\t\t\tawait blockEditorDispatch.selectBlock( stepClientId );\n\t\t\t\tawait focusBlockElement( stepClientId );\n\t\t\t\tconsole.log( '[ACT insertBlock] Block still in DOM, reusing:', stepClientId );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\tconsole.log( '[ACT insertBlock] Block not in store or DOM, checking for any existing blocks of this type' );\n\t\t}\n\n\t\t// Fallback: check global marker map (for backwards compatibility).\n\t\tconsole.log( '[ACT insertBlock] Checking global map for:', markerId, 'has:', insertedBlocks.has( markerId ) );\n\t\tif ( insertedBlocks.has( markerId ) ) {\n\t\t\tconst existingClientId = insertedBlocks.get( markerId );\n\t\t\tconst existingBlock = blockEditorSelect.getBlock( existingClientId );\n\t\t\tconsole.log( '[ACT insertBlock] existingBlock from global map:', existingBlock?.name );\n\t\t\tif ( existingBlock ) {\n\t\t\t\t// Block still exists, select and focus it.\n\t\t\t\tawait blockEditorDispatch.selectBlock( existingClientId );\n\t\t\t\tawait focusBlockElement( existingClientId );\n\t\t\t\t// Track for this step too.\n\t\t\t\tsetStepInsertedBlock( currentStepIndex, markerId, existingClientId );\n\t\t\t\tconsole.log( '[ACT insertBlock] Reusing existing block:', existingClientId );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// Check DOM for this clientId too.\n\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\tconst targetDoc = iframe?.contentDocument || document;\n\t\t\tconst blockElement = targetDoc.querySelector( `[data-block=\"${ existingClientId }\"]` );\n\t\t\t\n\t\t\tif ( blockElement ) {\n\t\t\t\tawait blockEditorDispatch.selectBlock( existingClientId );\n\t\t\t\tawait focusBlockElement( existingClientId );\n\t\t\t\tsetStepInsertedBlock( currentStepIndex, markerId, existingClientId );\n\t\t\t\tconsole.log( '[ACT insertBlock] Block from global map still in DOM:', existingClientId );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// Final fallback: check if there's already a block of the target type we can use.\n\t\t// This handles the case where the block was transformed by WordPress.\n\t\tconst allBlocks = blockEditorSelect.getBlocks() || [];\n\t\tconsole.log( '[ACT insertBlock] Checking for existing blocks of type:', blockName, 'found:', allBlocks.length, 'total blocks' );\n\t\tconsole.log( '[ACT insertBlock] Block names in editor:', allBlocks.map( ( b ) => b.name ) );\n\t\t\n\t\tconst matchingBlock = allBlocks.find( ( b ) => b.name === blockName );\n\t\tif ( matchingBlock ) {\n\t\t\tconsole.log( '[ACT insertBlock] Found existing block of same type:', matchingBlock.clientId );\n\t\t\tawait blockEditorDispatch.selectBlock( matchingBlock.clientId );\n\t\t\tawait focusBlockElement( matchingBlock.clientId );\n\t\t\t// Update tracking with new clientId.\n\t\t\tinsertedBlocks.set( markerId, matchingBlock.clientId );\n\t\t\tsetStepInsertedBlock( currentStepIndex, markerId, matchingBlock.clientId );\n\t\t\tconsole.log( '[ACT insertBlock] Reusing existing block of type:', blockName );\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\t// If no exact match, try to find ANY block we can use (not empty).\n\t\t// The user may have typed in the placeholder, changing its type.\n\t\tif ( allBlocks.length > 0 ) {\n\t\t\t// Find the last non-empty block, or just the last block.\n\t\t\tconst lastBlock = allBlocks[ allBlocks.length - 1 ];\n\t\t\tconsole.log( '[ACT insertBlock] Considering last block:', lastBlock.name, lastBlock.clientId );\n\t\t\t\n\t\t\t// Only reuse text blocks for OTHER text block insertions.\n\t\t\t// Never reuse a paragraph when we need an image/video/etc.\n\t\t\tconst textBlockTypes = [ 'core/paragraph', 'core/heading', 'core/list', 'core/quote' ];\n\t\t\tconst isRequestingTextBlock = textBlockTypes.includes( blockName );\n\t\t\tconst isLastBlockText = textBlockTypes.includes( lastBlock.name );\n\t\t\t\n\t\t\t// Only reuse if BOTH are text blocks.\n\t\t\tif ( isRequestingTextBlock && isLastBlockText ) {\n\t\t\t\tconsole.log( '[ACT insertBlock] Reusing last text block instead of creating new:', lastBlock.clientId );\n\t\t\t\tawait blockEditorDispatch.selectBlock( lastBlock.clientId );\n\t\t\t\tawait focusBlockElement( lastBlock.clientId );\n\t\t\t\tinsertedBlocks.set( markerId, lastBlock.clientId );\n\t\t\t\tsetStepInsertedBlock( currentStepIndex, markerId, lastBlock.clientId );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tconsole.log( '[ACT insertBlock] No existing block found, creating new one' );\n\n\t\t// Create the block with marker in metadata.\n\t\tconst blockAttributes = {\n\t\t\t...attributes,\n\t\t\tmetadata: {\n\t\t\t\t...( attributes.metadata || {} ),\n\t\t\t\tactMarkerId: markerId,\n\t\t\t},\n\t\t};\n\n\t\tconst block = createBlock( blockName, blockAttributes );\n\n\t\t// Insert at the end of the root and select it.\n\t\tconst rootClientId = '';\n\t\tawait blockEditorDispatch.insertBlock( block, undefined, rootClientId, true );\n\n\t\t// Store the clientId for later retrieval (both global and per-step).\n\t\tinsertedBlocks.set( markerId, block.clientId );\n\t\tsetStepInsertedBlock( currentStepIndex, markerId, block.clientId );\n\n\t\t// Wait for the block to appear in DOM.\n\t\tconst success = await waitForCondition( () => {\n\t\t\t// Check in main document and iframe.\n\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\tconst iframeDoc = iframe?.contentDocument;\n\t\t\tconst targetDoc = iframeDoc || document;\n\t\t\treturn !! targetDoc.querySelector( `[data-block=\"${ block.clientId }\"]` );\n\t\t}, 3000 );\n\n\t\tif ( success ) {\n\t\t\t// Ensure the block is selected (sometimes insertBlock doesn't auto-select).\n\t\t\tawait blockEditorDispatch.selectBlock( block.clientId );\n\n\t\t\t// Focus the block element in the DOM.\n\t\t\tawait focusBlockElement( block.clientId );\n\t\t}\n\n\t\tconsole.log( '[ACT insertBlock] Inserted block:', block.clientId, 'markerId:', markerId, 'step:', currentStepIndex, 'success:', success );\n\n\t\treturn success;\n\t} catch ( error ) {\n\t\tconsole.error( '[ACT insertBlock] Error:', error );\n\t\treturn false;\n\t}\n}\n\n/**\n * Focus a block element in the DOM.\n * Handles both iframed and non-iframed editors.\n *\n * @param {string} clientId Block client ID.\n * @return {Promise<boolean>} True if focused.\n */\nasync function focusBlockElement( clientId ) {\n\t// Small delay to let React update the DOM.\n\tawait new Promise( ( resolve ) => setTimeout( resolve, 100 ) );\n\n\t// Find the block element.\n\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\tconst targetDoc = iframe?.contentDocument || document;\n\tconst blockElement = targetDoc.querySelector( `[data-block=\"${ clientId }\"]` );\n\n\tif ( ! blockElement ) {\n\t\tconsole.warn( '[ACT focusBlockElement] Block element not found:', clientId );\n\t\treturn false;\n\t}\n\n\t// Find the editable element within the block.\n\tconst editableSelectors = [\n\t\t'[contenteditable=\"true\"]',\n\t\t'.block-editor-rich-text__editable',\n\t\t'textarea',\n\t\t'input[type=\"text\"]',\n\t\t'input:not([type])',\n\t];\n\n\tlet focusTarget = null;\n\tfor ( const selector of editableSelectors ) {\n\t\tfocusTarget = blockElement.querySelector( selector );\n\t\tif ( focusTarget ) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// If no editable found, focus the block itself.\n\tif ( ! focusTarget ) {\n\t\tfocusTarget = blockElement;\n\t}\n\n\t// Scroll into view and focus.\n\tfocusTarget.scrollIntoView( { behavior: 'smooth', block: 'center' } );\n\tfocusTarget.focus();\n\n\t// For contenteditable, also set selection to the end.\n\tif ( focusTarget.getAttribute( 'contenteditable' ) === 'true' ) {\n\t\tconst selection = targetDoc.getSelection();\n\t\tconst range = targetDoc.createRange();\n\t\trange.selectNodeContents( focusTarget );\n\t\trange.collapse( false ); // Collapse to end.\n\t\tselection?.removeAllRanges();\n\t\tselection?.addRange( range );\n\t}\n\n\tconsole.log( '[ACT focusBlockElement] Focused:', focusTarget.tagName, focusTarget.className );\n\treturn true;\n}\n\n/**\n * Close any open modals/popovers.\n *\n * @param {string} modalSelector Modal selector.\n * @return {Promise<boolean>} True if closed or already closed.\n */\nasync function closeModal( modalSelector ) {\n\tconst modal = document.querySelector( modalSelector );\n\n\tif ( ! modal ) {\n\t\treturn true;\n\t}\n\n\t// Try close button.\n\tconst closeButton = modal.querySelector(\n\t\t'button[aria-label=\"Close\"], ' +\n\t\t\t'.components-modal__header button, ' +\n\t\t\t'.components-popover__close'\n\t);\n\n\tif ( closeButton ) {\n\t\tcloseButton.click();\n\t\treturn waitForCondition( () => {\n\t\t\treturn ! document.querySelector( modalSelector );\n\t\t} );\n\t}\n\n\t// Try pressing Escape.\n\tdocument.dispatchEvent(\n\t\tnew KeyboardEvent( 'keydown', {\n\t\t\tkey: 'Escape',\n\t\t\tcode: 'Escape',\n\t\t\tbubbles: true,\n\t\t} )\n\t);\n\n\treturn waitForCondition( () => {\n\t\treturn ! document.querySelector( modalSelector );\n\t} );\n}\n\n/**\n * Precondition handlers.\n */\nconst preconditionHandlers = {\n\tensureEditor,\n\tensureSidebarOpen,\n\tensureSidebarClosed,\n\tselectSidebarTab,\n\topenInserter,\n\tcloseInserter,\n\tselectBlock,\n\tfocusElement,\n\tscrollIntoView,\n\topenModal,\n\tcloseModal,\n\tinsertBlock,\n};\n\n/**\n * Apply a single precondition.\n *\n * @param {Precondition} precondition Precondition to apply.\n * @return {Promise<Object>} Result with success flag.\n */\nexport async function applyPrecondition( precondition ) {\n\tconst { type, params = {} } = precondition;\n\n\tconst handler = preconditionHandlers[ type ];\n\n\tif ( ! handler ) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: `Unknown precondition type: ${ type }`,\n\t\t\ttype,\n\t\t};\n\t}\n\n\ttry {\n\t\t// Convert params object to arguments based on type.\n\t\tlet result;\n\n\t\tswitch ( type ) {\n\t\t\tcase 'ensureEditor':\n\t\t\t\tresult = await handler();\n\t\t\t\tbreak;\n\n\t\t\tcase 'ensureSidebarOpen':\n\t\t\t\tresult = await handler( params.sidebar );\n\t\t\t\tbreak;\n\n\t\t\tcase 'ensureSidebarClosed':\n\t\t\t\tresult = await handler();\n\t\t\t\tbreak;\n\n\t\t\tcase 'selectSidebarTab':\n\t\t\t\tresult = await handler( params.tab );\n\t\t\t\tbreak;\n\n\t\t\tcase 'openInserter':\n\t\t\tcase 'closeInserter':\n\t\t\t\tresult = await handler();\n\t\t\t\tbreak;\n\n\t\t\tcase 'selectBlock':\n\t\t\t\tresult = await handler( params.clientId );\n\t\t\t\tbreak;\n\n\t\t\tcase 'focusElement':\n\t\t\tcase 'scrollIntoView':\n\t\t\t\tresult = await handler( params.selector );\n\t\t\t\tbreak;\n\n\t\t\tcase 'openModal':\n\t\t\t\tresult = await handler( params.trigger, params.modal );\n\t\t\t\tbreak;\n\n\t\t\tcase 'closeModal':\n\t\t\t\tresult = await handler( params.modal );\n\t\t\t\tbreak;\n\n\t\t\tcase 'insertBlock':\n\t\t\t\tresult = await handler(\n\t\t\t\t\tparams.blockName || 'core/paragraph',\n\t\t\t\t\tparams.attributes || {},\n\t\t\t\t\tparams.markerId || 'act-inserted-block'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tresult = false;\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: result,\n\t\t\ttype,\n\t\t\terror: result ? null : `Precondition failed: ${ type }`,\n\t\t};\n\t} catch ( error ) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\ttype,\n\t\t\terror: `Precondition error: ${ error.message }`,\n\t\t};\n\t}\n}\n\n/**\n * Apply all preconditions for a step in order.\n *\n * @param {Precondition[]} preconditions Array of preconditions.\n * @return {Promise<Object>} Result with overall success and details.\n */\nexport async function applyPreconditions( preconditions ) {\n\tif ( ! preconditions || preconditions.length === 0 ) {\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tresults: [],\n\t\t};\n\t}\n\n\tconst results = [];\n\tlet allSuccessful = true;\n\n\tfor ( const precondition of preconditions ) {\n\t\tconst result = await applyPrecondition( precondition );\n\t\tresults.push( result );\n\n\t\tif ( ! result.success ) {\n\t\t\tallSuccessful = false;\n\t\t\t// Continue to try other preconditions.\n\t\t}\n\t}\n\n\treturn {\n\t\tsuccess: allSuccessful,\n\t\tresults,\n\t\tfailedPreconditions: results.filter( ( r ) => ! r.success ),\n\t};\n}\n\n/**\n * Get available precondition types with descriptions.\n *\n * @return {Object[]} Array of precondition type info.\n */\nexport function getAvailablePreconditions() {\n\treturn [\n\t\t{\n\t\t\ttype: 'ensureEditor',\n\t\t\tlabel: 'Ensure in Editor',\n\t\t\tdescription: 'Verify block editor is loaded and ready',\n\t\t\tparams: [],\n\t\t},\n\t\t{\n\t\t\ttype: 'ensureSidebarOpen',\n\t\t\tlabel: 'Open Sidebar',\n\t\t\tdescription: 'Ensure editor sidebar is open',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'sidebar',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Preferred sidebar (edit-post/document, edit-post/block)',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'ensureSidebarClosed',\n\t\t\tlabel: 'Close Sidebar',\n\t\t\tdescription: 'Ensure editor sidebar is closed',\n\t\t\tparams: [],\n\t\t},\n\t\t{\n\t\t\ttype: 'selectSidebarTab',\n\t\t\tlabel: 'Select Sidebar Tab',\n\t\t\tdescription: 'Switch to specific sidebar tab',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'tab',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Tab name (document, block, or plugin sidebar)',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'openInserter',\n\t\t\tlabel: 'Open Inserter',\n\t\t\tdescription: 'Open the block inserter panel',\n\t\t\tparams: [],\n\t\t},\n\t\t{\n\t\t\ttype: 'closeInserter',\n\t\t\tlabel: 'Close Inserter',\n\t\t\tdescription: 'Close the block inserter panel',\n\t\t\tparams: [],\n\t\t},\n\t\t{\n\t\t\ttype: 'selectBlock',\n\t\t\tlabel: 'Select Block',\n\t\t\tdescription: 'Select a specific block by client ID',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'clientId',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Block client ID',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'focusElement',\n\t\t\tlabel: 'Focus Element',\n\t\t\tdescription: 'Focus a specific element',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'selector',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'CSS selector',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'scrollIntoView',\n\t\t\tlabel: 'Scroll Into View',\n\t\t\tdescription: 'Scroll element into viewport',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'selector',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'CSS selector',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'openModal',\n\t\t\tlabel: 'Open Modal',\n\t\t\tdescription: 'Click trigger and wait for modal',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'trigger',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Trigger element selector',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'modal',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Modal element selector',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'closeModal',\n\t\t\tlabel: 'Close Modal',\n\t\t\tdescription: 'Close an open modal',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'modal',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Modal element selector',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'insertBlock',\n\t\t\tlabel: 'Insert Block',\n\t\t\tdescription: 'Insert a block into the editor (creates targetable element)',\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'blockName',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Block type (default: core/paragraph)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'attributes',\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Block attributes',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'markerId',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Marker ID for targeting with wpBlock:inserted locator',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t];\n}\n\nexport default applyPreconditions;\n","/**\n * Ensure Empty Block Placeholder Exists.\n *\n * Checks if there's an empty paragraph block in the editor.\n * If not, inserts one so tours can use the \"/\" quick inserter workflow.\n *\n * @package AdminCoachTours\n * @since   0.3.1\n */\n\nimport { select, dispatch } from '@wordpress/data';\n\n/**\n * Check if an empty paragraph block exists in the editor.\n *\n * @return {boolean} True if an empty paragraph exists.\n */\nexport function hasEmptyParagraph() {\n\ttry {\n\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\tif ( ! blockEditorStore?.getBlocks ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blocks = blockEditorStore.getBlocks();\n\t\tconst emptyParagraph = blocks.find(\n\t\t\t( block ) =>\n\t\t\t\tblock.name === 'core/paragraph' &&\n\t\t\t\tisEmptyContent( block.attributes?.content )\n\t\t);\n\n\t\treturn !! emptyParagraph;\n\t} catch ( e ) {\n\t\tconsole.warn( '[ACT] Error checking for empty paragraph:', e );\n\t\treturn false;\n\t}\n}\n\n/**\n * Check if content is considered empty.\n * Handles various empty states: undefined, null, empty string, whitespace-only,\n * and WordPress RichTextData objects.\n *\n * @param {*} content Block content attribute.\n * @return {boolean} True if content is empty.\n */\nfunction isEmptyContent( content ) {\n\tif ( content === undefined || content === null || content === '' ) {\n\t\treturn true;\n\t}\n\t// Handle RichText value (might be a string with only whitespace/newlines)\n\tif ( typeof content === 'string' ) {\n\t\treturn content.trim() === '';\n\t}\n\t// Handle RichTextData object (WordPress 6.x+)\n\t// RichTextData has toString(), toJSON(), and length properties\n\tif ( typeof content === 'object' && content !== null ) {\n\t\t// Check if it has a length property (RichTextData)\n\t\tif ( typeof content.length === 'number' ) {\n\t\t\treturn content.length === 0;\n\t\t}\n\t\t// Try toString() method\n\t\tif ( typeof content.toString === 'function' ) {\n\t\t\tconst str = content.toString();\n\t\t\t// Avoid \"[object Object]\" from default toString\n\t\t\tif ( str !== '[object Object]' ) {\n\t\t\t\treturn str.trim() === '';\n\t\t\t}\n\t\t}\n\t\t// Try toJSON() for serializable values\n\t\tif ( typeof content.toJSON === 'function' ) {\n\t\t\tconst json = content.toJSON();\n\t\t\tif ( typeof json === 'string' ) {\n\t\t\t\treturn json.trim() === '';\n\t\t\t}\n\t\t}\n\t}\n\t// Handle empty array (shouldn't happen but just in case)\n\tif ( Array.isArray( content ) && content.length === 0 ) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n/**\n * Insert an empty paragraph block at the end of the editor content and select it.\n *\n * @return {Promise<string|null>} The clientId of the inserted block, or null on failure.\n */\nexport async function insertEmptyParagraph() {\n\ttry {\n\t\tconst { createBlock } = await import( '@wordpress/blocks' );\n\t\tconst blockEditorDispatch = dispatch( 'core/block-editor' );\n\n\t\tif ( ! blockEditorDispatch || ! createBlock ) {\n\t\t\tconsole.warn( '[ACT] Block editor not available for inserting paragraph' );\n\t\t\treturn null;\n\t\t}\n\n\t\t// Create an empty paragraph block.\n\t\tconst block = createBlock( 'core/paragraph', { content: '' } );\n\n\t\t// Get current blocks to determine insertion position.\n\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\tconst blocks = blockEditorStore?.getBlocks() || [];\n\t\tconst insertIndex = blocks.length;\n\n\t\t// Insert at the end.\n\t\tawait blockEditorDispatch.insertBlock( block, insertIndex, '', false );\n\n\t\t// Select the block so it becomes active and editable.\n\t\tawait blockEditorDispatch.selectBlock( block.clientId );\n\n\t\tconsole.log( '[ACT] Inserted and selected empty paragraph block:', block.clientId );\n\n\t\treturn block.clientId;\n\t} catch ( e ) {\n\t\tconsole.error( '[ACT] Error inserting empty paragraph:', e );\n\t\treturn null;\n\t}\n}\n\n/**\n * Wait for a condition to be true, polling at intervals.\n *\n * @param {Function} conditionFn Function that returns true when condition is met.\n * @param {number}   timeout     Maximum time to wait in ms.\n * @param {number}   interval    Polling interval in ms.\n * @return {Promise<boolean>} True if condition met, false if timeout.\n */\nasync function waitForCondition( conditionFn, timeout = 3000, interval = 50 ) {\n\tconst startTime = Date.now();\n\twhile ( Date.now() - startTime < timeout ) {\n\t\tif ( conditionFn() ) {\n\t\t\treturn true;\n\t\t}\n\t\tawait new Promise( ( resolve ) => setTimeout( resolve, interval ) );\n\t}\n\treturn false;\n}\n\n/**\n * Focus a block element in the editor.\n *\n * @param {string} clientId The block client ID.\n * @return {Promise<boolean>} True if focused successfully.\n */\nasync function focusBlock( clientId ) {\n\t// Small delay to let React update the DOM.\n\tawait new Promise( ( resolve ) => setTimeout( resolve, 100 ) );\n\n\t// Find the block element.\n\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\tconst targetDoc = iframe?.contentDocument || document;\n\tconst blockElement = targetDoc.querySelector( `[data-block=\"${ clientId }\"]` );\n\n\tif ( ! blockElement ) {\n\t\tconsole.warn( '[ACT focusBlock] Block element not found:', clientId );\n\t\treturn false;\n\t}\n\n\t// Find the editable element within the block.\n\tconst editableSelectors = [\n\t\t'[contenteditable=\"true\"]',\n\t\t'.block-editor-rich-text__editable',\n\t\t'textarea',\n\t\t'input[type=\"text\"]',\n\t];\n\n\tlet focusTarget = null;\n\tfor ( const selector of editableSelectors ) {\n\t\tfocusTarget = blockElement.querySelector( selector );\n\t\tif ( focusTarget ) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// If no editable found, focus the block itself.\n\tif ( ! focusTarget ) {\n\t\tfocusTarget = blockElement;\n\t}\n\n\t// Scroll into view and focus.\n\tfocusTarget.scrollIntoView( { behavior: 'smooth', block: 'center' } );\n\tfocusTarget.focus();\n\n\t// For contenteditable, also set selection/cursor position.\n\tif ( focusTarget.getAttribute( 'contenteditable' ) === 'true' ) {\n\t\tconst selection = targetDoc.getSelection();\n\t\tconst range = targetDoc.createRange();\n\t\trange.selectNodeContents( focusTarget );\n\t\trange.collapse( false ); // Collapse to end.\n\t\tselection?.removeAllRanges();\n\t\tselection?.addRange( range );\n\t}\n\n\tconsole.log( '[ACT focusBlock] Focused:', focusTarget.tagName, focusTarget.className );\n\treturn true;\n}\n\n/**\n * Ensure an empty paragraph block exists in the editor.\n *\n * If no empty paragraph exists, inserts one at the end.\n * This is needed for tours that use the \"/\" quick inserter workflow.\n *\n * @return {Promise<Object>} Result object with wasInserted boolean and optional clientId.\n */\nexport async function ensureEmptyPlaceholder() {\n\tconst exists = hasEmptyParagraph();\n\n\tif ( exists ) {\n\t\t// Find and select the existing empty paragraph.\n\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\tconst blocks = blockEditorStore?.getBlocks() || [];\n\t\tconst emptyParagraph = blocks.find(\n\t\t\t( block ) =>\n\t\t\t\tblock.name === 'core/paragraph' &&\n\t\t\t\tisEmptyContent( block.attributes?.content )\n\t\t);\n\t\tif ( emptyParagraph ) {\n\t\t\tawait dispatch( 'core/block-editor' ).selectBlock( emptyParagraph.clientId );\n\t\t\tconsole.log( '[ACT] Selected existing empty paragraph:', emptyParagraph.clientId );\n\t\t\t// Focus the block element to ensure it's ready for interaction.\n\t\t\tawait focusBlock( emptyParagraph.clientId );\n\t\t}\n\t\treturn { wasInserted: false, clientId: emptyParagraph?.clientId || null };\n\t}\n\n\tconsole.log( '[ACT] No empty paragraph found, inserting one' );\n\tconst clientId = await insertEmptyParagraph();\n\n\tif ( ! clientId ) {\n\t\treturn { wasInserted: false, clientId: null };\n\t}\n\n\t// Wait for the block element to appear in DOM (check both main doc and iframe).\n\tconst success = await waitForCondition( () => {\n\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\tconst iframeDoc = iframe?.contentDocument;\n\t\tconst targetDoc = iframeDoc || document;\n\t\treturn !! targetDoc.querySelector( `[data-block=\"${ clientId }\"]` );\n\t}, 3000 );\n\n\tif ( success ) {\n\t\tconsole.log( '[ACT] Block appeared in DOM:', clientId );\n\t\t// Focus the block element to ensure it's ready for interaction.\n\t\tawait focusBlock( clientId );\n\t} else {\n\t\tconsole.warn( '[ACT] Block inserted but not found in DOM:', clientId );\n\t}\n\n\treturn { wasInserted: true, clientId };\n}\n\nexport default ensureEmptyPlaceholder;\n","/**\n * Gather Editor Context for AI Tour Generation.\n *\n * Collects information about the current editor state to help AI\n * generate accurate tour steps with working selectors.\n *\n * @package AdminCoachTours\n * @since   0.3.0\n */\n\nimport { select } from '@wordpress/data';\n\n/**\n * Get visible UI elements in the editor.\n *\n * @return {Object} Information about visible UI elements.\n */\nfunction getVisibleElements() {\n\tconst elements = {\n\t\tinserterOpen: false,\n\t\tsidebarOpen: false,\n\t\tsidebarTab: null,\n\t\ttoolbarVisible: false,\n\t\thasSelectedBlock: false,\n\t\tselectedBlockType: null,\n\t};\n\n\ttry {\n\t\t// Check if inserter is open.\n\t\tconst editorStore = select( 'core/editor' );\n\t\tif ( editorStore?.isInserterOpened ) {\n\t\t\telements.inserterOpen = editorStore.isInserterOpened();\n\t\t}\n\n\t\t// Check sidebar state.\n\t\tconst editPostStore = select( 'core/edit-post' );\n\t\tif ( editPostStore?.getActiveGeneralSidebarName ) {\n\t\t\tconst sidebarName = editPostStore.getActiveGeneralSidebarName();\n\t\t\telements.sidebarOpen = !! sidebarName;\n\t\t\telements.sidebarTab = sidebarName || null;\n\t\t}\n\n\t\t// Check block selection.\n\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\tif ( blockEditorStore?.getSelectedBlock ) {\n\t\t\tconst selectedBlock = blockEditorStore.getSelectedBlock();\n\t\t\telements.hasSelectedBlock = !! selectedBlock;\n\t\t\telements.selectedBlockType = selectedBlock?.name || null;\n\t\t}\n\n\t\t// Check toolbar visibility.\n\t\telements.toolbarVisible = !! document.querySelector( '.block-editor-block-toolbar' );\n\t} catch ( e ) {\n\t\tconsole.warn( '[ACT] Error getting visible elements:', e );\n\t}\n\n\treturn elements;\n}\n\n/**\n * Get current blocks in the editor with DOM information.\n *\n * @return {Array} List of block types currently in the editor with targeting info.\n */\nfunction getEditorBlocks() {\n\ttry {\n\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\tif ( ! blockEditorStore?.getBlocks ) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst blocks = blockEditorStore.getBlocks();\n\t\tconst selectedClientId = blockEditorStore.getSelectedBlockClientId?.() || null;\n\n\t\t// Get the editor iframe for DOM lookups.\n\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\tconst iframeDoc = iframe?.contentDocument || null;\n\n\t\treturn blocks.map( ( block, index ) => {\n\t\t\tconst blockInfo = {\n\t\t\t\tname: block.name,\n\t\t\t\tclientId: block.clientId,\n\t\t\t\tisEmpty: isBlockEmpty( block ),\n\t\t\t\tisSelected: block.clientId === selectedClientId,\n\t\t\t\torder: index,\n\t\t\t};\n\n\t\t\t// Look up the DOM element for this block to get real selectors.\n\t\t\tif ( iframeDoc ) {\n\t\t\t\tconst blockEl = iframeDoc.querySelector( `[data-block=\"${ block.clientId }\"]` );\n\t\t\t\tif ( blockEl ) {\n\t\t\t\t\tblockInfo.domInfo = {\n\t\t\t\t\t\ttagName: blockEl.tagName.toLowerCase(),\n\t\t\t\t\t\tdataType: blockEl.getAttribute( 'data-type' ),\n\t\t\t\t\t\tdataBlock: block.clientId,\n\t\t\t\t\t\thasRichText: !! blockEl.querySelector( '.block-editor-rich-text__editable' ),\n\t\t\t\t\t\t// For empty paragraphs, get the editable element's info.\n\t\t\t\t\t\teditableSelector: blockEl.querySelector( '.block-editor-rich-text__editable' )\n\t\t\t\t\t\t\t? `[data-block=\"${ block.clientId }\"] .block-editor-rich-text__editable`\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn blockInfo;\n\t\t} );\n\t} catch ( e ) {\n\t\tconsole.warn( '[ACT] Error getting editor blocks:', e );\n\t\treturn [];\n\t}\n}\n\n/**\n * Check if a block is empty.\n *\n * @param {Object} block Block object.\n * @return {boolean} True if block is empty.\n */\nfunction isBlockEmpty( block ) {\n\tif ( ! block ) {\n\t\treturn true;\n\t}\n\n\t// Paragraph blocks are empty if they have no content.\n\tif ( block.name === 'core/paragraph' ) {\n\t\treturn ! block.attributes?.content || block.attributes.content === '';\n\t}\n\n\t// Image blocks are empty if they have no URL.\n\tif ( block.name === 'core/image' ) {\n\t\treturn ! block.attributes?.url;\n\t}\n\n\t// Video blocks are empty if they have no src.\n\tif ( block.name === 'core/video' ) {\n\t\treturn ! block.attributes?.src;\n\t}\n\n\t// Default to not empty.\n\treturn false;\n}\n\n/**\n * Sample key UI elements from the page to help AI generate accurate selectors.\n *\n * @return {Object} Information about available UI elements.\n */\nfunction sampleUIElements() {\n\tconst samples = {\n\t\tinserterButton: null,\n\t\tpublishButton: null,\n\t\tsettingsButton: null,\n\t\tsearchInput: null,\n\t\temptyBlockPlaceholder: null,\n\t};\n\n\ttry {\n\t\t// Sample inserter button.\n\t\tconst inserterSelectors = [\n\t\t\t'.editor-document-tools__inserter-toggle',\n\t\t\t'button.block-editor-inserter-toggle',\n\t\t\t'[aria-label=\"Toggle block inserter\"]',\n\t\t];\n\t\tfor ( const sel of inserterSelectors ) {\n\t\t\tconst el = document.querySelector( sel );\n\t\t\tif ( el ) {\n\t\t\t\tsamples.inserterButton = {\n\t\t\t\t\tselector: sel,\n\t\t\t\t\tariaLabel: el.getAttribute( 'aria-label' ) || null,\n\t\t\t\t\tvisible: isElementVisible( el ),\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Sample publish/save button.\n\t\tconst publishSelectors = [\n\t\t\t'.editor-post-publish-button',\n\t\t\t'.editor-post-save-draft',\n\t\t];\n\t\tfor ( const sel of publishSelectors ) {\n\t\t\tconst el = document.querySelector( sel );\n\t\t\tif ( el ) {\n\t\t\t\tsamples.publishButton = {\n\t\t\t\t\tselector: sel,\n\t\t\t\t\ttext: el.textContent?.trim() || null,\n\t\t\t\t\tvisible: isElementVisible( el ),\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Sample settings button.\n\t\tconst settingsBtn = document.querySelector( 'button[aria-label=\"Settings\"]' );\n\t\tif ( settingsBtn ) {\n\t\t\tsamples.settingsButton = {\n\t\t\t\tselector: 'button[aria-label=\"Settings\"]',\n\t\t\t\tvisible: isElementVisible( settingsBtn ),\n\t\t\t};\n\t\t}\n\n\t\t// Sample search input in inserter (if open).\n\t\tconst searchInput = document.querySelector( '.components-search-control__input' );\n\t\tif ( searchInput ) {\n\t\t\tsamples.searchInput = {\n\t\t\t\tselector: '.components-search-control__input',\n\t\t\t\tvisible: isElementVisible( searchInput ),\n\t\t\t};\n\t\t}\n\n\t\t// Sample empty block placeholder (the \"Type / to choose a block\" element).\n\t\t// This appears in empty posts and is an important starting point.\n\t\tconst placeholderSelectors = [\n\t\t\t// Inside the editor iframe.\n\t\t\t{ selector: '.block-editor-default-block-appender__content', inIframe: true },\n\t\t\t{ selector: '[data-empty=\"true\"] .block-editor-rich-text__editable', inIframe: true },\n\t\t\t{ selector: 'p[data-empty=\"true\"]', inIframe: true },\n\t\t\t// In case it's not in iframe (older WP).\n\t\t\t{ selector: '.block-editor-default-block-appender__content', inIframe: false },\n\t\t];\n\n\t\tfor ( const { selector, inIframe } of placeholderSelectors ) {\n\t\t\tlet el = null;\n\n\t\t\tif ( inIframe ) {\n\t\t\t\t// Try to find in editor iframe.\n\t\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\t\tif ( iframe?.contentDocument ) {\n\t\t\t\t\tel = iframe.contentDocument.querySelector( selector );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tel = document.querySelector( selector );\n\t\t\t}\n\n\t\t\tif ( el ) {\n\t\t\t\tsamples.emptyBlockPlaceholder = {\n\t\t\t\t\tselector,\n\t\t\t\t\tinIframe,\n\t\t\t\t\tplaceholder: el.getAttribute( 'data-placeholder' ) || el.getAttribute( 'aria-label' ) || null,\n\t\t\t\t\tvisible: true, // If found, assume visible.\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.warn( '[ACT] Error sampling UI elements:', e );\n\t}\n\n\treturn samples;\n}\n\n/**\n * Check if an element is visible.\n *\n * @param {Element} el DOM element.\n * @return {boolean} True if element is visible.\n */\nfunction isElementVisible( el ) {\n\tif ( ! el ) {\n\t\treturn false;\n\t}\n\n\tconst rect = el.getBoundingClientRect();\n\tconst style = window.getComputedStyle( el );\n\n\treturn (\n\t\trect.width > 0 &&\n\t\trect.height > 0 &&\n\t\tstyle.visibility !== 'hidden' &&\n\t\tstyle.display !== 'none'\n\t);\n}\n\n/**\n * Gather complete editor context for AI tour generation.\n *\n * @return {Object} Editor context including blocks, UI state, and samples.\n */\nexport function gatherEditorContext() {\n\treturn {\n\t\teditorBlocks: getEditorBlocks(),\n\t\tvisibleElements: getVisibleElements(),\n\t\tuiSamples: sampleUIElements(),\n\t\twpVersion: window.adminCoachTours?.wpVersion || 'unknown',\n\t\ttimestamp: Date.now(),\n\t};\n}\n\nexport default gatherEditorContext;\n","/**\n * Resolve target element using locator bundle.\n *\n * Tries locators in weighted order, applies constraints, and handles\n * disambiguation of multiple matches.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\n/**\n * @typedef {import('../types/step.js').Target} Target\n * @typedef {import('../types/step.js').Locator} Locator\n * @typedef {import('../types/step.js').ResolutionResult} ResolutionResult\n */\n\n/**\n * Get the editor iframe's document if available.\n *\n * @return {Document|null} The iframe document or null.\n */\nfunction getEditorIframeDocument() {\n\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\treturn iframe?.contentDocument || null;\n}\n\n/**\n * Check if an element is visible.\n *\n * @param {HTMLElement} element Element to check.\n * @return {boolean} True if visible.\n */\nfunction isElementVisible( element ) {\n\tif ( ! element ) {\n\t\treturn false;\n\t}\n\n\t// Check if element is in DOM.\n\tif ( ! element.isConnected ) {\n\t\treturn false;\n\t}\n\n\t// Check computed styles.\n\tconst style = window.getComputedStyle( element );\n\tif (\n\t\tstyle.display === 'none' ||\n\t\tstyle.visibility === 'hidden' ||\n\t\tstyle.opacity === '0'\n\t) {\n\t\treturn false;\n\t}\n\n\t// Check if element has dimensions.\n\tconst rect = element.getBoundingClientRect();\n\tif ( rect.width === 0 && rect.height === 0 ) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Check if element is within the currently selected block OR the last inserted block.\n *\n * @param {HTMLElement} element Element to check.\n * @return {boolean} True if within selected/tracked block.\n */\nfunction isWithinSelectedBlock( element ) {\n\tconst wpData = window.wp?.data;\n\tif ( ! wpData ) {\n\t\tconsole.log( '[ACT isWithinSelectedBlock] wp.data not available' );\n\t\treturn true; // Can't check, allow element.\n\t}\n\n\tconst blockEditor = wpData.select( 'core/block-editor' );\n\tif ( ! blockEditor ) {\n\t\tconsole.log( '[ACT isWithinSelectedBlock] core/block-editor not available' );\n\t\treturn true;\n\t}\n\n\t// First, try the currently selected block.\n\tlet targetClientId = blockEditor.getSelectedBlockClientId();\n\tconsole.log( '[ACT isWithinSelectedBlock] Selected block clientId:', targetClientId );\n\n\t// If no block is selected, try the last tracked block from elementAppear.\n\tif ( ! targetClientId && window.__actLastAppearedBlockClientId ) {\n\t\ttargetClientId = window.__actLastAppearedBlockClientId;\n\t\tconsole.log( '[ACT isWithinSelectedBlock] Using last appeared block:', targetClientId );\n\t}\n\n\tif ( ! targetClientId ) {\n\t\tconsole.log( '[ACT isWithinSelectedBlock] No block to scope to, allowing element' );\n\t\treturn true; // No block to scope to, allow element.\n\t}\n\n\t// Find the target block's DOM element.\n\tconst ownerDoc = element.ownerDocument || document;\n\tconst targetBlockElement = ownerDoc.querySelector( `[data-block=\"${ targetClientId }\"]` );\n\n\tif ( ! targetBlockElement ) {\n\t\tconsole.log( '[ACT isWithinSelectedBlock] Target block element not found in DOM' );\n\t\treturn true; // Can't find block, allow element.\n\t}\n\n\t// Check if element is inside the target block.\n\tconst isWithin = targetBlockElement.contains( element );\n\tconsole.log( '[ACT isWithinSelectedBlock] Element within target block:', isWithin );\n\treturn isWithin;\n}\n\n/**\n * Check if element is within a container.\n *\n * @param {HTMLElement} element           Element to check.\n * @param {string}      containerSelector Container CSS selector.\n * @return {boolean} True if within container.\n */\nfunction isWithinContainer( element, containerSelector ) {\n\tif ( ! containerSelector ) {\n\t\treturn true;\n\t}\n\n\t// Search in the element's own document (handles iframe elements).\n\tconst ownerDoc = element.ownerDocument || document;\n\tconst container = ownerDoc.querySelector( containerSelector );\n\tif ( ! container ) {\n\t\treturn false;\n\t}\n\n\treturn container.contains( element );\n}\n\n/**\n * Find elements by CSS selector.\n *\n * @param {string}   selector CSS selector.\n * @param {Document} doc      Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByCSS( selector, doc = document ) {\n\ttry {\n\t\treturn Array.from( doc.querySelectorAll( selector ) );\n\t} catch {\n\t\treturn [];\n\t}\n}\n\n/**\n * Find elements by role and optional accessible name.\n *\n * @param {string}   value Role value, optionally with name: \"role:name\".\n * @param {Document} doc   Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByRole( value, doc = document ) {\n\tconst [ role, name ] = value.split( ':' ).map( ( s ) => s.trim() );\n\n\t// Find elements with explicit role attribute.\n\tconst withExplicitRole = Array.from(\n\t\tdoc.querySelectorAll( `[role=\"${ role }\"]` )\n\t);\n\n\t// Find elements with implicit roles (basic mapping).\n\tconst implicitRoleMap = {\n\t\tbutton: 'button, input[type=\"button\"], input[type=\"submit\"]',\n\t\ttextbox: 'input[type=\"text\"], input:not([type]), textarea',\n\t\tlink: 'a[href]',\n\t\tcheckbox: 'input[type=\"checkbox\"]',\n\t\tradio: 'input[type=\"radio\"]',\n\t\tlistbox: 'select',\n\t\toption: 'option',\n\t\theading: 'h1, h2, h3, h4, h5, h6',\n\t\timg: 'img[alt]',\n\t\tnavigation: 'nav',\n\t\tmain: 'main',\n\t\tcomplementary: 'aside',\n\t\tbanner: 'header',\n\t\tcontentinfo: 'footer',\n\t\tsearch: '[role=\"search\"]',\n\t\tform: 'form',\n\t\tregion: 'section[aria-label], section[aria-labelledby]',\n\t\ttab: '[role=\"tab\"]',\n\t\ttabpanel: '[role=\"tabpanel\"]',\n\t\ttablist: '[role=\"tablist\"]',\n\t\tmenu: '[role=\"menu\"]',\n\t\tmenuitem: '[role=\"menuitem\"]',\n\t\tdialog: 'dialog, [role=\"dialog\"]',\n\t};\n\n\tlet withImplicitRole = [];\n\tif ( implicitRoleMap[ role ] ) {\n\t\twithImplicitRole = Array.from(\n\t\t\tdoc.querySelectorAll( implicitRoleMap[ role ] )\n\t\t);\n\t}\n\n\tconst allMatches = [ ...withExplicitRole, ...withImplicitRole ];\n\n\t// Filter by name if provided.\n\tif ( name ) {\n\t\treturn allMatches.filter( ( el ) => {\n\t\t\tconst accessibleName = getAccessibleName( el );\n\t\t\treturn (\n\t\t\t\taccessibleName &&\n\t\t\t\taccessibleName.toLowerCase().includes( name.toLowerCase() )\n\t\t\t);\n\t\t} );\n\t}\n\n\treturn allMatches;\n}\n\n/**\n * Get accessible name for an element.\n *\n * @param {HTMLElement} element Element.\n * @return {string} Accessible name.\n */\nfunction getAccessibleName( element ) {\n\t// aria-label takes precedence.\n\tif ( element.getAttribute( 'aria-label' ) ) {\n\t\treturn element.getAttribute( 'aria-label' );\n\t}\n\n\t// aria-labelledby.\n\tconst labelledBy = element.getAttribute( 'aria-labelledby' );\n\tif ( labelledBy ) {\n\t\tconst labelEl = document.getElementById( labelledBy );\n\t\tif ( labelEl ) {\n\t\t\treturn labelEl.textContent?.trim() || '';\n\t\t}\n\t}\n\n\t// For inputs, check associated label.\n\tif ( element.id ) {\n\t\tconst label = document.querySelector( `label[for=\"${ element.id }\"]` );\n\t\tif ( label ) {\n\t\t\treturn label.textContent?.trim() || '';\n\t\t}\n\t}\n\n\t// Check title attribute.\n\tif ( element.getAttribute( 'title' ) ) {\n\t\treturn element.getAttribute( 'title' );\n\t}\n\n\t// Fall back to text content for buttons and links.\n\tif (\n\t\telement.tagName === 'BUTTON' ||\n\t\telement.tagName === 'A' ||\n\t\telement.getAttribute( 'role' ) === 'button'\n\t) {\n\t\treturn element.textContent?.trim() || '';\n\t}\n\n\t// Check for value on inputs.\n\tif ( element.tagName === 'INPUT' && element.value ) {\n\t\treturn element.value;\n\t}\n\n\treturn '';\n}\n\n/**\n * Find elements by test ID (data-testid attribute).\n *\n * @param {string}   testId Test ID value.\n * @param {Document} doc    Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByTestId( testId, doc = document ) {\n\treturn Array.from(\n\t\tdoc.querySelectorAll( `[data-testid=\"${ testId }\"]` )\n\t);\n}\n\n/**\n * Find elements by data attribute.\n *\n * @param {string}   value Data attribute in format \"attr:value\" or just \"attr\".\n * @param {Document} doc   Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByDataAttribute( value, doc = document ) {\n\tconst [ attr, attrValue ] = value.split( ':' ).map( ( s ) => s.trim() );\n\tconst selector = attrValue\n\t\t? `[data-${ attr }=\"${ attrValue }\"]`\n\t\t: `[data-${ attr }]`;\n\n\ttry {\n\t\treturn Array.from( doc.querySelectorAll( selector ) );\n\t} catch {\n\t\treturn [];\n\t}\n}\n\n/**\n * Find elements by aria-label.\n *\n * @param {string}   label Aria label text (partial match).\n * @param {Document} doc   Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByAriaLabel( label, doc = document ) {\n\tconst allWithLabel = Array.from(\n\t\tdoc.querySelectorAll( '[aria-label]' )\n\t);\n\n\treturn allWithLabel.filter( ( el ) => {\n\t\tconst elLabel = el.getAttribute( 'aria-label' );\n\t\treturn elLabel && elLabel.toLowerCase().includes( label.toLowerCase() );\n\t} );\n}\n\n/**\n * Find elements by contextual selector (ancestor > descendant).\n *\n * @param {string}   value Contextual selector string.\n * @param {Document} doc   Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByContextual( value, doc = document ) {\n\t// Format: \"container >> target\" or standard CSS.\n\tconst parts = value.split( '>>' ).map( ( s ) => s.trim() );\n\n\tif ( parts.length === 2 ) {\n\t\tconst [ containerSel, targetSel ] = parts;\n\t\tconst container = doc.querySelector( containerSel );\n\t\tif ( ! container ) {\n\t\t\treturn [];\n\t\t}\n\t\treturn Array.from( container.querySelectorAll( targetSel ) );\n\t}\n\n\t// Fall back to CSS.\n\treturn findByCSS( value );\n}\n\n/**\n * Find elements using WordPress block editor data store.\n *\n * Value formats:\n * - \"first\" - First block in the editor\n * - \"last\" - Last block in the editor\n * - \"selected\" - Currently selected block\n * - \"type:core/paragraph\" - First block of type\n * - \"type:core/paragraph:2\" - Third block of type (0-indexed)\n * - \"nth:0\" - Block at index 0\n * - \"inserted\" - Block inserted by insertBlock precondition (default marker)\n * - \"inserted:myMarker\" - Block inserted with specific marker ID\n *\n * @param {string}   value Block selector value.\n * @param {Document} doc   Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByWpBlock( value, doc = document ) {\n\t// Check for inserted block first (uses global map from preconditions).\n\tif ( value === 'inserted' || value.startsWith( 'inserted:' ) ) {\n\t\tconst markerId =\n\t\t\tvalue === 'inserted'\n\t\t\t\t? 'act-inserted-block'\n\t\t\t\t: value.substring( 9 );\n\n\t\tconst insertedBlocks = window.__actInsertedBlocks;\n\t\tconsole.log(\n\t\t\t'[ACT findByWpBlock] Looking for inserted block, markerId:',\n\t\t\tmarkerId,\n\t\t\t'map exists:',\n\t\t\t!! insertedBlocks,\n\t\t\t'has key:',\n\t\t\tinsertedBlocks?.has?.( markerId )\n\t\t);\n\t\t\n\t\tif ( insertedBlocks?.has?.( markerId ) ) {\n\t\t\tconst clientId = insertedBlocks.get( markerId );\n\t\t\tconsole.log(\n\t\t\t\t'[ACT findByWpBlock] Looking for inserted block:',\n\t\t\t\tmarkerId,\n\t\t\t\t'clientId:',\n\t\t\t\tclientId\n\t\t\t);\n\t\t\t\n\t\t\t// Search in both main doc and iframe for the element.\n\t\t\tlet element = doc.querySelector( `[data-block=\"${ clientId }\"]` );\n\t\t\t\n\t\t\t// If not found in provided doc, try iframe.\n\t\t\tif ( ! element ) {\n\t\t\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\t\t\tconst iframeDoc = iframe?.contentDocument;\n\t\t\t\tif ( iframeDoc && iframeDoc !== doc ) {\n\t\t\t\t\telement = iframeDoc.querySelector( `[data-block=\"${ clientId }\"]` );\n\t\t\t\t\tconsole.log( '[ACT findByWpBlock] Searched iframe, found:', !! element );\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// If still not found, try main document.\n\t\t\tif ( ! element && doc !== document ) {\n\t\t\t\telement = document.querySelector( `[data-block=\"${ clientId }\"]` );\n\t\t\t\tconsole.log( '[ACT findByWpBlock] Searched main doc, found:', !! element );\n\t\t\t}\n\t\t\t\n\t\t\tif ( element ) {\n\t\t\t\tconsole.log( '[ACT findByWpBlock] Found inserted block element' );\n\t\t\t\treturn [ element ];\n\t\t\t}\n\t\t}\n\t\tconsole.log(\n\t\t\t'[ACT findByWpBlock] Inserted block not found for marker:',\n\t\t\tmarkerId,\n\t\t\t'Available markers:',\n\t\t\tinsertedBlocks ? Array.from( insertedBlocks.keys() ) : 'none'\n\t\t);\n\t\treturn [];\n\t}\n\n\t// Access WordPress data store.\n\tconst wpData = window.wp?.data;\n\tif ( ! wpData ) {\n\t\tconsole.log( '[ACT findByWpBlock] wp.data not available' );\n\t\treturn [];\n\t}\n\n\tconst blockEditor = wpData.select( 'core/block-editor' );\n\tif ( ! blockEditor ) {\n\t\tconsole.log( '[ACT findByWpBlock] core/block-editor store not available' );\n\t\treturn [];\n\t}\n\n\tconst blocks = blockEditor.getBlocks();\n\tconsole.log( '[ACT findByWpBlock] Found', blocks.length, 'blocks in editor' );\n\n\tlet targetClientId = null;\n\n\tif ( value === 'first' ) {\n\t\ttargetClientId = blocks[ 0 ]?.clientId;\n\t} else if ( value === 'last' ) {\n\t\ttargetClientId = blocks[ blocks.length - 1 ]?.clientId;\n\t} else if ( value === 'selected' ) {\n\t\ttargetClientId = blockEditor.getSelectedBlockClientId();\n\t} else if ( value.startsWith( 'type:' ) ) {\n\t\t// Find block by type, optionally with index.\n\t\tconst parts = value.substring( 5 ).split( ':' );\n\t\tconst blockType = parts[ 0 ];\n\t\tconst index = parts[ 1 ] ? parseInt( parts[ 1 ], 10 ) : 0;\n\n\t\tconst matchingBlocks = blocks.filter( ( b ) => b.name === blockType );\n\t\tconsole.log( '[ACT findByWpBlock] Looking for type:', blockType, '- found', matchingBlocks.length );\n\t\ttargetClientId = matchingBlocks[ index ]?.clientId;\n\t} else if ( value.startsWith( 'nth:' ) ) {\n\t\tconst index = parseInt( value.substring( 4 ), 10 );\n\t\ttargetClientId = blocks[ index ]?.clientId;\n\t}\n\n\tif ( ! targetClientId ) {\n\t\tconsole.log( '[ACT findByWpBlock] No matching block found for:', value );\n\t\treturn [];\n\t}\n\n\tconsole.log( '[ACT findByWpBlock] Target clientId:', targetClientId );\n\n\t// Find the DOM element by data-block attribute.\n\tconst element = doc.querySelector( `[data-block=\"${ targetClientId }\"]` );\n\tif ( element ) {\n\t\tconsole.log( '[ACT findByWpBlock] Found element:', element.tagName );\n\t\treturn [ element ];\n\t}\n\n\tconsole.log( '[ACT findByWpBlock] Element not found in DOM' );\n\treturn [];\n}\n\n/**\n * Find elements using a locator.\n *\n * @param {Locator}  locator Locator object.\n * @param {Document} doc     Document to search in.\n * @return {HTMLElement[]} Matching elements.\n */\nfunction findByLocator( locator, doc = document ) {\n\tswitch ( locator.type ) {\n\t\tcase 'css':\n\t\t\treturn findByCSS( locator.value, doc );\n\t\tcase 'role':\n\t\t\treturn findByRole( locator.value, doc );\tcase 'testid':\t\tcase 'testId':\n\t\t\treturn findByTestId( locator.value, doc );\tcase 'dataattribute':\t\tcase 'dataAttribute':\n\t\t\treturn findByDataAttribute( locator.value, doc );\tcase 'arialabel':\t\tcase 'ariaLabel':\n\t\t\treturn findByAriaLabel( locator.value, doc );\n\t\tcase 'contextual':\n\t\t\treturn findByContextual( locator.value, doc );\n\t\tcase 'wpBlock':\n\t\tcase 'wpblock':\n\t\t\treturn findByWpBlock( locator.value, doc );\n\t\tdefault:\n\t\t\treturn [];\n\t}\n}\n\n/**\n * Calculate specificity score for an element based on how well it matches.\n *\n * @param {HTMLElement} element    Element to score.\n * @param {Locator}     locator    Locator used.\n * @param {Object}      constraints Target constraints.\n * @return {number} Specificity score (higher is better).\n */\nfunction calculateSpecificity( element, locator, constraints ) {\n\tlet score = locator.weight || 50;\n\n\t// Bonus for ID-based selectors.\n\tif ( element.id ) {\n\t\tscore += 20;\n\t}\n\n\t// Bonus for data-testid.\n\tif ( element.getAttribute( 'data-testid' ) ) {\n\t\tscore += 15;\n\t}\n\n\t// Bonus for being within specified container.\n\tif (\n\t\tconstraints?.withinContainer &&\n\t\tisWithinContainer( element, constraints.withinContainer )\n\t) {\n\t\tscore += 10;\n\t}\n\n\t// BIG bonus for being within the currently selected block.\n\t// This ensures we prefer elements in the block the user is working on.\n\tif ( isWithinSelectedBlock( element ) ) {\n\t\tscore += 100;\n\t}\n\n\t// Bonus for visibility.\n\tif ( isElementVisible( element ) ) {\n\t\tscore += 5;\n\t}\n\n\treturn score;\n}\n\n/**\n * Resolve target element from a target configuration.\n *\n * @param {Target} target Target configuration.\n * @return {ResolutionResult} Resolution result.\n */\nexport function resolveTarget( target ) {\n\tconsole.log( '[ACT resolveTarget] Starting resolution', target );\n\t\n\tif ( ! target || ! target.locators || target.locators.length === 0 ) {\n\t\tconsole.log( '[ACT resolveTarget] No locators provided' );\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: 'No locators provided',\n\t\t};\n\t}\n\n\tconst constraints = target.constraints || {};\n\tconsole.log( '[ACT resolveTarget] Constraints:', constraints );\n\n\t// Determine which document to search in.\n\t// Auto-detect iframe if withinContainer is an iframe-only selector.\n\tconst iframeOnlyContainers = [ '.editor-styles-wrapper', '.block-editor-block-list__layout' ];\n\tconst shouldSearchIframe = constraints.inEditorIframe || \n\t\t( constraints.withinContainer && iframeOnlyContainers.includes( constraints.withinContainer ) );\n\n\tconsole.log( '[ACT resolveTarget] shouldSearchIframe:', shouldSearchIframe );\n\n\tlet searchDoc = document;\n\tif ( shouldSearchIframe ) {\n\t\tconst iframeDoc = getEditorIframeDocument();\n\t\tconsole.log( '[ACT resolveTarget] iframeDoc:', iframeDoc ? 'found' : 'NOT FOUND' );\n\t\tif ( ! iframeDoc ) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: 'Editor iframe not found',\n\t\t\t};\n\t\t}\n\t\tsearchDoc = iframeDoc;\n\t}\n\n\t// Sort locators by weight (descending), non-fallback first.\n\tconst sortedLocators = [ ...target.locators ].sort( ( a, b ) => {\n\t\t// Non-fallback before fallback.\n\t\tif ( a.fallback !== b.fallback ) {\n\t\t\treturn a.fallback ? 1 : -1;\n\t\t}\n\t\t// Higher weight first.\n\t\treturn ( b.weight || 50 ) - ( a.weight || 50 );\n\t} );\n\n\t// Try non-fallback locators first.\n\tconst primaryLocators = sortedLocators.filter( ( l ) => ! l.fallback );\n\tconst fallbackLocators = sortedLocators.filter( ( l ) => l.fallback );\n\n\tconsole.log( '[ACT resolveTarget] Trying', primaryLocators.length, 'primary +', fallbackLocators.length, 'fallback locators' );\n\n\t// Try each locator.\n\tfor ( const locator of [ ...primaryLocators, ...fallbackLocators ] ) {\n\t\tlet elements = findByLocator( locator, searchDoc );\n\t\tconsole.log( '[ACT resolveTarget] Locator', locator.type, ':', locator.value.substring( 0, 50 ), '-> found', elements.length, 'raw matches' );\n\n\t\t// Apply visibility constraint.\n\t\tif ( constraints.visible !== false ) {\n\t\t\telements = elements.filter( isElementVisible );\n\t\t\tconsole.log( '[ACT resolveTarget]   After visibility filter:', elements.length );\n\t\t}\n\n\t\t// Apply scopeToSelectedBlock constraint - only find elements within currently selected block.\n\t\tif ( constraints.scopeToSelectedBlock ) {\n\t\t\telements = elements.filter( isWithinSelectedBlock );\n\t\t\tconsole.log( '[ACT resolveTarget]   After selectedBlock filter:', elements.length );\n\t\t}\n\n\t\t// Apply container constraint.\n\t\tif ( constraints.withinContainer ) {\n\t\t\telements = elements.filter( ( el ) =>\n\t\t\t\tisWithinContainer( el, constraints.withinContainer )\n\t\t\t);\n\t\t\tconsole.log( '[ACT resolveTarget]   After container filter:', elements.length );\n\t\t}\n\n\t\tif ( elements.length === 0 ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Handle multiple matches.\n\t\tif ( elements.length === 1 ) {\n\t\t\tconsole.log( '[ACT resolveTarget] SUCCESS! Found element with', locator.type );\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\telement: elements[ 0 ],\n\t\t\t\tusedLocator: locator,\n\t\t\t};\n\t\t}\n\n\t\t// Use index constraint if provided.\n\t\tif (\n\t\t\ttypeof constraints.index === 'number' &&\n\t\t\telements[ constraints.index ]\n\t\t) {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\telement: elements[ constraints.index ],\n\t\t\t\tusedLocator: locator,\n\t\t\t};\n\t\t}\n\n\t\t// Disambiguate by specificity score.\n\t\tconsole.log( '[ACT resolveTarget] Multiple matches (', elements.length, '), disambiguating by specificity...' );\n\t\tconst scored = elements.map( ( el ) => ( {\n\t\t\telement: el,\n\t\t\tscore: calculateSpecificity( el, locator, constraints ),\n\t\t} ) );\n\n\t\tscored.sort( ( a, b ) => b.score - a.score );\n\t\tconsole.log( '[ACT resolveTarget] Scores:', scored.map( ( s ) => s.score ) );\n\n\t\t// If top two have same score, it's ambiguous - but still return first.\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\telement: scored[ 0 ].element,\n\t\t\tusedLocator: locator,\n\t\t};\n\t}\n\n\tconsole.log( '[ACT resolveTarget] FAILED - No matching element found after trying all locators' );\n\treturn {\n\t\tsuccess: false,\n\t\terror: 'No matching element found',\n\t};\n}\n\n/**\n * Resolve target with recovery retry.\n *\n * @param {Target}        target     Target configuration.\n * @param {Function|null} recoveryFn Optional recovery function to run before retry.\n * @return {Promise<ResolutionResult>} Resolution result.\n */\nexport async function resolveTargetWithRecovery( target, recoveryFn = null ) {\n\t// First attempt.\n\tlet result = resolveTarget( target );\n\n\tif ( result.success ) {\n\t\treturn result;\n\t}\n\n\t// If recovery function provided, run it and retry once.\n\tif ( recoveryFn ) {\n\t\ttry {\n\t\t\tawait recoveryFn();\n\n\t\t\t// Wait a tick for DOM updates.\n\t\t\tawait new Promise( ( resolve ) => setTimeout( resolve, 100 ) );\n\n\t\t\t// Retry.\n\t\t\tresult = resolveTarget( target );\n\n\t\t\tif ( result.success ) {\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\trecovered: true,\n\t\t\t\t};\n\t\t\t}\n\t\t} catch ( error ) {\n\t\t\t// Recovery failed, return original error.\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Recovery failed: ${ error.message }`,\n\t\t\t};\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Test if a target can be resolved (for educator UI).\n *\n * @param {Target} target Target configuration.\n * @return {Object} Test result with details.\n */\nexport function testTargetResolution( target ) {\n\tconst result = resolveTarget( target );\n\n\treturn {\n\t\tsuccess: result.success,\n\t\telement: result.element,\n\t\tusedLocator: result.usedLocator,\n\t\terror: result.error,\n\t\telementInfo: result.element\n\t\t\t? {\n\t\t\t\t\ttagName: result.element.tagName.toLowerCase(),\n\t\t\t\t\tid: result.element.id || null,\n\t\t\t\t\tclassName: result.element.className || null,\n\t\t\t\t\ttextContent:\n\t\t\t\t\t\tresult.element.textContent?.slice( 0, 50 ) || null,\n\t\t\t\t\trect: result.element.getBoundingClientRect(),\n\t\t\t  }\n\t\t\t: null,\n\t};\n}\n\nexport default resolveTarget;\n","/**\n * Wait for Next Step's Block.\n *\n * Checks if the next step in a tour expects a specific block to exist,\n * and waits for it to be present before allowing the step transition.\n *\n * @package AdminCoachTours\n * @since   0.3.1\n */\n\nimport { select, subscribe } from '@wordpress/data';\n\n/**\n * Extract expected block type from a step's target configuration.\n *\n * @param {Object} step Step configuration.\n * @return {string|null} Block type name (e.g., 'core/image') or null.\n */\nexport function getExpectedBlockType( step ) {\n\tif ( ! step?.target ) {\n\t\treturn null;\n\t}\n\n\tconst { target } = step;\n\n\t// Check if target has a blockType constraint.\n\tif ( target.constraints?.blockType ) {\n\t\treturn target.constraints.blockType;\n\t}\n\n\t// Check locators for block-related targeting.\n\tconst locators = target.locators || [];\n\tfor ( const locator of locators ) {\n\t\t// Check for data-type attribute (block type).\n\t\tif ( locator.type === 'dataAttribute' && locator.attribute === 'data-type' ) {\n\t\t\treturn locator.value;\n\t\t}\n\n\t\t// Check for block targeting by name.\n\t\tif ( locator.type === 'block' && locator.blockName ) {\n\t\t\treturn locator.blockName;\n\t\t}\n\t}\n\n\t// Check CSS selectors for block type hints.\n\tfor ( const locator of locators ) {\n\t\tif ( locator.type === 'css' && locator.value ) {\n\t\t\t// Match patterns like [data-type=\"core/image\"] or .wp-block-image.\n\t\t\tconst dataTypeMatch = locator.value.match( /\\[data-type=[\"']([^\"']+)[\"']\\]/ );\n\t\t\tif ( dataTypeMatch ) {\n\t\t\t\treturn dataTypeMatch[ 1 ];\n\t\t\t}\n\n\t\t\t// Match .wp-block-{name} patterns.\n\t\t\tconst wpBlockMatch = locator.value.match( /\\.wp-block-(\\w+)/ );\n\t\t\tif ( wpBlockMatch ) {\n\t\t\t\treturn `core/${ wpBlockMatch[ 1 ] }`;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\n/**\n * Check if a specific block type exists in the editor.\n *\n * @param {string} blockType Block type to check for (e.g., 'core/image').\n * @return {boolean} True if block exists.\n */\nexport function hasBlockOfType( blockType ) {\n\ttry {\n\t\tconst blockEditorStore = select( 'core/block-editor' );\n\t\tif ( ! blockEditorStore?.getBlocks ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blocks = blockEditorStore.getBlocks();\n\n\t\t// Recursive function to search nested blocks.\n\t\tconst findBlock = ( blockList ) => {\n\t\t\tfor ( const block of blockList ) {\n\t\t\t\tif ( block.name === blockType ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t// Check inner blocks.\n\t\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\t\tif ( findBlock( block.innerBlocks ) ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t\treturn findBlock( blocks );\n\t} catch ( e ) {\n\t\tconsole.warn( '[ACT] Error checking for block type:', e );\n\t\treturn false;\n\t}\n}\n\n/**\n * Wait for a specific block type to appear in the editor.\n *\n * @param {string} blockType Block type to wait for.\n * @param {number} timeout   Maximum wait time in ms (default: 5000).\n * @return {Promise<{success: boolean, timedOut?: boolean}>} Result.\n */\nexport function waitForBlock( blockType, timeout = 5000 ) {\n\treturn new Promise( ( resolve ) => {\n\t\t// Check immediately.\n\t\tif ( hasBlockOfType( blockType ) ) {\n\t\t\tconsole.log( '[ACT waitForBlock] Block already exists:', blockType );\n\t\t\tresolve( { success: true } );\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log( '[ACT waitForBlock] Waiting for block:', blockType );\n\n\t\tlet timeoutId = null;\n\t\tlet unsubscribe = null;\n\t\tlet isResolved = false;\n\n\t\tconst cleanup = () => {\n\t\t\tif ( timeoutId ) {\n\t\t\t\tclearTimeout( timeoutId );\n\t\t\t}\n\t\t\tif ( unsubscribe ) {\n\t\t\t\tunsubscribe();\n\t\t\t}\n\t\t};\n\n\t\tconst complete = ( success, timedOut = false ) => {\n\t\t\tif ( isResolved ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisResolved = true;\n\t\t\tcleanup();\n\t\t\tresolve( { success, timedOut } );\n\t\t};\n\n\t\t// Set up timeout.\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tconsole.log( '[ACT waitForBlock] Timeout waiting for:', blockType );\n\t\t\t\tcomplete( false, true );\n\t\t\t}, timeout );\n\t\t}\n\n\t\t// Subscribe to store changes.\n\t\tunsubscribe = subscribe( () => {\n\t\t\tif ( hasBlockOfType( blockType ) ) {\n\t\t\t\tconsole.log( '[ACT waitForBlock] Block appeared:', blockType );\n\t\t\t\tcomplete( true );\n\t\t\t}\n\t\t} );\n\t} );\n}\n\n/**\n * Look ahead and wait for the next step's expected block before advancing.\n *\n * @param {Array}  steps       All steps in the tour.\n * @param {number} currentIndex Current step index.\n * @param {number} timeout     Maximum wait time in ms (default: 5000).\n * @return {Promise<{waited: boolean, blockType?: string, success?: boolean}>} Result.\n */\nexport async function waitForNextStepBlock( steps, currentIndex, timeout = 5000 ) {\n\tconst nextIndex = currentIndex + 1;\n\n\t// Check if there's a next step.\n\tif ( nextIndex >= steps.length ) {\n\t\treturn { waited: false };\n\t}\n\n\tconst nextStep = steps[ nextIndex ];\n\tconst expectedBlockType = getExpectedBlockType( nextStep );\n\n\tif ( ! expectedBlockType ) {\n\t\tconsole.log( '[ACT waitForNextStepBlock] Next step does not expect a specific block' );\n\t\treturn { waited: false };\n\t}\n\n\tconsole.log( '[ACT waitForNextStepBlock] Next step expects block:', expectedBlockType );\n\n\t// Check if block already exists.\n\tif ( hasBlockOfType( expectedBlockType ) ) {\n\t\tconsole.log( '[ACT waitForNextStepBlock] Block already exists' );\n\t\treturn { waited: false, blockType: expectedBlockType };\n\t}\n\n\t// Wait for the block to appear.\n\tconst result = await waitForBlock( expectedBlockType, timeout );\n\n\treturn {\n\t\twaited: true,\n\t\tblockType: expectedBlockType,\n\t\tsuccess: result.success,\n\t\ttimedOut: result.timedOut,\n\t};\n}\n\nexport default waitForNextStepBlock;\n","/**\n * Watch for step completion conditions.\n *\n * Monitors DOM events and @wordpress/data store changes to detect\n * when a step's completion condition is satisfied.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { subscribe, select } from '@wordpress/data';\n\n/**\n * @typedef {import('../types/step.js').Completion} Completion\n */\n\n/**\n * Create a watcher that resolves when a condition is met.\n *\n * @param {Function} checkFn    Function that returns true when complete.\n * @param {number}   timeout    Timeout in ms (0 for no timeout).\n * @return {Promise<{success: boolean, timedOut?: boolean}>} Result.\n */\nfunction createWatcher( checkFn, timeout = 0 ) {\n\treturn new Promise( ( resolve ) => {\n\t\tlet timeoutId = null;\n\t\tlet checkInterval = null;\n\t\tlet isResolved = false;\n\n\t\tconst cleanup = () => {\n\t\t\tif ( timeoutId ) {\n\t\t\t\tclearTimeout( timeoutId );\n\t\t\t}\n\t\t\tif ( checkInterval ) {\n\t\t\t\tclearInterval( checkInterval );\n\t\t\t}\n\t\t};\n\n\t\tconst complete = ( success, timedOut = false ) => {\n\t\t\tif ( isResolved ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisResolved = true;\n\t\t\tcleanup();\n\t\t\tresolve( { success, timedOut } );\n\t\t};\n\n\t\t// Set up timeout if specified.\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tcomplete( false, true );\n\t\t\t}, timeout );\n\t\t}\n\n\t\t// Check periodically.\n\t\tconst check = () => {\n\t\t\ttry {\n\t\t\t\tif ( checkFn() ) {\n\t\t\t\t\tcomplete( true );\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Check function threw, continue watching.\n\t\t\t}\n\t\t};\n\n\t\t// Initial check.\n\t\tcheck();\n\n\t\t// If not immediately satisfied, poll.\n\t\tif ( ! isResolved ) {\n\t\t\tcheckInterval = setInterval( check, 100 );\n\t\t}\n\t} );\n}\n\n/**\n * Watch for click on target element.\n * Includes a grace period to avoid catching clicks during setup.\n *\n * @param {HTMLElement} targetElement Target element.\n * @param {Object}      options       Options.\n * @return {Promise<Object>} Completion result.\n */\nfunction watchClickTarget( targetElement, options = {} ) {\n\treturn new Promise( ( resolve ) => {\n\t\tlet isResolved = false;\n\t\tlet isArmed = false; // Grace period flag.\n\t\tconst { timeout = 0, gracePeriod = 300 } = options;\n\t\tlet timeoutId = null;\n\n\t\tconst cleanup = () => {\n\t\t\ttargetElement.removeEventListener( 'click', handleClick, true );\n\t\t\t// Also try to remove from iframe document if applicable.\n\t\t\tif ( targetElement.ownerDocument !== document ) {\n\t\t\t\ttargetElement.ownerDocument.removeEventListener(\n\t\t\t\t\t'click',\n\t\t\t\t\thandleClick,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t\tif ( timeoutId ) {\n\t\t\t\tclearTimeout( timeoutId );\n\t\t\t}\n\t\t};\n\n\t\tconst handleClick = ( event ) => {\n\t\t\tif ( isResolved ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Ignore clicks during grace period.\n\t\t\tif ( ! isArmed ) {\n\t\t\t\tconsole.log(\n\t\t\t\t\t'[ACT watchClickTarget] Ignoring click during grace period'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Verify click is on target or within target.\n\t\t\tif (\n\t\t\t\ttargetElement === event.target ||\n\t\t\t\ttargetElement.contains( event.target )\n\t\t\t) {\n\t\t\t\tconsole.log(\n\t\t\t\t\t'[ACT watchClickTarget] Click detected on target:',\n\t\t\t\t\ttargetElement.tagName\n\t\t\t\t);\n\t\t\t\tisResolved = true;\n\t\t\t\tcleanup();\n\t\t\t\tresolve( { success: true, event: 'click' } );\n\t\t\t}\n\t\t};\n\n\t\t// Add listener to the target element.\n\t\ttargetElement.addEventListener( 'click', handleClick, {\n\t\t\tcapture: true,\n\t\t} );\n\n\t\t// Also listen on the document (for iframe elements).\n\t\tif ( targetElement.ownerDocument !== document ) {\n\t\t\ttargetElement.ownerDocument.addEventListener( 'click', handleClick, {\n\t\t\t\tcapture: true,\n\t\t\t} );\n\t\t}\n\n\t\t// Arm the watcher after grace period.\n\t\tsetTimeout( () => {\n\t\t\tisArmed = true;\n\t\t\tconsole.log(\n\t\t\t\t'[ACT watchClickTarget] Armed after grace period, watching:',\n\t\t\t\ttargetElement.tagName,\n\t\t\t\ttargetElement.className\n\t\t\t);\n\t\t}, gracePeriod );\n\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tif ( ! isResolved ) {\n\t\t\t\t\tisResolved = true;\n\t\t\t\t\tcleanup();\n\t\t\t\t\tresolve( { success: false, timedOut: true } );\n\t\t\t\t}\n\t\t\t}, timeout );\n\t\t}\n\t} );\n}\n\n/**\n * Watch for DOM value change on target element.\n *\n * @param {HTMLElement} targetElement Target element.\n * @param {Object}      options       Options.\n * @return {Promise<Object>} Completion result.\n */\nfunction watchDomValueChanged( targetElement, options = {} ) {\n\treturn new Promise( ( resolve ) => {\n\t\tlet isResolved = false;\n\t\tconst { timeout = 0, expectedValue, attributeName = null } = options;\n\t\tlet timeoutId = null;\n\t\tlet observer = null;\n\n\t\tconst cleanup = () => {\n\t\t\tif ( observer ) {\n\t\t\t\tobserver.disconnect();\n\t\t\t}\n\t\t\ttargetElement.removeEventListener( 'input', handleInput );\n\t\t\ttargetElement.removeEventListener( 'change', handleChange );\n\t\t\tif ( timeoutId ) {\n\t\t\t\tclearTimeout( timeoutId );\n\t\t\t}\n\t\t};\n\n\t\tconst getCurrentValue = () => {\n\t\t\tif ( attributeName ) {\n\t\t\t\treturn targetElement.getAttribute( attributeName );\n\t\t\t}\n\n\t\t\t// For form elements.\n\t\t\tif ( 'value' in targetElement ) {\n\t\t\t\treturn targetElement.value;\n\t\t\t}\n\n\t\t\t// For content editable.\n\t\t\tif ( targetElement.isContentEditable ) {\n\t\t\t\treturn targetElement.textContent;\n\t\t\t}\n\n\t\t\t// For checkboxes/radios.\n\t\t\tif ( targetElement.type === 'checkbox' || targetElement.type === 'radio' ) {\n\t\t\t\treturn targetElement.checked;\n\t\t\t}\n\n\t\t\treturn targetElement.textContent;\n\t\t};\n\n\t\tconst initialValue = getCurrentValue();\n\n\t\tconst checkCompletion = () => {\n\t\t\tconst currentValue = getCurrentValue();\n\n\t\t\t// If expected value specified, check for match.\n\t\t\tif ( expectedValue !== undefined ) {\n\t\t\t\tif ( currentValue === expectedValue ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Otherwise, just check if value changed.\n\t\t\treturn currentValue !== initialValue;\n\t\t};\n\n\t\tconst complete = () => {\n\t\t\tif ( isResolved ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ( checkCompletion() ) {\n\t\t\t\tisResolved = true;\n\t\t\t\tcleanup();\n\t\t\t\tresolve( { success: true, event: 'valueChanged' } );\n\t\t\t}\n\t\t};\n\n\t\tconst handleInput = () => complete();\n\t\tconst handleChange = () => complete();\n\n\t\t// Listen for input/change events.\n\t\ttargetElement.addEventListener( 'input', handleInput );\n\t\ttargetElement.addEventListener( 'change', handleChange );\n\n\t\t// Also use MutationObserver for attribute changes.\n\t\tobserver = new MutationObserver( () => complete() );\n\t\tobserver.observe( targetElement, {\n\t\t\tattributes: true,\n\t\t\tcharacterData: true,\n\t\t\tsubtree: true,\n\t\t\tchildList: true,\n\t\t} );\n\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tif ( ! isResolved ) {\n\t\t\t\t\tisResolved = true;\n\t\t\t\t\tcleanup();\n\t\t\t\t\tresolve( { success: false, timedOut: true } );\n\t\t\t\t}\n\t\t\t}, timeout );\n\t\t}\n\t} );\n}\n\n/**\n * Watch for @wordpress/data store state change.\n *\n * @param {Object} options Watcher options.\n * @return {Promise<Object>} Completion result.\n */\nfunction watchWpDataChange( options = {} ) {\n\tconst {\n\t\tstoreName,\n\t\tselector,\n\t\targs = [],\n\t\texpectedValue,\n\t\tcomparator = 'equals',\n\t\ttimeout = 0,\n\t} = options;\n\n\treturn new Promise( ( resolve ) => {\n\t\tlet isResolved = false;\n\t\tlet timeoutId = null;\n\t\tlet unsubscribe = null;\n\n\t\tconst cleanup = () => {\n\t\t\tif ( unsubscribe ) {\n\t\t\t\tunsubscribe();\n\t\t\t}\n\t\t\tif ( timeoutId ) {\n\t\t\t\tclearTimeout( timeoutId );\n\t\t\t}\n\t\t};\n\n\t\tconst store = select( storeName );\n\n\t\tif ( ! store || ! store[ selector ] ) {\n\t\t\tresolve( {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Invalid store or selector: ${ storeName }.${ selector }`,\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\n\t\tconst checkValue = () => {\n\t\t\ttry {\n\t\t\t\tconst currentValue = store[ selector ]( ...args );\n\n\t\t\t\tswitch ( comparator ) {\n\t\t\t\t\tcase 'equals':\n\t\t\t\t\t\treturn currentValue === expectedValue;\n\n\t\t\t\t\tcase 'notEquals':\n\t\t\t\t\t\treturn currentValue !== expectedValue;\n\n\t\t\t\t\tcase 'truthy':\n\t\t\t\t\t\treturn !! currentValue;\n\n\t\t\t\t\tcase 'falsy':\n\t\t\t\t\t\treturn ! currentValue;\n\n\t\t\t\t\tcase 'contains':\n\t\t\t\t\t\tif ( Array.isArray( currentValue ) ) {\n\t\t\t\t\t\t\treturn currentValue.includes( expectedValue );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( typeof currentValue === 'string' ) {\n\t\t\t\t\t\t\treturn currentValue.includes( expectedValue );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tcase 'greaterThan':\n\t\t\t\t\t\treturn currentValue > expectedValue;\n\n\t\t\t\t\tcase 'lessThan':\n\t\t\t\t\t\treturn currentValue < expectedValue;\n\n\t\t\t\t\tcase 'lengthEquals':\n\t\t\t\t\t\treturn currentValue?.length === expectedValue;\n\n\t\t\t\t\tcase 'lengthGreaterThan':\n\t\t\t\t\t\treturn currentValue?.length > expectedValue;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn currentValue === expectedValue;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tconst complete = () => {\n\t\t\tif ( isResolved ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ( checkValue() ) {\n\t\t\t\tisResolved = true;\n\t\t\t\tcleanup();\n\t\t\t\tresolve( { success: true, event: 'wpDataChanged' } );\n\t\t\t}\n\t\t};\n\n\t\t// Initial check.\n\t\tcomplete();\n\n\t\t// If not immediately satisfied, subscribe to changes.\n\t\tif ( ! isResolved ) {\n\t\t\tunsubscribe = subscribe( () => {\n\t\t\t\tcomplete();\n\t\t\t} );\n\t\t}\n\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tif ( ! isResolved ) {\n\t\t\t\t\tisResolved = true;\n\t\t\t\t\tcleanup();\n\t\t\t\t\tresolve( { success: false, timedOut: true } );\n\t\t\t\t}\n\t\t\t}, timeout );\n\t\t}\n\t} );\n}\n\n/**\n * Watch for manual confirmation (user clicks continue).\n *\n * @param {Object} options Options.\n * @return {Object} Watcher with cancel capability.\n */\nfunction createManualWatcher( options = {} ) {\n\tconst { timeout = 0 } = options;\n\tlet resolveFn = null;\n\tlet timeoutId = null;\n\tlet isResolved = false;\n\n\tconst promise = new Promise( ( resolve ) => {\n\t\tresolveFn = resolve;\n\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tif ( ! isResolved ) {\n\t\t\t\t\tisResolved = true;\n\t\t\t\t\tresolve( { success: false, timedOut: true } );\n\t\t\t\t}\n\t\t\t}, timeout );\n\t\t}\n\t} );\n\n\treturn {\n\t\tpromise,\n\t\tconfirm: () => {\n\t\t\tif ( ! isResolved ) {\n\t\t\t\tisResolved = true;\n\t\t\t\tif ( timeoutId ) {\n\t\t\t\t\tclearTimeout( timeoutId );\n\t\t\t\t}\n\t\t\t\tresolveFn( { success: true, event: 'manual' } );\n\t\t\t}\n\t\t},\n\t\tcancel: () => {\n\t\t\tif ( ! isResolved ) {\n\t\t\t\tisResolved = true;\n\t\t\t\tif ( timeoutId ) {\n\t\t\t\t\tclearTimeout( timeoutId );\n\t\t\t\t}\n\t\t\t\tresolveFn( { success: false, cancelled: true } );\n\t\t\t}\n\t\t},\n\t};\n}\n\n/**\n * Watch for element to appear in DOM.\n * Tracks the last appeared block for scoping in subsequent steps.\n * IMPORTANT: Waits for a NEW element, not just any existing match.\n *\n * @param {string} selector CSS selector.\n * @param {Object} options  Options.\n * @return {Promise<Object>} Completion result.\n */\nfunction watchElementAppear( selector, options = {} ) {\n\tconst { timeout = 0 } = options;\n\n\t// Helper to get all matching elements with their clientIds.\n\tconst getMatchingClientIds = () => {\n\t\tconst clientIds = new Set();\n\t\t\n\t\t// Check main document.\n\t\tdocument.querySelectorAll( selector ).forEach( ( el ) => {\n\t\t\tlet clientId = el.getAttribute( 'data-block' );\n\t\t\tif ( ! clientId ) {\n\t\t\t\tconst wrapper = el.closest( '[data-block]' );\n\t\t\t\tclientId = wrapper?.getAttribute( 'data-block' );\n\t\t\t}\n\t\t\tif ( clientId ) {\n\t\t\t\tclientIds.add( clientId );\n\t\t\t}\n\t\t} );\n\n\t\t// Check iframe.\n\t\tconst iframe = document.querySelector( 'iframe[name=\"editor-canvas\"]' );\n\t\tiframe?.contentDocument?.querySelectorAll( selector ).forEach( ( el ) => {\n\t\t\tlet clientId = el.getAttribute( 'data-block' );\n\t\t\tif ( ! clientId ) {\n\t\t\t\tconst wrapper = el.closest( '[data-block]' );\n\t\t\t\tclientId = wrapper?.getAttribute( 'data-block' );\n\t\t\t}\n\t\t\tif ( clientId ) {\n\t\t\t\tclientIds.add( clientId );\n\t\t\t}\n\t\t} );\n\n\t\treturn clientIds;\n\t};\n\n\t// Capture existing elements BEFORE watching.\n\tconst existingClientIds = getMatchingClientIds();\n\tconsole.log( '[ACT watchElementAppear] Existing matches:', existingClientIds.size, 'for selector:', selector );\n\n\treturn createWatcher( () => {\n\t\t// Get current matches and look for NEW ones.\n\t\tconst currentClientIds = getMatchingClientIds();\n\t\t\n\t\tfor ( const clientId of currentClientIds ) {\n\t\t\tif ( ! existingClientIds.has( clientId ) ) {\n\t\t\t\t// Found a NEW element! Store it for later retrieval.\n\t\t\t\twindow.__actNewlyAppearedBlockClientId = clientId;\n\t\t\t\tconsole.log( '[ACT watchElementAppear] NEW element appeared:', clientId );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}, timeout ).then( ( result ) => {\n\t\t// Track the block that appeared for scoping in next step.\n\t\tif ( result.success && window.__actNewlyAppearedBlockClientId ) {\n\t\t\twindow.__actLastAppearedBlockClientId = window.__actNewlyAppearedBlockClientId;\n\t\t\tconsole.log( '[ACT watchElementAppear] Tracked appeared block:', window.__actLastAppearedBlockClientId );\n\t\t\tdelete window.__actNewlyAppearedBlockClientId;\n\t\t}\n\n\t\treturn {\n\t\t\t...result,\n\t\t\tevent: result.success ? 'elementAppeared' : null,\n\t\t};\n\t} );\n}\n\n/**\n * Watch for element to disappear from DOM.\n *\n * @param {string} selector CSS selector.\n * @param {Object} options  Options.\n * @return {Promise<Object>} Completion result.\n */\nfunction watchElementDisappear( selector, options = {} ) {\n\tconst { timeout = 0 } = options;\n\n\treturn createWatcher( () => {\n\t\tconst element = document.querySelector( selector );\n\t\treturn element === null;\n\t}, timeout ).then( ( result ) => ( {\n\t\t...result,\n\t\tevent: result.success ? 'elementDisappeared' : null,\n\t} ) );\n}\n\n/**\n * Watch for a custom event to be dispatched.\n *\n * @param {string} eventName Custom event name.\n * @param {Object} options   Options.\n * @return {Promise<Object>} Completion result.\n */\nfunction watchCustomEvent( eventName, options = {} ) {\n\tconst { timeout = 0, target = document } = options;\n\n\treturn new Promise( ( resolve ) => {\n\t\tlet isResolved = false;\n\t\tlet timeoutId = null;\n\n\t\tconst cleanup = () => {\n\t\t\ttarget.removeEventListener( eventName, handleEvent );\n\t\t\tif ( timeoutId ) {\n\t\t\t\tclearTimeout( timeoutId );\n\t\t\t}\n\t\t};\n\n\t\tconst handleEvent = ( event ) => {\n\t\t\tif ( isResolved ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisResolved = true;\n\t\t\tcleanup();\n\t\t\tresolve( { success: true, event: eventName, detail: event.detail } );\n\t\t};\n\n\t\ttarget.addEventListener( eventName, handleEvent, { once: true } );\n\n\t\tif ( timeout > 0 ) {\n\t\t\ttimeoutId = setTimeout( () => {\n\t\t\t\tif ( ! isResolved ) {\n\t\t\t\t\tisResolved = true;\n\t\t\t\t\tcleanup();\n\t\t\t\t\tresolve( { success: false, timedOut: true } );\n\t\t\t\t}\n\t\t\t}, timeout );\n\t\t}\n\t} );\n}\n\n/**\n * Create a completion watcher based on completion configuration.\n *\n * @param {Completion}       completion    Completion configuration.\n * @param {HTMLElement|null} targetElement Resolved target element (if available).\n * @return {Object} Watcher object with promise and cancel method.\n */\nexport function watchCompletion( completion, targetElement = null ) {\n\tif ( ! completion || ! completion.type ) {\n\t\t// Default to manual completion.\n\t\treturn createManualWatcher();\n\t}\n\n\tconst { type, params = {} } = completion;\n\tconst timeout = completion.timeout || 0;\n\n\tswitch ( type ) {\n\t\tcase 'clickTarget':\n\t\t\tif ( ! targetElement ) {\n\t\t\t\treturn {\n\t\t\t\t\tpromise: Promise.resolve( {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'No target element for clickTarget',\n\t\t\t\t\t} ),\n\t\t\t\t\tcancel: () => {},\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tpromise: watchClickTarget( targetElement, { timeout } ),\n\t\t\t\tcancel: () => {}, // Click listeners are removed when promise resolves.\n\t\t\t};\n\n\t\tcase 'domValueChanged':\n\t\t\tif ( ! targetElement ) {\n\t\t\t\treturn {\n\t\t\t\t\tpromise: Promise.resolve( {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'No target element for domValueChanged',\n\t\t\t\t\t} ),\n\t\t\t\t\tcancel: () => {},\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tpromise: watchDomValueChanged( targetElement, {\n\t\t\t\t\ttimeout,\n\t\t\t\t\t...params,\n\t\t\t\t} ),\n\t\t\t\tcancel: () => {},\n\t\t\t};\n\n\t\tcase 'wpData':\n\t\t\treturn {\n\t\t\t\tpromise: watchWpDataChange( { timeout, ...params } ),\n\t\t\t\tcancel: () => {},\n\t\t\t};\n\n\t\tcase 'manual':\n\t\t\treturn createManualWatcher( { timeout } );\n\n\t\tcase 'elementAppear':\n\t\t\treturn {\n\t\t\t\tpromise: watchElementAppear( params.selector, { timeout } ),\n\t\t\t\tcancel: () => {},\n\t\t\t};\n\n\t\tcase 'elementDisappear':\n\t\t\treturn {\n\t\t\t\tpromise: watchElementDisappear( params.selector, { timeout } ),\n\t\t\t\tcancel: () => {},\n\t\t\t};\n\n\t\tcase 'customEvent':\n\t\t\treturn {\n\t\t\t\tpromise: watchCustomEvent( params.eventName, { timeout } ),\n\t\t\t\tcancel: () => {},\n\t\t\t};\n\n\t\tdefault:\n\t\t\treturn createManualWatcher( { timeout } );\n\t}\n}\n\n/**\n * Get available completion types with descriptions.\n *\n * @return {Object[]} Array of completion type info.\n */\nexport function getAvailableCompletions() {\n\treturn [\n\t\t{\n\t\t\ttype: 'clickTarget',\n\t\t\tlabel: 'Click Target',\n\t\t\tdescription: 'Complete when user clicks the target element',\n\t\t\trequiresTarget: true,\n\t\t\tparams: [],\n\t\t},\n\t\t{\n\t\t\ttype: 'domValueChanged',\n\t\t\tlabel: 'Value Changed',\n\t\t\tdescription: 'Complete when element value changes',\n\t\t\trequiresTarget: true,\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'expectedValue',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Expected value (if not set, any change completes)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'attributeName',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Attribute to watch (defaults to value/textContent)',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'wpData',\n\t\t\tlabel: 'Store Change',\n\t\t\tdescription: 'Complete when @wordpress/data store value changes',\n\t\t\trequiresTarget: false,\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'storeName',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Store name (e.g., core/block-editor)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'selector',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Selector function name',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'args',\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Arguments for selector',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'expectedValue',\n\t\t\t\t\ttype: 'any',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'Expected value',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'comparator',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\toptional: true,\n\t\t\t\t\tdescription: 'equals, notEquals, truthy, falsy, contains, greaterThan, lessThan',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'manual',\n\t\t\tlabel: 'Manual',\n\t\t\tdescription: 'Complete when user clicks continue button',\n\t\t\trequiresTarget: false,\n\t\t\tparams: [],\n\t\t},\n\t\t{\n\t\t\ttype: 'elementAppear',\n\t\t\tlabel: 'Element Appears',\n\t\t\tdescription: 'Complete when an element appears in DOM',\n\t\t\trequiresTarget: false,\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'selector',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'CSS selector for element',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'elementDisappear',\n\t\t\tlabel: 'Element Disappears',\n\t\t\tdescription: 'Complete when an element is removed from DOM',\n\t\t\trequiresTarget: false,\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'selector',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'CSS selector for element',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: 'customEvent',\n\t\t\tlabel: 'Custom Event',\n\t\t\tdescription: 'Complete when a custom event is dispatched',\n\t\t\trequiresTarget: false,\n\t\t\tparams: [\n\t\t\t\t{\n\t\t\t\t\tname: 'eventName',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: 'Custom event name',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t];\n}\n\nexport default watchCompletion;\n","/**\n * Store action creators.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { ACTION_TYPES } from './reducer';\n\n/**\n * Generate a UUID v4.\n *\n * @return {string} UUID string.\n */\nconst generateId = () => {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(\n\t\t/[xy]/g,\n\t\tfunction ( c ) {\n\t\t\tconst r = ( Math.random() * 16 ) | 0;\n\t\t\tconst v = c === 'x' ? r : ( r & 0x3 ) | 0x8;\n\t\t\treturn v.toString( 16 );\n\t\t}\n\t);\n};\n\n// ============================================================================\n// Tour Loading Actions\n// ============================================================================\n\n/**\n * Set tours loading state.\n *\n * @param {boolean} isLoading Loading state.\n * @return {Object} Action object.\n */\nexport function setToursLoading( isLoading ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_TOURS_LOADING,\n\t\tisLoading,\n\t};\n}\n\n/**\n * Set tours error.\n *\n * @param {string|null} error Error message.\n * @return {Object} Action object.\n */\nexport function setToursError( error ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_TOURS_ERROR,\n\t\terror,\n\t};\n}\n\n/**\n * Receive tours from API.\n *\n * @param {Array} tours Array of tour objects.\n * @return {Object} Action object.\n */\nexport function receiveTours( tours ) {\n\treturn {\n\t\ttype: ACTION_TYPES.RECEIVE_TOURS,\n\t\ttours,\n\t};\n}\n\n/**\n * Receive a single tour.\n *\n * @param {Object} tour Tour object.\n * @return {Object} Action object.\n */\nexport function receiveTour( tour ) {\n\treturn {\n\t\ttype: ACTION_TYPES.RECEIVE_TOUR,\n\t\ttour,\n\t};\n}\n\n/**\n * Set current tour for editing (educator mode).\n * Fetches the tour if not already in the store.\n *\n * @param {number|null} tourId Tour ID or null to deselect.\n * @return {Generator} Action generator.\n */\nexport function* setCurrentTour( tourId ) {\n\tif ( ! tourId ) {\n\t\tyield {\n\t\t\ttype: ACTION_TYPES.SET_CURRENT_TOUR,\n\t\t\ttourId: null,\n\t\t};\n\t\treturn;\n\t}\n\n\t// First, try to fetch the tour to ensure it's in the store.\n\ttry {\n\t\tconst tour = yield {\n\t\t\ttype: 'API_FETCH',\n\t\t\trequest: {\n\t\t\t\tpath: `/admin-coach-tours/v1/tours/${ tourId }`,\n\t\t\t\tmethod: 'GET',\n\t\t\t},\n\t\t};\n\n\t\t// If tour exists, receive it.\n\t\tif ( tour && tour.id ) {\n\t\t\tyield receiveTour( tour );\n\t\t}\n\t} catch ( error ) {\n\t\t// Tour might not exist yet (new post). Create a placeholder.\n\t\tconsole.log( '[ACT] Tour not found, creating placeholder for:', tourId );\n\t\tyield receiveTour( {\n\t\t\tid: tourId,\n\t\t\ttitle: '',\n\t\t\tsteps: [],\n\t\t\tstatus: 'draft',\n\t\t} );\n\t}\n\n\t// Now set it as current.\n\tyield {\n\t\ttype: ACTION_TYPES.SET_CURRENT_TOUR,\n\t\ttourId,\n\t};\n}\n\n/**\n * Fetch tours from REST API.\n *\n * @param {Object} args Query arguments.\n * @return {Object} Action object for control.\n */\nexport function fetchTours( args = {} ) {\n\treturn {\n\t\ttype: 'FETCH_TOURS',\n\t\targs,\n\t};\n}\n\n/**\n * Fetch a single tour.\n *\n * @param {number} tourId Tour ID.\n * @return {Object} Action object for control.\n */\nexport function fetchTour( tourId ) {\n\treturn {\n\t\ttype: 'FETCH_TOUR',\n\t\ttourId,\n\t};\n}\n\n/**\n * Save tour to server.\n *\n * @param {number} tourId   Tour ID.\n * @param {Object} tourData Tour data to save.\n * @return {Generator} Action generator.\n */\nexport function* saveTour( tourId, tourData ) {\n\ttry {\n\t\tconst result = yield {\n\t\t\ttype: 'SAVE_TOUR',\n\t\t\ttourId,\n\t\t\ttourData,\n\t\t};\n\n\t\tif ( result?.id ) {\n\t\t\tyield receiveTour( result );\n\t\t}\n\n\t\treturn result;\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n}\n\n/**\n * Create a new tour.\n *\n * @param {Object} data Tour data (title, description, postTypes, editors, status).\n * @return {Function} Thunk that creates tour and returns result.\n */\nexport function* createTour( data ) {\n\ttry {\n\t\tconst result = yield {\n\t\t\ttype: 'CREATE_TOUR',\n\t\t\tdata,\n\t\t};\n\n\t\tif ( result?.id ) {\n\t\t\tyield receiveTour( result );\n\t\t}\n\n\t\treturn result;\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n}\n\n/**\n * Update an existing tour.\n *\n * @param {number} tourId Tour ID.\n * @param {Object} data   Tour data to update.\n * @return {Function} Thunk that updates tour and returns result.\n */\nexport function* updateTour( tourId, data ) {\n\ttry {\n\t\tconst result = yield {\n\t\t\ttype: 'UPDATE_TOUR',\n\t\t\ttourId,\n\t\t\tdata,\n\t\t};\n\n\t\tif ( result?.id ) {\n\t\t\tyield receiveTour( result );\n\t\t}\n\n\t\treturn result;\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n}\n\n// ============================================================================\n// Tour Playback Actions\n// ============================================================================\n\n/**\n * Start a tour.\n *\n * @param {number} tourId Tour ID.\n * @param {string} mode   Mode ('educator' | 'pupil').\n * @return {Object} Action object.\n */\nexport function startTour( tourId, mode = 'pupil' ) {\n\treturn {\n\t\ttype: ACTION_TYPES.START_TOUR,\n\t\ttourId,\n\t\tmode,\n\t};\n}\n\n/**\n * End the current tour.\n *\n * @return {Object} Action object.\n */\nexport function endTour() {\n\treturn {\n\t\ttype: ACTION_TYPES.END_TOUR,\n\t};\n}\n\n/**\n * Alias for endTour - stop the current tour.\n *\n * @return {Object} Action object.\n */\nexport function stopTour() {\n\treturn endTour();\n}\n\n/**\n * Set current step by index.\n *\n * @param {number} stepIndex Step index.\n * @return {Object} Action object.\n */\nexport function setCurrentStep( stepIndex ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_CURRENT_STEP,\n\t\tstepIndex,\n\t};\n}\n\n/**\n * Go to next step.\n *\n * @return {Object} Action object.\n */\nexport function nextStep() {\n\treturn {\n\t\ttype: ACTION_TYPES.NEXT_STEP,\n\t};\n}\n\n/**\n * Go to previous step.\n *\n * @return {Object} Action object.\n */\nexport function previousStep() {\n\treturn {\n\t\ttype: ACTION_TYPES.PREVIOUS_STEP,\n\t};\n}\n\n/**\n * Skip current step.\n *\n * @return {Object} Action object.\n */\nexport function skipStep() {\n\treturn {\n\t\ttype: ACTION_TYPES.SKIP_STEP,\n\t};\n}\n\n/**\n * Repeat current step.\n *\n * @return {Object} Action object.\n */\nexport function repeatStep() {\n\treturn {\n\t\ttype: ACTION_TYPES.REPEAT_STEP,\n\t};\n}\n\n// ============================================================================\n// Mode Management Actions\n// ============================================================================\n\n/**\n * Set current mode.\n *\n * @param {string|null} mode Mode ('educator' | 'pupil' | null).\n * @return {Object} Action object.\n */\nexport function setMode( mode ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_MODE,\n\t\tmode,\n\t};\n}\n\n// ============================================================================\n// Completion Actions\n// ============================================================================\n\n/**\n * Set completion satisfied state.\n *\n * @param {boolean} satisfied Whether completion is satisfied.\n * @return {Object} Action object.\n */\nexport function setCompletionSatisfied( satisfied ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_COMPLETION_SATISFIED,\n\t\tsatisfied,\n\t};\n}\n\n/**\n * Reset completion state.\n *\n * @return {Object} Action object.\n */\nexport function resetCompletion() {\n\treturn {\n\t\ttype: ACTION_TYPES.RESET_COMPLETION,\n\t};\n}\n\n/**\n * Mark step as complete and auto-advance.\n *\n * Sets completion satisfied and moves to next step.\n *\n * @return {Object} Action object (next step).\n */\nexport function markStepComplete() {\n\t// This is just an alias for nextStep - the completion watcher\n\t// handles the logic, this just triggers the advance.\n\treturn nextStep();\n}\n\n// ============================================================================\n// Target Resolution Actions\n// ============================================================================\n\n/**\n * Set resolved target element info.\n *\n * @param {Object} target Target resolution result.\n * @return {Object} Action object.\n */\nexport function setResolvedTarget( target ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_RESOLVED_TARGET,\n\t\ttarget,\n\t};\n}\n\n/**\n * Clear resolved target.\n *\n * @return {Object} Action object.\n */\nexport function clearResolvedTarget() {\n\treturn {\n\t\ttype: ACTION_TYPES.CLEAR_RESOLVED_TARGET,\n\t};\n}\n\n/**\n * Set recovering state.\n *\n * @param {boolean} isRecovering Recovery state.\n * @return {Object} Action object.\n */\nexport function setRecovering( isRecovering ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_RECOVERING,\n\t\tisRecovering,\n\t};\n}\n\n/**\n * Increment resolution attempts counter.\n *\n * @return {Object} Action object.\n */\nexport function incrementResolutionAttempts() {\n\treturn {\n\t\ttype: ACTION_TYPES.INCREMENT_RESOLUTION_ATTEMPTS,\n\t};\n}\n\n/**\n * Set last error message.\n *\n * @param {string|null} error Error message.\n * @return {Object} Action object.\n */\nexport function setLastError( error ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_LAST_ERROR,\n\t\terror,\n\t};\n}\n\n// ============================================================================\n// Educator Mode Actions\n// ============================================================================\n\n/**\n * Activate element picker.\n *\n * @param {string|null} stepId Optional step ID if repicking for existing step.\n * @return {Object} Action object.\n */\nexport function activatePicker( stepId = null ) {\n\treturn {\n\t\ttype: ACTION_TYPES.ACTIVATE_PICKER,\n\t\tstepId,\n\t};\n}\n\n/**\n * Start picking an element (alias for activatePicker).\n *\n * @param {string|null} stepId Optional step ID if repicking for existing step.\n * @return {Object} Action object.\n */\nexport function startPicking( stepId = null ) {\n\treturn activatePicker( stepId );\n}\n\n/**\n * Deactivate element picker.\n *\n * @return {Object} Action object.\n */\nexport function deactivatePicker() {\n\treturn {\n\t\ttype: ACTION_TYPES.DEACTIVATE_PICKER,\n\t};\n}\n\n/**\n * Stop picking (alias for deactivatePicker).\n *\n * @return {Object} Action object.\n */\nexport function stopPicking() {\n\treturn deactivatePicker();\n}\n\n/**\n * Select a step for editing.\n *\n * @param {string|null} stepId Step ID.\n * @return {Object} Action object.\n */\nexport function selectStep( stepId ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SELECT_STEP,\n\t\tstepId,\n\t};\n}\n\n/**\n * Set pending changes flag.\n *\n * @param {boolean} pending Has pending changes.\n * @return {Object} Action object.\n */\nexport function setPendingChanges( pending ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_PENDING_CHANGES,\n\t\tpending,\n\t};\n}\n\n/**\n * Update a step.\n *\n * @param {number} tourId  Tour ID.\n * @param {string} stepId  Step ID.\n * @param {Object} updates Updates to apply.\n * @return {Generator} Action generator.\n */\nexport function* updateStep( tourId, stepId, updates ) {\n\tyield {\n\t\ttype: ACTION_TYPES.UPDATE_STEP,\n\t\ttourId,\n\t\tstepId,\n\t\tupdates,\n\t};\n}\n\n/**\n * Add a new step.\n *\n * @param {number}      tourId Tour ID.\n * @param {Object}      step   Step data (without id/order).\n * @param {number|null} index  Insert position.\n * @return {Generator} Action generator.\n */\nexport function* addStep( tourId, step = {}, index = null ) {\n\tconst newStep = {\n\t\tid: generateId(),\n\t\torder: 0,\n\t\ttitle: '',\n\t\tinstruction: '',\n\t\thint: '',\n\t\ttarget: {\n\t\t\tlocators: [],\n\t\t\tconstraints: { visible: true },\n\t\t},\n\t\tpreconditions: [],\n\t\tcompletion: { type: 'manual' },\n\t\trecovery: [ { action: 'reapplyPreconditions', timeout: 1000 } ],\n\t\ttags: [],\n\t\tversion: 1,\n\t\t...step,\n\t};\n\n\tyield {\n\t\ttype: ACTION_TYPES.ADD_STEP,\n\t\ttourId,\n\t\tstep: newStep,\n\t\tindex,\n\t};\n}\n\n/**\n * Delete a step.\n *\n * @param {number} tourId Tour ID.\n * @param {string} stepId Step ID.\n * @return {Generator} Action generator.\n */\nexport function* deleteStep( tourId, stepId ) {\n\tyield {\n\t\ttype: ACTION_TYPES.DELETE_STEP,\n\t\ttourId,\n\t\tstepId,\n\t};\n}\n\n/**\n * Reorder steps.\n *\n * @param {number}   tourId  Tour ID.\n * @param {string[]} stepIds Ordered step IDs.\n * @return {Generator} Action generator.\n */\nexport function* reorderSteps( tourId, stepIds ) {\n\tyield {\n\t\ttype: ACTION_TYPES.REORDER_STEPS,\n\t\ttourId,\n\t\tstepIds,\n\t};\n}\n\n// ============================================================================\n// AI Drafting Actions\n// ============================================================================\n\n/**\n * Set AI draft loading state.\n *\n * @param {boolean} isLoading Loading state.\n * @return {Object} Action object.\n */\nexport function setAiDraftLoading( isLoading ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_AI_DRAFT_LOADING,\n\t\tisLoading,\n\t};\n}\n\n/**\n * Set AI draft error.\n *\n * @param {string|null} error Error message.\n * @return {Object} Action object.\n */\nexport function setAiDraftError( error ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_AI_DRAFT_ERROR,\n\t\terror,\n\t};\n}\n\n/**\n * Set AI draft result.\n *\n * @param {Object} result AI draft output.\n * @return {Object} Action object.\n */\nexport function setAiDraftResult( result ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_AI_DRAFT_RESULT,\n\t\tresult,\n\t};\n}\n\n/**\n * Clear AI draft state.\n *\n * @return {Object} Action object.\n */\nexport function clearAiDraft() {\n\treturn {\n\t\ttype: ACTION_TYPES.CLEAR_AI_DRAFT,\n\t};\n}\n\n/**\n * Request AI to draft step.\n *\n * @param {Object} elementContext Element context for AI.\n * @param {string} postType       Current post type.\n * @return {Generator} Generator that handles AI draft request.\n */\nexport function* requestAiDraft( elementContext, postType ) {\n\t// Set loading state.\n\tyield setAiDraftLoading( true );\n\tyield setAiDraftError( null );\n\n\ttry {\n\t\tconst result = yield {\n\t\t\ttype: 'REQUEST_AI_DRAFT',\n\t\t\telementContext,\n\t\t\tpostType,\n\t\t};\n\n\t\tyield setAiDraftResult( result );\n\t\treturn result;\n\t} catch ( error ) {\n\t\tyield setAiDraftError( error.message || 'Failed to generate AI draft' );\n\t\tthrow error;\n\t} finally {\n\t\tyield setAiDraftLoading( false );\n\t}\n}\n\n// ============================================================================\n// UI Actions\n// ============================================================================\n\n/**\n * Set sidebar open state.\n *\n * @param {boolean} isOpen Sidebar open state.\n * @return {Object} Action object.\n */\nexport function setSidebarOpen( isOpen ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_SIDEBAR_OPEN,\n\t\tisOpen,\n\t};\n}\n\n// ============================================================================\n// AI Tour Generation Actions (Pupil Mode)\n// ============================================================================\n\n/**\n * Set AI tour loading state.\n *\n * @param {boolean} isLoading Loading state.\n * @return {Object} Action object.\n */\nexport function setAiTourLoading( isLoading ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_AI_TOUR_LOADING,\n\t\tisLoading,\n\t};\n}\n\n/**\n * Set AI tour error.\n *\n * @param {string|null} error Error message.\n * @return {Object} Action object.\n */\nexport function setAiTourError( error ) {\n\treturn {\n\t\ttype: ACTION_TYPES.SET_AI_TOUR_ERROR,\n\t\terror,\n\t};\n}\n\n/**\n * Receive an ephemeral tour from AI.\n *\n * @param {Object} tour Generated tour object.\n * @return {Object} Action object.\n */\nexport function receiveEphemeralTour( tour ) {\n\treturn {\n\t\ttype: ACTION_TYPES.RECEIVE_EPHEMERAL_TOUR,\n\t\ttour,\n\t};\n}\n\n/**\n * Clear ephemeral tour.\n *\n * @return {Object} Action object.\n */\nexport function clearEphemeralTour() {\n\treturn {\n\t\ttype: ACTION_TYPES.CLEAR_EPHEMERAL_TOUR,\n\t};\n}\n\n/**\n * Request AI to generate a tour.\n *\n * @param {string} taskId   Predefined task ID (optional).\n * @param {string} query    Freeform user query (optional).\n * @param {string} postType Current post type.\n * @return {Generator} Generator that handles AI tour generation.\n */\nexport function* requestAiTour( taskId, query, postType ) {\n\t// Set loading state.\n\tyield setAiTourLoading( true );\n\tyield setAiTourError( null );\n\n\ttry {\n\t\t// Gather editor context to help AI generate accurate selectors.\n\t\tconst editorContext = yield {\n\t\t\ttype: 'GATHER_EDITOR_CONTEXT',\n\t\t};\n\n\t\tconst result = yield {\n\t\t\ttype: 'REQUEST_AI_TOUR',\n\t\t\ttaskId,\n\t\t\tquery,\n\t\t\tpostType,\n\t\t\teditorContext,\n\t\t};\n\n\t\tconsole.log( '[ACT AI Response] Full result:', result );\n\t\tconsole.log( '[ACT AI Response] Tour:', JSON.stringify( result.tour, null, 2 ) );\n\n\t\t// Add an ID to the ephemeral tour.\n\t\tconst tour = {\n\t\t\tid: 'ephemeral',\n\t\t\t...result.tour,\n\t\t};\n\n\t\tyield receiveEphemeralTour( tour );\n\n\t\t// Ensure an empty block placeholder exists for \"/\" quick inserter tours.\n\t\tyield {\n\t\t\ttype: 'ENSURE_EMPTY_PLACEHOLDER',\n\t\t};\n\n\t\t// Automatically start the tour.\n\t\tyield startTour( 'ephemeral', 'pupil' );\n\n\t\treturn tour;\n\t} catch ( error ) {\n\t\tyield setAiTourError( error.message || 'Failed to generate tour' );\n\t\tthrow error;\n\t} finally {\n\t\tyield setAiTourLoading( false );\n\t}\n}\n\n/**\n * Start an ephemeral tour directly (for pre-loaded tours).\n *\n * @param {Object} tour Tour object with title and steps.\n * @return {Generator} Generator that sets up and starts the tour.\n */\nexport function* startEphemeralTour( tour ) {\n\t// Add ID if not present.\n\tconst tourWithId = {\n\t\tid: 'ephemeral',\n\t\t...tour,\n\t};\n\n\tyield receiveEphemeralTour( tourWithId );\n\n\t// Ensure an empty block placeholder exists for \"/\" quick inserter tours.\n\tyield {\n\t\ttype: 'ENSURE_EMPTY_PLACEHOLDER',\n\t};\n\n\tyield startTour( 'ephemeral', 'pupil' );\n}\n","/**\n * Store controls for side effects.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport apiFetch from '@wordpress/api-fetch';\nimport { gatherEditorContext } from '../runtime/gatherEditorContext';\nimport { ensureEmptyPlaceholder } from '../runtime/ensureEmptyPlaceholder';\n\n/**\n * Control handlers.\n */\nconst controls = {\n\t/**\n\t * Handle API fetch requests.\n\t *\n\t * @param {Object} action Action with request config.\n\t * @return {Promise} API response.\n\t */\n\tAPI_FETCH( action ) {\n\t\treturn apiFetch( action.request );\n\t},\n\n\t/**\n\t * Gather editor context for AI tour generation.\n\t *\n\t * @return {Object} Editor context including blocks and UI state.\n\t */\n\tGATHER_EDITOR_CONTEXT() {\n\t\treturn gatherEditorContext();\n\t},\n\n\t/**\n\t * Ensure an empty block placeholder exists for \"/\" quick inserter tours.\n\t *\n\t * @return {Promise<Object>} Result with wasInserted and clientId.\n\t */\n\tENSURE_EMPTY_PLACEHOLDER() {\n\t\treturn ensureEmptyPlaceholder();\n\t},\n\n\t/**\n\t * Handle tour fetch requests.\n\t *\n\t * @param {Object} action Action with tourId.\n\t * @return {Promise} API response.\n\t */\n\tFETCH_TOUR( action ) {\n\t\treturn apiFetch( {\n\t\t\tpath: `/admin-coach-tours/v1/tours/${ action.tourId }`,\n\t\t\tmethod: 'GET',\n\t\t} );\n\t},\n\n\t/**\n\t * Handle tours list fetch.\n\t *\n\t * @param {Object} action Action with args.\n\t * @return {Promise} API response.\n\t */\n\tFETCH_TOURS( action ) {\n\t\tconst params = new URLSearchParams();\n\n\t\tif ( action.args.postType ) {\n\t\t\tparams.append( 'post_type', action.args.postType );\n\t\t}\n\t\tif ( action.args.editor ) {\n\t\t\tparams.append( 'editor', action.args.editor );\n\t\t}\n\n\t\tconst query = params.toString();\n\t\tconst path = `/admin-coach-tours/v1/tours${ query ? `?${ query }` : '' }`;\n\n\t\treturn apiFetch( {\n\t\t\tpath,\n\t\t\tmethod: 'GET',\n\t\t} );\n\t},\n\n\t/**\n\t * Handle tour save requests.\n\t *\n\t * @param {Object} action Action with tourId and tourData.\n\t * @return {Promise} API response.\n\t */\n\tSAVE_TOUR( action ) {\n\t\tconsole.log( '[ACT Controls] SAVE_TOUR:', action.tourId, action.tourData );\n\t\tconsole.log( '[ACT Controls] Steps count:', action.tourData?.steps?.length );\n\t\treturn apiFetch( {\n\t\t\tpath: `/admin-coach-tours/v1/tours/${ action.tourId }`,\n\t\t\tmethod: 'PUT',\n\t\t\tdata: action.tourData,\n\t\t} );\n\t},\n\n\t/**\n\t * Handle tour creation.\n\t *\n\t * @param {Object} action Action with tour data.\n\t * @return {Promise} API response with created tour.\n\t */\n\tCREATE_TOUR( action ) {\n\t\treturn apiFetch( {\n\t\t\tpath: '/admin-coach-tours/v1/tours',\n\t\t\tmethod: 'POST',\n\t\t\tdata: action.data,\n\t\t} );\n\t},\n\n\t/**\n\t * Handle tour update.\n\t *\n\t * @param {Object} action Action with tourId and data.\n\t * @return {Promise} API response with updated tour.\n\t */\n\tUPDATE_TOUR( action ) {\n\t\treturn apiFetch( {\n\t\t\tpath: `/admin-coach-tours/v1/tours/${ action.tourId }`,\n\t\t\tmethod: 'PUT',\n\t\t\tdata: action.data,\n\t\t} );\n\t},\n\n\t/**\n\t * Handle AI draft requests.\n\t *\n\t * @param {Object} action Action with element context.\n\t * @return {Promise} API response.\n\t */\n\tREQUEST_AI_DRAFT( action ) {\n\t\treturn apiFetch( {\n\t\t\tpath: '/admin-coach-tours/v1/ai/generate-draft',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\telementContext: action.elementContext,\n\t\t\t\tpostType: action.postType,\n\t\t\t},\n\t\t} );\n\t},\n\n\t/**\n\t * Handle AI tour generation requests.\n\t *\n\t * @param {Object} action Action with taskId, query, postType, and editorContext.\n\t * @return {Promise} API response with generated tour.\n\t */\n\tREQUEST_AI_TOUR( action ) {\n\t\treturn apiFetch( {\n\t\t\tpath: '/admin-coach-tours/v1/ai/generate-tour',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\ttaskId: action.taskId,\n\t\t\t\tquery: action.query,\n\t\t\t\tpostType: action.postType,\n\t\t\t\teditorContext: action.editorContext || null,\n\t\t\t},\n\t\t} );\n\t},\n\n\t/**\n\t * Fetch available AI tasks.\n\t *\n\t * @return {Promise} API response with available tasks.\n\t */\n\tFETCH_AI_TASKS() {\n\t\treturn apiFetch( {\n\t\t\tpath: '/admin-coach-tours/v1/ai/tasks',\n\t\t\tmethod: 'GET',\n\t\t} );\n\t},\n};\n\nexport default controls;\n","/**\n * Admin Coach Tours - WordPress data store.\n *\n * Central state management for tour playback, editing, and UI state.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { createReduxStore, register, select } from '@wordpress/data';\nimport reducer, { DEFAULT_STATE } from './reducer';\nimport * as actions from './actions';\nimport * as selectors from './selectors';\nimport * as resolvers from './resolvers';\nimport controls from './controls';\n\n/**\n * Store name constant.\n */\nexport const STORE_NAME = 'admin-coach-tours';\n\n/**\n * Create the Redux store.\n */\nconst store = createReduxStore( STORE_NAME, {\n\treducer,\n\tactions,\n\tselectors,\n\tresolvers,\n\tcontrols,\n\tinitialState: DEFAULT_STATE,\n} );\n\n/**\n * Register the store with WordPress (only if not already registered).\n */\nif ( ! select( STORE_NAME ) ) {\n\tregister( store );\n}\n\nexport default store;\nexport { DEFAULT_STATE };\n","/**\n * Store reducer.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\n/**\n * Default state for the store.\n */\nexport const DEFAULT_STATE = {\n\t// Tour data.\n\ttours: {},\n\ttoursLoading: false,\n\ttoursError: null,\n\n\t// Current tour state.\n\tcurrentTourId: null,\n\tcurrentStepIndex: 0,\n\n\t// Mode: 'educator' | 'pupil' | null.\n\tmode: null,\n\n\t// Completion tracking.\n\tcompletionSatisfied: false,\n\tskippedSteps: [],\n\n\t// Educator mode state.\n\tisPickerActive: false,\n\tpickingStepId: null,\n\tselectedStepId: null,\n\tpendingChanges: false,\n\n\t// Pupil mode state.\n\ttourProgress: {},\n\tisRecovering: false,\n\tlastError: null,\n\n\t// Target resolution.\n\tresolvedTarget: null,\n\tresolutionAttempts: 0,\n\n\t// UI state.\n\tsidebarOpen: false,\n\taiDraftLoading: false,\n\taiDraftError: null,\n\taiDraftResult: null,\n\n\t// AI tour generation (pupil mode).\n\taiTourLoading: false,\n\taiTourError: null,\n\tephemeralTour: null,\n};\n\n/**\n * Action types.\n */\nexport const ACTION_TYPES = {\n\t// Tour loading.\n\tSET_TOURS_LOADING: 'SET_TOURS_LOADING',\n\tSET_TOURS_ERROR: 'SET_TOURS_ERROR',\n\tRECEIVE_TOURS: 'RECEIVE_TOURS',\n\tRECEIVE_TOUR: 'RECEIVE_TOUR',\n\n\t// Tour selection/editing.\n\tSET_CURRENT_TOUR: 'SET_CURRENT_TOUR',\n\n\t// Tour playback.\n\tSTART_TOUR: 'START_TOUR',\n\tEND_TOUR: 'END_TOUR',\n\tSET_CURRENT_STEP: 'SET_CURRENT_STEP',\n\tNEXT_STEP: 'NEXT_STEP',\n\tPREVIOUS_STEP: 'PREVIOUS_STEP',\n\tSKIP_STEP: 'SKIP_STEP',\n\tREPEAT_STEP: 'REPEAT_STEP',\n\n\t// Mode management.\n\tSET_MODE: 'SET_MODE',\n\n\t// Completion.\n\tSET_COMPLETION_SATISFIED: 'SET_COMPLETION_SATISFIED',\n\tRESET_COMPLETION: 'RESET_COMPLETION',\n\n\t// Target resolution.\n\tSET_RESOLVED_TARGET: 'SET_RESOLVED_TARGET',\n\tCLEAR_RESOLVED_TARGET: 'CLEAR_RESOLVED_TARGET',\n\tSET_RECOVERING: 'SET_RECOVERING',\n\tINCREMENT_RESOLUTION_ATTEMPTS: 'INCREMENT_RESOLUTION_ATTEMPTS',\n\tSET_LAST_ERROR: 'SET_LAST_ERROR',\n\n\t// Educator mode.\n\tACTIVATE_PICKER: 'ACTIVATE_PICKER',\n\tDEACTIVATE_PICKER: 'DEACTIVATE_PICKER',\n\tSELECT_STEP: 'SELECT_STEP',\n\tSET_PENDING_CHANGES: 'SET_PENDING_CHANGES',\n\tUPDATE_STEP: 'UPDATE_STEP',\n\tADD_STEP: 'ADD_STEP',\n\tDELETE_STEP: 'DELETE_STEP',\n\tREORDER_STEPS: 'REORDER_STEPS',\n\n\t// AI drafting.\n\tSET_AI_DRAFT_LOADING: 'SET_AI_DRAFT_LOADING',\n\tSET_AI_DRAFT_ERROR: 'SET_AI_DRAFT_ERROR',\n\tSET_AI_DRAFT_RESULT: 'SET_AI_DRAFT_RESULT',\n\tCLEAR_AI_DRAFT: 'CLEAR_AI_DRAFT',\n\n\t// UI.\n\tSET_SIDEBAR_OPEN: 'SET_SIDEBAR_OPEN',\n\n\t// Ephemeral AI tours.\n\tSET_AI_TOUR_LOADING: 'SET_AI_TOUR_LOADING',\n\tRECEIVE_EPHEMERAL_TOUR: 'RECEIVE_EPHEMERAL_TOUR',\n\tSET_AI_TOUR_ERROR: 'SET_AI_TOUR_ERROR',\n\tCLEAR_EPHEMERAL_TOUR: 'CLEAR_EPHEMERAL_TOUR',\n};\n\n/**\n * Main reducer function.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Action object.\n * @return {Object} New state.\n */\nexport default function reducer( state = DEFAULT_STATE, action ) {\n\tswitch ( action.type ) {\n\t\t// Tour loading.\n\t\tcase ACTION_TYPES.SET_TOURS_LOADING:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttoursLoading: action.isLoading,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_TOURS_ERROR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttoursError: action.error,\n\t\t\t\ttoursLoading: false,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.RECEIVE_TOURS:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttours: action.tours.reduce( ( acc, tour ) => {\n\t\t\t\t\tacc[ tour.id ] = tour;\n\t\t\t\t\treturn acc;\n\t\t\t\t}, { ...state.tours } ),\n\t\t\t\ttoursLoading: false,\n\t\t\t\ttoursError: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.RECEIVE_TOUR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttours: {\n\t\t\t\t\t...state.tours,\n\t\t\t\t\t[ action.tour.id ]: action.tour,\n\t\t\t\t},\n\t\t\t\ttoursLoading: false,\n\t\t\t};\n\n\t\t// Tour selection for editing.\n\t\tcase ACTION_TYPES.SET_CURRENT_TOUR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentTourId: action.tourId,\n\t\t\t\tcurrentStepIndex: 0,\n\t\t\t\tmode: action.tourId ? 'educator' : null,\n\t\t\t\tselectedStepId: null,\n\t\t\t};\n\n\t\t// Tour playback.\n\t\tcase ACTION_TYPES.START_TOUR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentTourId: action.tourId,\n\t\t\t\tcurrentStepIndex: 0,\n\t\t\t\tmode: action.mode || 'pupil',\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tskippedSteps: [],\n\t\t\t\tlastError: null,\n\t\t\t\tresolutionAttempts: 0,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.END_TOUR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentTourId: null,\n\t\t\t\tcurrentStepIndex: 0,\n\t\t\t\tmode: null,\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tresolvedTarget: null,\n\t\t\t\tisRecovering: false,\n\t\t\t\tlastError: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_CURRENT_STEP:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentStepIndex: action.stepIndex,\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tresolvedTarget: null,\n\t\t\t\tresolutionAttempts: 0,\n\t\t\t\tlastError: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.NEXT_STEP: {\n\t\t\tconst tour = state.tours[ state.currentTourId ];\n\t\t\tconst nextIndex = state.currentStepIndex + 1;\n\t\t\tconst hasMore = tour && nextIndex < tour.steps.length;\n\n\t\t\tif ( ! hasMore ) {\n\t\t\t\t// Tour complete.\n\t\t\t\treturn {\n\t\t\t\t\t...state,\n\t\t\t\t\tcurrentTourId: null,\n\t\t\t\t\tcurrentStepIndex: 0,\n\t\t\t\t\tmode: null,\n\t\t\t\t\tcompletionSatisfied: false,\n\t\t\t\t\tresolvedTarget: null,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentStepIndex: nextIndex,\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tresolvedTarget: null,\n\t\t\t\tresolutionAttempts: 0,\n\t\t\t\tlastError: null,\n\t\t\t};\n\t\t}\n\n\t\tcase ACTION_TYPES.PREVIOUS_STEP:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentStepIndex: Math.max( 0, state.currentStepIndex - 1 ),\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tresolvedTarget: null,\n\t\t\t\tresolutionAttempts: 0,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SKIP_STEP: {\n\t\t\tconst tour = state.tours[ state.currentTourId ];\n\t\t\tconst currentStep = tour?.steps[ state.currentStepIndex ];\n\t\t\tconst nextIndex = state.currentStepIndex + 1;\n\t\t\tconst hasMore = tour && nextIndex < tour.steps.length;\n\n\t\t\tconst newSkipped = currentStep\n\t\t\t\t? [ ...state.skippedSteps, currentStep.id ]\n\t\t\t\t: state.skippedSteps;\n\n\t\t\tif ( ! hasMore ) {\n\t\t\t\treturn {\n\t\t\t\t\t...state,\n\t\t\t\t\tskippedSteps: newSkipped,\n\t\t\t\t\tcurrentTourId: null,\n\t\t\t\t\tcurrentStepIndex: 0,\n\t\t\t\t\tmode: null,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentStepIndex: nextIndex,\n\t\t\t\tskippedSteps: newSkipped,\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tresolvedTarget: null,\n\t\t\t\tresolutionAttempts: 0,\n\t\t\t};\n\t\t}\n\n\t\tcase ACTION_TYPES.REPEAT_STEP:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t\tresolvedTarget: null,\n\t\t\t\tresolutionAttempts: 0,\n\t\t\t\tlastError: null,\n\t\t\t\tisRecovering: false,\n\t\t\t};\n\n\t\t// Mode management.\n\t\tcase ACTION_TYPES.SET_MODE:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tmode: action.mode,\n\t\t\t};\n\n\t\t// Completion.\n\t\tcase ACTION_TYPES.SET_COMPLETION_SATISFIED:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcompletionSatisfied: action.satisfied,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.RESET_COMPLETION:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcompletionSatisfied: false,\n\t\t\t};\n\n\t\t// Target resolution.\n\t\tcase ACTION_TYPES.SET_RESOLVED_TARGET:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tresolvedTarget: action.target,\n\t\t\t\tlastError: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.CLEAR_RESOLVED_TARGET:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tresolvedTarget: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_RECOVERING:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisRecovering: action.isRecovering,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.INCREMENT_RESOLUTION_ATTEMPTS:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tresolutionAttempts: state.resolutionAttempts + 1,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_LAST_ERROR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tlastError: action.error,\n\t\t\t};\n\n\t\t// Educator mode.\n\t\tcase ACTION_TYPES.ACTIVATE_PICKER:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisPickerActive: true,\n\t\t\t\tpickingStepId: action.stepId || null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.DEACTIVATE_PICKER:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisPickerActive: false,\n\t\t\t\tpickingStepId: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SELECT_STEP:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tselectedStepId: action.stepId,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_PENDING_CHANGES:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpendingChanges: action.pending,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.UPDATE_STEP: {\n\t\t\tconst tour = state.tours[ action.tourId ];\n\t\t\tif ( ! tour ) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\tconst updatedSteps = tour.steps.map( ( step ) =>\n\t\t\t\tstep.id === action.stepId\n\t\t\t\t\t? { ...step, ...action.updates }\n\t\t\t\t\t: step\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttours: {\n\t\t\t\t\t...state.tours,\n\t\t\t\t\t[ action.tourId ]: {\n\t\t\t\t\t\t...tour,\n\t\t\t\t\t\tsteps: updatedSteps,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpendingChanges: true,\n\t\t\t};\n\t\t}\n\n\t\tcase ACTION_TYPES.ADD_STEP: {\n\t\t\tconst tour = state.tours[ action.tourId ];\n\t\t\tif ( ! tour ) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\tconst newSteps = [ ...tour.steps ];\n\t\t\tconst insertIndex = action.index ?? newSteps.length;\n\t\t\tnewSteps.splice( insertIndex, 0, action.step );\n\n\t\t\t// Re-index orders.\n\t\t\tnewSteps.forEach( ( step, i ) => {\n\t\t\t\tstep.order = i;\n\t\t\t} );\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttours: {\n\t\t\t\t\t...state.tours,\n\t\t\t\t\t[ action.tourId ]: {\n\t\t\t\t\t\t...tour,\n\t\t\t\t\t\tsteps: newSteps,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tselectedStepId: action.step.id,\n\t\t\t\tpendingChanges: true,\n\t\t\t};\n\t\t}\n\n\t\tcase ACTION_TYPES.DELETE_STEP: {\n\t\t\tconst tour = state.tours[ action.tourId ];\n\t\t\tif ( ! tour ) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\tconst filteredSteps = tour.steps.filter(\n\t\t\t\t( step ) => step.id !== action.stepId\n\t\t\t);\n\n\t\t\t// Re-index orders.\n\t\t\tfilteredSteps.forEach( ( step, i ) => {\n\t\t\t\tstep.order = i;\n\t\t\t} );\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttours: {\n\t\t\t\t\t...state.tours,\n\t\t\t\t\t[ action.tourId ]: {\n\t\t\t\t\t\t...tour,\n\t\t\t\t\t\tsteps: filteredSteps,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tselectedStepId:\n\t\t\t\t\tstate.selectedStepId === action.stepId\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: state.selectedStepId,\n\t\t\t\tpendingChanges: true,\n\t\t\t};\n\t\t}\n\n\t\tcase ACTION_TYPES.REORDER_STEPS: {\n\t\t\tconst tour = state.tours[ action.tourId ];\n\t\t\tif ( ! tour ) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\tconst stepsMap = {};\n\t\t\ttour.steps.forEach( ( step ) => {\n\t\t\t\tstepsMap[ step.id ] = step;\n\t\t\t} );\n\n\t\t\tconst reorderedSteps = action.stepIds.map( ( id, index ) => ( {\n\t\t\t\t...stepsMap[ id ],\n\t\t\t\torder: index,\n\t\t\t} ) );\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttours: {\n\t\t\t\t\t...state.tours,\n\t\t\t\t\t[ action.tourId ]: {\n\t\t\t\t\t\t...tour,\n\t\t\t\t\t\tsteps: reorderedSteps,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpendingChanges: true,\n\t\t\t};\n\t\t}\n\n\t\t// AI drafting.\n\t\tcase ACTION_TYPES.SET_AI_DRAFT_LOADING:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\taiDraftLoading: action.isLoading,\n\t\t\t\taiDraftError: action.isLoading ? null : state.aiDraftError,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_AI_DRAFT_ERROR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\taiDraftError: action.error,\n\t\t\t\taiDraftLoading: false,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_AI_DRAFT_RESULT:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\taiDraftResult: action.result,\n\t\t\t\taiDraftLoading: false,\n\t\t\t\taiDraftError: null,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.CLEAR_AI_DRAFT:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\taiDraftResult: null,\n\t\t\t\taiDraftError: null,\n\t\t\t\taiDraftLoading: false,\n\t\t\t};\n\n\t\t// UI.\n\t\tcase ACTION_TYPES.SET_SIDEBAR_OPEN:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tsidebarOpen: action.isOpen,\n\t\t\t};\n\n\t\t// AI tour generation (pupil mode).\n\t\tcase ACTION_TYPES.SET_AI_TOUR_LOADING:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\taiTourLoading: action.isLoading,\n\t\t\t\taiTourError: action.isLoading ? null : state.aiTourError,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.SET_AI_TOUR_ERROR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\taiTourError: action.error,\n\t\t\t\taiTourLoading: false,\n\t\t\t};\n\n\t\tcase ACTION_TYPES.RECEIVE_EPHEMERAL_TOUR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tephemeralTour: action.tour,\n\t\t\t\taiTourLoading: false,\n\t\t\t\taiTourError: null,\n\t\t\t\t// Also put it in tours with special 'ephemeral' key.\n\t\t\t\ttours: {\n\t\t\t\t\t...state.tours,\n\t\t\t\t\tephemeral: action.tour,\n\t\t\t\t},\n\t\t\t};\n\n\t\tcase ACTION_TYPES.CLEAR_EPHEMERAL_TOUR:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tephemeralTour: null,\n\t\t\t\taiTourError: null,\n\t\t\t\taiTourLoading: false,\n\t\t\t\t// Remove from tours.\n\t\t\t\ttours: Object.fromEntries(\n\t\t\t\t\tObject.entries( state.tours ).filter( ( [ key ] ) => key !== 'ephemeral' )\n\t\t\t\t),\n\t\t\t};\n\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","/**\n * Store resolvers for async data fetching.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport apiFetch from '@wordpress/api-fetch';\nimport { setToursLoading, setToursError, receiveTours, receiveTour } from './actions';\n\n/**\n * Resolver for getTours.\n *\n * @return {Function} Generator function.\n */\nexport function* getTours() {\n\tyield setToursLoading( true );\n\n\ttry {\n\t\tconst tours = yield {\n\t\t\ttype: 'API_FETCH',\n\t\t\trequest: {\n\t\t\t\tpath: '/admin-coach-tours/v1/tours',\n\t\t\t\tmethod: 'GET',\n\t\t\t},\n\t\t};\n\n\t\tyield receiveTours( tours );\n\t} catch ( error ) {\n\t\tyield setToursError( error.message || 'Failed to fetch tours' );\n\t}\n}\n\n/**\n * Resolver for getTour.\n *\n * @param {number} tourId Tour ID.\n * @return {Function} Generator function.\n */\nexport function* getTour( tourId ) {\n\tyield setToursLoading( true );\n\n\ttry {\n\t\tconst tour = yield {\n\t\t\ttype: 'API_FETCH',\n\t\t\trequest: {\n\t\t\t\tpath: `/admin-coach-tours/v1/tours/${ tourId }`,\n\t\t\t\tmethod: 'GET',\n\t\t\t},\n\t\t};\n\n\t\tyield receiveTour( tour );\n\t} catch ( error ) {\n\t\tyield setToursError( error.message || 'Failed to fetch tour' );\n\t}\n}\n\n/**\n * Resolver for getToursByPostType.\n *\n * @param {string} postType Post type.\n * @return {Function} Generator function.\n */\nexport function* getToursByPostType( postType ) {\n\tyield setToursLoading( true );\n\n\ttry {\n\t\tconst tours = yield {\n\t\t\ttype: 'API_FETCH',\n\t\t\trequest: {\n\t\t\t\tpath: `/admin-coach-tours/v1/tours?post_type=${ postType }&editor=block`,\n\t\t\t\tmethod: 'GET',\n\t\t\t},\n\t\t};\n\n\t\tyield receiveTours( tours );\n\t} catch ( error ) {\n\t\tyield setToursError( error.message || 'Failed to fetch tours' );\n\t}\n}\n","/**\n * Store selectors.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { createSelector } from '@wordpress/data';\n\n// ============================================================================\n// Tour Selectors\n// ============================================================================\n\n/**\n * Get tours as an object keyed by ID.\n *\n * @param {Object} state Store state.\n * @return {Object} Tours object.\n */\nexport function getToursById( state ) {\n\treturn state.tours;\n}\n\n/**\n * Get all tours as an array (memoized).\n *\n * @param {Object} state Store state.\n * @return {Array} Array of tours.\n */\nexport const getTours = createSelector(\n\t( state ) => Object.values( state.tours ),\n\t( state ) => [ state.tours ]\n);\n\n/**\n * Get a single tour by ID.\n *\n * @param {Object} state  Store state.\n * @param {number} tourId Tour ID.\n * @return {Object|null} Tour object or null.\n */\nexport function getTour( state, tourId ) {\n\treturn state.tours[ tourId ] || null;\n}\n\n/**\n * Get tours loading state.\n *\n * @param {Object} state Store state.\n * @return {boolean} Loading state.\n */\nexport function isToursLoading( state ) {\n\treturn state.toursLoading;\n}\n\n/**\n * Get tours error.\n *\n * @param {Object} state Store state.\n * @return {string|null} Error message.\n */\nexport function getToursError( state ) {\n\treturn state.toursError;\n}\n\n/**\n * Get tours filtered by post type (memoized).\n *\n * @param {Object} state    Store state.\n * @param {string} postType Post type to filter by.\n * @return {Array} Filtered tours.\n */\nexport const getToursByPostType = createSelector(\n\t( state, postType ) =>\n\t\tgetTours( state ).filter(\n\t\t\t( tour ) =>\n\t\t\t\ttour.postTypes &&\n\t\t\t\ttour.postTypes.includes( postType ) &&\n\t\t\t\ttour.status === 'publish'\n\t\t),\n\t( state, postType ) => [ state.tours, postType ]\n);\n\n/**\n * Get tours filtered by editor type (memoized).\n *\n * @param {Object} state  Store state.\n * @param {string} editor Editor type ('block', 'classic', 'site').\n * @return {Array} Filtered tours.\n */\nexport const getToursByEditor = createSelector(\n\t( state, editor ) =>\n\t\tgetTours( state ).filter(\n\t\t\t( tour ) => tour.editor === editor && tour.status === 'publish'\n\t\t),\n\t( state, editor ) => [ state.tours, editor ]\n);\n\n// ============================================================================\n// Current Tour Selectors\n// ============================================================================\n\n/**\n * Get current tour ID.\n *\n * @param {Object} state Store state.\n * @return {number|null} Current tour ID.\n */\nexport function getCurrentTourId( state ) {\n\treturn state.currentTourId;\n}\n\n/**\n * Get current tour object.\n *\n * @param {Object} state Store state.\n * @return {Object|null} Current tour.\n */\nexport function getCurrentTour( state ) {\n\treturn state.currentTourId ? state.tours[ state.currentTourId ] : null;\n}\n\n/**\n * Get current step index.\n *\n * @param {Object} state Store state.\n * @return {number} Current step index.\n */\nexport function getCurrentStepIndex( state ) {\n\treturn state.currentStepIndex;\n}\n\n/**\n * Get current step object (memoized).\n *\n * @param {Object} state Store state.\n * @return {Object|null} Current step.\n */\nexport const getCurrentStep = createSelector(\n\t( state ) => {\n\t\tconst tour = getCurrentTour( state );\n\t\tif ( ! tour || ! tour.steps ) {\n\t\t\treturn null;\n\t\t}\n\t\treturn tour.steps[ state.currentStepIndex ] || null;\n\t},\n\t( state ) => [\n\t\tstate.tours,\n\t\tstate.currentTourId,\n\t\tstate.currentStepIndex,\n\t]\n);\n\n/**\n * Get total steps count for current tour.\n *\n * @param {Object} state Store state.\n * @return {number} Total steps.\n */\nexport function getTotalSteps( state ) {\n\tconst tour = getCurrentTour( state );\n\treturn tour?.steps?.length || 0;\n}\n\n/**\n * Check if there is a next step.\n *\n * @param {Object} state Store state.\n * @return {boolean} Has next step.\n */\nexport function hasNextStep( state ) {\n\treturn state.currentStepIndex < getTotalSteps( state ) - 1;\n}\n\n/**\n * Check if there is a previous step.\n *\n * @param {Object} state Store state.\n * @return {boolean} Has previous step.\n */\nexport function hasPreviousStep( state ) {\n\treturn state.currentStepIndex > 0;\n}\n\n/**\n * Get tour progress as percentage.\n *\n * @param {Object} state Store state.\n * @return {number} Progress (0-100).\n */\nexport function getProgress( state ) {\n\tconst total = getTotalSteps( state );\n\tif ( total === 0 ) {\n\t\treturn 0;\n\t}\n\treturn Math.round( ( ( state.currentStepIndex + 1 ) / total ) * 100 );\n}\n\n// ============================================================================\n// Mode Selectors\n// ============================================================================\n\n/**\n * Get current mode.\n *\n * @param {Object} state Store state.\n * @return {string|null} Mode ('educator' | 'pupil' | null).\n */\nexport function getMode( state ) {\n\treturn state.mode;\n}\n\n/**\n * Check if in educator mode.\n *\n * @param {Object} state Store state.\n * @return {boolean} Is educator mode.\n */\nexport function isEducatorMode( state ) {\n\treturn state.mode === 'educator';\n}\n\n/**\n * Check if in pupil mode.\n *\n * @param {Object} state Store state.\n * @return {boolean} Is pupil mode.\n */\nexport function isPupilMode( state ) {\n\treturn state.mode === 'pupil';\n}\n\n/**\n * Check if a tour is active.\n *\n * @param {Object} state Store state.\n * @return {boolean} Tour is active.\n */\nexport function isTourActive( state ) {\n\treturn state.currentTourId !== null && state.mode !== null;\n}\n\n// ============================================================================\n// Completion Selectors\n// ============================================================================\n\n/**\n * Check if completion is satisfied.\n *\n * @param {Object} state Store state.\n * @return {boolean} Completion satisfied.\n */\nexport function isCompletionSatisfied( state ) {\n\treturn state.completionSatisfied;\n}\n\n/**\n * Get skipped steps.\n *\n * @param {Object} state Store state.\n * @return {string[]} Array of skipped step IDs.\n */\nexport function getSkippedSteps( state ) {\n\treturn state.skippedSteps;\n}\n\n/**\n * Check if a specific step was skipped.\n *\n * @param {Object} state  Store state.\n * @param {string} stepId Step ID.\n * @return {boolean} Was skipped.\n */\nexport function wasStepSkipped( state, stepId ) {\n\treturn state.skippedSteps.includes( stepId );\n}\n\n// ============================================================================\n// Target Resolution Selectors\n// ============================================================================\n\n/**\n * Get resolved target.\n *\n * @param {Object} state Store state.\n * @return {Object|null} Resolved target info.\n */\nexport function getResolvedTarget( state ) {\n\treturn state.resolvedTarget;\n}\n\n/**\n * Check if currently recovering.\n *\n * @param {Object} state Store state.\n * @return {boolean} Is recovering.\n */\nexport function isRecovering( state ) {\n\treturn state.isRecovering;\n}\n\n/**\n * Get resolution attempts count.\n *\n * @param {Object} state Store state.\n * @return {number} Attempts count.\n */\nexport function getResolutionAttempts( state ) {\n\treturn state.resolutionAttempts;\n}\n\n/**\n * Get last error.\n *\n * @param {Object} state Store state.\n * @return {string|null} Error message.\n */\nexport function getLastError( state ) {\n\treturn state.lastError;\n}\n\n// ============================================================================\n// Educator Mode Selectors\n// ============================================================================\n\n/**\n * Check if picker is active.\n *\n * @param {Object} state Store state.\n * @return {boolean} Picker active.\n */\nexport function isPickerActive( state ) {\n\treturn state.isPickerActive;\n}\n\n/**\n * Get the step ID being picked for (if repicking target).\n *\n * @param {Object} state Store state.\n * @return {string|null} Step ID or null if adding new step.\n */\nexport function getPickingStepId( state ) {\n\treturn state.pickingStepId || null;\n}\n\n/**\n * Get selected step ID.\n *\n * @param {Object} state Store state.\n * @return {string|null} Selected step ID.\n */\nexport function getSelectedStepId( state ) {\n\treturn state.selectedStepId;\n}\n\n/**\n * Get selected step object (memoized).\n *\n * @param {Object} state Store state.\n * @return {Object|null} Selected step.\n */\nexport const getSelectedStep = createSelector(\n\t( state ) => {\n\t\tconst tour = getCurrentTour( state );\n\t\tif ( ! tour || ! state.selectedStepId ) {\n\t\t\treturn null;\n\t\t}\n\t\treturn tour.steps.find( ( step ) => step.id === state.selectedStepId );\n\t},\n\t( state ) => [ state.tours, state.currentTourId, state.selectedStepId ]\n);\n\n/**\n * Check if there are pending changes.\n *\n * @param {Object} state Store state.\n * @return {boolean} Has pending changes.\n */\nexport function hasPendingChanges( state ) {\n\treturn state.pendingChanges;\n}\n\n// ============================================================================\n// AI Draft Selectors\n// ============================================================================\n\n/**\n * Check if AI draft is loading.\n *\n * @param {Object} state Store state.\n * @return {boolean} AI draft loading.\n */\nexport function isAiDraftLoading( state ) {\n\treturn state.aiDraftLoading;\n}\n\n/**\n * Check if AI drafting is in progress (alias for isAiDraftLoading).\n *\n * @param {Object} state Store state.\n * @return {boolean} AI drafting in progress.\n */\nexport function isAiDrafting( state ) {\n\treturn isAiDraftLoading( state );\n}\n\n/**\n * Get AI draft error.\n *\n * @param {Object} state Store state.\n * @return {string|null} Error message.\n */\nexport function getAiDraftError( state ) {\n\treturn state.aiDraftError;\n}\n\n/**\n * Get AI draft result.\n *\n * @param {Object} state Store state.\n * @return {Object|null} AI draft output.\n */\nexport function getAiDraftResult( state ) {\n\treturn state.aiDraftResult;\n}\n\n/**\n * Get AI draft (alias for getAiDraftResult).\n *\n * @param {Object} state Store state.\n * @return {Object|null} AI draft output.\n */\nexport function getAiDraft( state ) {\n\treturn getAiDraftResult( state );\n}\n\n// ============================================================================\n// UI Selectors\n// ============================================================================\n\n/**\n * Check if sidebar is open.\n *\n * @param {Object} state Store state.\n * @return {boolean} Sidebar open.\n */\nexport function isSidebarOpen( state ) {\n\treturn state.sidebarOpen;\n}\n\n// ============================================================================\n// AI Tour Selectors (Pupil Mode)\n// ============================================================================\n\n/**\n * Check if AI tour is loading.\n *\n * @param {Object} state Store state.\n * @return {boolean} AI tour loading.\n */\nexport function isAiTourLoading( state ) {\n\treturn state.aiTourLoading;\n}\n\n/**\n * Get AI tour error.\n *\n * @param {Object} state Store state.\n * @return {string|null} Error message.\n */\nexport function getAiTourError( state ) {\n\treturn state.aiTourError;\n}\n\n/**\n * Get ephemeral tour.\n *\n * @param {Object} state Store state.\n * @return {Object|null} Ephemeral tour.\n */\nexport function getEphemeralTour( state ) {\n\treturn state.ephemeralTour;\n}\n\n/**\n * Check if currently running an ephemeral tour.\n *\n * @param {Object} state Store state.\n * @return {boolean} Is ephemeral tour active.\n */\nexport function isEphemeralTourActive( state ) {\n\treturn state.currentTourId === 'ephemeral' && state.mode === 'pupil';\n}\n","// packages/icons/src/library/arrow-right.tsx\nimport { Path, SVG } from \"@wordpress/primitives\";\nimport { jsx } from \"react/jsx-runtime\";\nvar arrow_right_default = /* @__PURE__ */ jsx(SVG, { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", children: /* @__PURE__ */ jsx(Path, { d: \"m14.5 6.5-1 1 3.7 3.7H4v1.6h13.2l-3.7 3.7 1 1 5.6-5.5z\" }) });\nexport {\n  arrow_right_default as default\n};\n//# sourceMappingURL=arrow-right.mjs.map\n","// packages/icons/src/library/close.tsx\nimport { Path, SVG } from \"@wordpress/primitives\";\nimport { jsx } from \"react/jsx-runtime\";\nvar close_default = /* @__PURE__ */ jsx(SVG, { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", children: /* @__PURE__ */ jsx(Path, { d: \"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z\" }) });\nexport {\n  close_default as default\n};\n//# sourceMappingURL=close.mjs.map\n","module.exports = window[\"wp\"][\"apiFetch\"];","module.exports = window[\"wp\"][\"blocks\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"i18n\"];","module.exports = window[\"wp\"][\"primitives\"];","module.exports = window[\"ReactJSXRuntime\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; (typeof current == 'object' || typeof current == 'function') && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Pupil Entry Point.\n *\n * Initializes the tour runner and AI launcher for pupils.\n *\n * @package AdminCoachTours\n * @since   0.1.0\n */\n\nimport { render } from '@wordpress/element';\nimport { dispatch, select, subscribe } from '@wordpress/data';\n\nimport TourRunner from './TourRunner.jsx';\nimport PupilLauncher from './PupilLauncher.jsx';\n\n// Import store to ensure it's registered.\nimport '../store/index.js';\n\nconst STORE_NAME = 'admin-coach-tours';\n\n/**\n * Initialize the pupil tour runner.\n */\nfunction init() {\n\tconsole.log( '[ACT Pupil] Initializing... v4' );\n\tconsole.log( '[ACT Pupil] TourRunner:', typeof TourRunner, TourRunner );\n\tconsole.log( '[ACT Pupil] AI Available:', window.adminCoachTours?.aiAvailable );\n\n\t// Create container for tour runner.\n\tconst container = document.createElement( 'div' );\n\tcontainer.id = 'admin-coach-tours-pupil';\n\tdocument.body.appendChild( container );\n\n\t// Render the tour runner.\n\ttry {\n\t\trender( <TourRunner />, container );\n\t\tconsole.log( '[ACT Pupil] TourRunner rendered successfully' );\n\t} catch ( error ) {\n\t\tconsole.error( '[ACT Pupil] Error rendering TourRunner:', error );\n\t}\n\n\t// Create container for AI launcher.\n\tconst launcherContainer = document.createElement( 'div' );\n\tlauncherContainer.id = 'admin-coach-tours-launcher';\n\tdocument.body.appendChild( launcherContainer );\n\n\ttry {\n\t\trender( <PupilLauncher />, launcherContainer );\n\t\tconsole.log( '[ACT Pupil] PupilLauncher rendered successfully' );\n\t} catch ( error ) {\n\t\tconsole.error( '[ACT Pupil] Error rendering PupilLauncher:', error );\n\t}\n\n\t// Check for auto-start tour from URL (use top window to handle iframe case).\n\tconst topWindow = window.top || window;\n\tconst urlParams = new URLSearchParams( topWindow.location.search );\n\tconst autoStartTourId = urlParams.get( 'act_tour' );\n\n\tconsole.log( '[ACT Pupil] URL search:', topWindow.location.search );\n\tconsole.log( '[ACT Pupil] act_tour param:', autoStartTourId );\n\n\tif ( autoStartTourId ) {\n\t\tconst tourId = parseInt( autoStartTourId, 10 );\n\t\tconsole.log( '[ACT Pupil] Will fetch and start tour:', tourId );\n\n\t\t// First, trigger the tour to be fetched via selector resolution.\n\t\t// Access the selector to kick off the resolver.\n\t\tconst initialTour = select( STORE_NAME ).getTour( tourId );\n\t\tconsole.log( '[ACT Pupil] Initial tour state:', initialTour );\n\n\t\t// Subscribe to store changes and start tour once it's loaded.\n\t\tconst unsubscribe = subscribe( () => {\n\t\t\tconst store = select( STORE_NAME );\n\t\t\tconst tour = store.getTour( tourId );\n\t\t\tconst isLoading = store.isToursLoading();\n\n\t\t\t// Once tour is loaded and not loading, start it.\n\t\t\tif ( tour && ! isLoading ) {\n\t\t\t\tconsole.log( '[ACT Pupil] Tour loaded:', tour );\n\t\t\t\tconsole.log( '[ACT Pupil] Tour steps:', tour.steps, 'count:', tour.steps?.length );\n\t\t\t\tunsubscribe();\n\t\t\t\tdispatch( STORE_NAME ).startTour( tourId );\n\t\t\t}\n\t\t} );\n\n\t\t// Timeout fallback - if tour doesn't load within 10 seconds, give up.\n\t\tsetTimeout( () => {\n\t\t\tconsole.log( '[ACT Pupil] Timeout reached, unsubscribing' );\n\t\t\tunsubscribe();\n\t\t}, 10000 );\n\t}\n}\n\n// Initialize when DOM is ready.\nif ( document.readyState === 'loading' ) {\n\tdocument.addEventListener( 'DOMContentLoaded', init );\n} else {\n\tinit();\n}\n"],"names":["useState","useEffect","useCallback","useRef","__","Button","Spinner","Flex","FlexItem","FlexBlock","arrowRight","close","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CoachPanel","step","stepIndex","totalSteps","tourTitle","targetElement","resolutionError","isApplyingPreconditions","onContinue","onRepeat","onPrevious","onNext","onStop","position","setPosition","x","y","isDragging","setIsDragging","dragOffset","setDragOffset","positionKey","setPositionKey","panelRef","isFirstStep","isLastStep","isManualCompletion","completion","type","calculatePosition","isConnected","rect","getBoundingClientRect","ownerDoc","ownerDocument","iframeOffset","top","left","document","iframe","querySelector","iframeRect","adjustedRect","bottom","right","panelWidth","panelHeight","padding","window","innerWidth","innerHeight","Math","max","min","handleScroll","addEventListener","passive","ownerWin","defaultView","removeEventListener","e","handleDragStart","event","target","closest","current","clientX","clientY","handleDragMove","panelRect","maxX","width","maxY","height","handleDragEnd","renderContent","className","children","variant","onClick","content","dangerouslySetInnerHTML","__html","renderControls","justify","align","disabled","size","icon","label","ref","style","maxHeight","backgroundColor","borderRadius","boxShadow","zIndex","display","flexDirection","cursor","onMouseDown","borderBottom","userSelect","title","fontSize","color","flex","overflow","borderTop","DEFAULT_STYLES","overlay","transition","spotlight","pulse","animation","PULSE_KEYFRAMES","Highlighter","constructor","options","usePulse","overlayColor","highlightColor","transitionDuration","spotlightElement","resizeObserver","styleElement","_isAnimating","_init","createElement","textContent","head","appendChild","setAttribute","Object","assign","pointerEvents","body","ResizeObserver","_updatePosition","highlight","element","clear","unobserve","_removeScrollListeners","observe","_addScrollListeners","iframes","querySelectorAll","contentDocument","_scrollHandler","_scrollWindows","parent","parentElement","scrollHeight","clientHeight","push","win","transitionTo","Promise","resolve","requestAnimationFrame","setTimeout","setStyle","colors","default","success","warning","error","flash","destroy","disconnect","parentNode","removeChild","createPortal","useSelect","useDispatch","apiFetch","Dashicon","STORE_NAME","CATEGORY_ICONS","media","layout","formatting","PupilLauncher","isOpen","setIsOpen","tasks","setTasks","isTasksLoading","setIsTasksLoading","tasksError","setTasksError","chatQuery","setChatQuery","activeTab","setActiveTab","localLoading","setLocalLoading","inputRef","storeLoading","aiTourError","isPlaying","aiAvailable","select","_store$isAiTourLoadin","_store$getAiTourError","_window$adminCoachTou","store","isAiTourLoading","getAiTourError","getCurrentTour","adminCoachTours","requestAiTour","clearEphemeralTour","length","path","then","response","available","catch","message","finally","focus","handleTaskClick","taskId","postType","handleChatSubmit","preventDefault","trim","toggleLauncher","prev","closeLauncher","href","tasksByCategory","reduce","acc","task","category","loadingOverlay","entries","map","categoryTasks","charAt","toUpperCase","slice","id","onSubmit","value","onChange","placeholder","dispatch","wpDispatch","wpSelect","resolveTarget","resolveTargetWithRecovery","applyPreconditions","onLeaveStep","onEnterStep","clearInsertedBlocks","setCurrentStepIndex","watchCompletion","waitForNextStepBlock","scrollElementIntoView","isInIframe","scrollIntoView","behavior","block","inline","elementRect","elementTopInMain","elementBottomInMain","viewportHeight","isFullyVisible","scrollTarget","scrollY","scrollTo","TourRunner","console","log","setTargetElement","setResolutionError","resolution","setResolution","setIsApplyingPreconditions","repeatCounter","setRepeatCounter","highlighterRef","previousStepIndexRef","completionWatcherRef","currentTour","currentStep","data","isPupilMode","getCurrentStep","getCurrentStepIndex","getTotalSteps","stopTour","nextStep","previousStep","repeatStep","isMounted","resolvedElement","previousStepIndex","setupStep","cancel","preconditions","preconditionResult","warn","failedPreconditions","recoveryFn","recovery","result","usedLocator","recovered","blockClientId","getAttribute","blockWrapper","blockEditorDispatch","selectBlock","err","params","r","watcher","promise","completionResult","tourSteps","steps","lookAheadResult","waited","blockType","handleContinue","confirm","handleRepeat","c","handleStop","panelContent","waitForSelector","selector","timeout","startTime","Date","now","check","waitForCondition","conditionFn","ensureEditor","editorStore","blocks","getBlocks","undefined","ensureSidebarOpen","preferredSidebar","editPostStore","editPostDispatch","interfaceStore","interfaceDispatch","activeItem","getActiveComplementaryArea","enableComplementaryArea","isEditorSidebarOpened","isPluginSidebarOpened","openGeneralSidebar","ensureSidebarClosed","disableComplementaryArea","closeGeneralSidebar","selectSidebarTab","tabName","tabMap","post","sidebarId","getActiveGeneralSidebarName","openInserter","isInserterOpened","setIsInserterOpened","inserterButton","click","el","closeInserter","clientId","blockEditorStore","getSelectedBlockClientId","focusElement","activeElement","openModal","triggerSelector","modalSelector","existingModal","trigger","insertedBlocks","Map","__actInsertedBlocks","insertedBlocksByStep","currentStepIndex","leavingStepIndex","blockEditorSelect","selectedClientId","clearSelectedBlock","enteringStepIndex","__actLastAppearedBlockClientId","getStepInsertedBlock","markerId","stepBlocks","get","setStepInsertedBlock","has","set","insertBlock","blockName","attributes","Array","from","createBlock","stepClientId","existingBlock","getBlock","name","focusBlockElement","targetDoc","blockElement","existingClientId","allBlocks","b","matchingBlock","find","lastBlock","textBlockTypes","isRequestingTextBlock","includes","isLastBlockText","blockAttributes","metadata","actMarkerId","rootClientId","iframeDoc","editableSelectors","focusTarget","selection","getSelection","range","createRange","selectNodeContents","collapse","removeAllRanges","addRange","tagName","closeModal","modal","closeButton","dispatchEvent","KeyboardEvent","key","code","bubbles","preconditionHandlers","applyPrecondition","precondition","handler","sidebar","tab","results","allSuccessful","filter","getAvailablePreconditions","description","optional","required","hasEmptyParagraph","emptyParagraph","isEmptyContent","toString","str","toJSON","json","isArray","insertEmptyParagraph","insertIndex","interval","focusBlock","ensureEmptyPlaceholder","exists","wasInserted","getVisibleElements","elements","inserterOpen","sidebarOpen","sidebarTab","toolbarVisible","hasSelectedBlock","selectedBlockType","sidebarName","getSelectedBlock","selectedBlock","getEditorBlocks","index","blockInfo","isEmpty","isBlockEmpty","isSelected","order","blockEl","domInfo","toLowerCase","dataType","dataBlock","hasRichText","editableSelector","url","src","sampleUIElements","samples","publishButton","settingsButton","searchInput","emptyBlockPlaceholder","inserterSelectors","sel","ariaLabel","visible","isElementVisible","publishSelectors","text","settingsBtn","placeholderSelectors","inIframe","getComputedStyle","visibility","gatherEditorContext","editorBlocks","visibleElements","uiSamples","wpVersion","timestamp","getEditorIframeDocument","opacity","isWithinSelectedBlock","wpData","wp","blockEditor","targetClientId","targetBlockElement","isWithin","contains","isWithinContainer","containerSelector","container","findByCSS","doc","findByRole","role","split","s","withExplicitRole","implicitRoleMap","button","textbox","link","checkbox","radio","listbox","option","heading","img","navigation","main","complementary","banner","contentinfo","search","form","region","tabpanel","tablist","menu","menuitem","dialog","withImplicitRole","allMatches","accessibleName","getAccessibleName","labelledBy","labelEl","getElementById","findByTestId","testId","findByDataAttribute","attr","attrValue","findByAriaLabel","allWithLabel","elLabel","findByContextual","parts","containerSel","targetSel","findByWpBlock","startsWith","substring","keys","parseInt","matchingBlocks","findByLocator","locator","calculateSpecificity","constraints","score","weight","withinContainer","locators","iframeOnlyContainers","shouldSearchIframe","inEditorIframe","searchDoc","sortedLocators","sort","a","fallback","primaryLocators","l","fallbackLocators","scopeToSelectedBlock","scored","testTargetResolution","elementInfo","subscribe","getExpectedBlockType","attribute","dataTypeMatch","match","wpBlockMatch","hasBlockOfType","findBlock","blockList","innerBlocks","waitForBlock","timeoutId","unsubscribe","isResolved","cleanup","clearTimeout","complete","timedOut","currentIndex","nextIndex","expectedBlockType","createWatcher","checkFn","checkInterval","clearInterval","setInterval","watchClickTarget","isArmed","gracePeriod","handleClick","capture","watchDomValueChanged","expectedValue","attributeName","observer","handleInput","handleChange","getCurrentValue","isContentEditable","checked","initialValue","checkCompletion","currentValue","MutationObserver","characterData","subtree","childList","watchWpDataChange","storeName","args","comparator","checkValue","createManualWatcher","resolveFn","cancelled","watchElementAppear","getMatchingClientIds","clientIds","Set","forEach","wrapper","add","existingClientIds","currentClientIds","__actNewlyAppearedBlockClientId","watchElementDisappear","watchCustomEvent","eventName","handleEvent","detail","once","getAvailableCompletions","requiresTarget","ACTION_TYPES","generateId","replace","random","v","setToursLoading","isLoading","SET_TOURS_LOADING","setToursError","SET_TOURS_ERROR","receiveTours","tours","RECEIVE_TOURS","receiveTour","tour","RECEIVE_TOUR","setCurrentTour","tourId","SET_CURRENT_TOUR","request","method","status","fetchTours","fetchTour","saveTour","tourData","createTour","updateTour","startTour","mode","START_TOUR","endTour","END_TOUR","setCurrentStep","SET_CURRENT_STEP","NEXT_STEP","PREVIOUS_STEP","skipStep","SKIP_STEP","REPEAT_STEP","setMode","SET_MODE","setCompletionSatisfied","satisfied","SET_COMPLETION_SATISFIED","resetCompletion","RESET_COMPLETION","markStepComplete","setResolvedTarget","SET_RESOLVED_TARGET","clearResolvedTarget","CLEAR_RESOLVED_TARGET","setRecovering","isRecovering","SET_RECOVERING","incrementResolutionAttempts","INCREMENT_RESOLUTION_ATTEMPTS","setLastError","SET_LAST_ERROR","activatePicker","stepId","ACTIVATE_PICKER","startPicking","deactivatePicker","DEACTIVATE_PICKER","stopPicking","selectStep","SELECT_STEP","setPendingChanges","pending","SET_PENDING_CHANGES","updateStep","updates","UPDATE_STEP","addStep","newStep","instruction","hint","action","tags","version","ADD_STEP","deleteStep","DELETE_STEP","reorderSteps","stepIds","REORDER_STEPS","setAiDraftLoading","SET_AI_DRAFT_LOADING","setAiDraftError","SET_AI_DRAFT_ERROR","setAiDraftResult","SET_AI_DRAFT_RESULT","clearAiDraft","CLEAR_AI_DRAFT","requestAiDraft","elementContext","setSidebarOpen","SET_SIDEBAR_OPEN","setAiTourLoading","SET_AI_TOUR_LOADING","setAiTourError","SET_AI_TOUR_ERROR","receiveEphemeralTour","RECEIVE_EPHEMERAL_TOUR","CLEAR_EPHEMERAL_TOUR","query","editorContext","JSON","stringify","startEphemeralTour","tourWithId","controls","API_FETCH","GATHER_EDITOR_CONTEXT","ENSURE_EMPTY_PLACEHOLDER","FETCH_TOUR","FETCH_TOURS","URLSearchParams","append","editor","SAVE_TOUR","CREATE_TOUR","UPDATE_TOUR","REQUEST_AI_DRAFT","REQUEST_AI_TOUR","FETCH_AI_TASKS","createReduxStore","register","reducer","DEFAULT_STATE","actions","selectors","resolvers","initialState","toursLoading","toursError","currentTourId","completionSatisfied","skippedSteps","isPickerActive","pickingStepId","selectedStepId","pendingChanges","tourProgress","lastError","resolvedTarget","resolutionAttempts","aiDraftLoading","aiDraftError","aiDraftResult","aiTourLoading","ephemeralTour","state","hasMore","newSkipped","updatedSteps","_action$index","newSteps","splice","i","filteredSteps","stepsMap","reorderedSteps","ephemeral","fromEntries","getTours","getTour","getToursByPostType","createSelector","getToursById","values","isToursLoading","getToursError","postTypes","getToursByEditor","getCurrentTourId","hasNextStep","hasPreviousStep","getProgress","total","round","getMode","isEducatorMode","isTourActive","isCompletionSatisfied","getSkippedSteps","wasStepSkipped","getResolvedTarget","getResolutionAttempts","getLastError","getPickingStepId","getSelectedStepId","getSelectedStep","hasPendingChanges","isAiDraftLoading","isAiDrafting","getAiDraftError","getAiDraftResult","getAiDraft","isSidebarOpen","getEphemeralTour","isEphemeralTourActive","render","init","launcherContainer","topWindow","urlParams","location","autoStartTourId","initialTour","readyState"],"ignoreList":[],"sourceRoot":""}